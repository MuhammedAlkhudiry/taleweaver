{"version":3,"sources":["editor/model/Doc.ts","editor/model/block/Paragraph.ts","editor/model/block/Block.ts","editor/model/word/TextWord.ts","editor/model/word/Word.ts","editor/view/PageView.ts","editor/state/CursorTransformation.ts","editor/state/cursortransformationsteps/TranslateCursor.ts","editor/command/cursor/moveToLineStart.ts","editor/command/cursor/moveToLineEnd.ts","editor/state/cursortransformationsteps/TranslateCursorHead.ts","editor/command/cursor/moveHeadTo.ts","editor/command/cursor/moveHeadToLineStart.ts","editor/command/cursor/moveHeadToLineEnd.ts","editor/view/EditorCursorView.ts","editor/helpers/isElementInViewport.ts","editor/command/cursor/moveTo.ts","editor/event/Event.ts","editor/view/DocView.ts","editor/helpers/throttle.ts","editor/view/ParagraphLineView.ts","editor/view/LineView.ts","editor/view/WordView.ts","editor/view/helpers/measureText.ts","editor/view/TextView.ts","editor/state/CursorTransformer.ts","editor/state/documenttransformationsteps/Assign.ts","editor/state/DocumentTransformer.ts","editor/event/EventObserver.ts","editor/event/EditorCursorEventObserver.ts","editor/command/cursor/moveHeadBackwardByWord.ts","editor/command/cursor/moveHeadBackward.ts","editor/command/cursor/moveBackwardByWord.ts","editor/command/cursor/moveBackward.ts","editor/command/cursor/moveHeadForwardByWord.ts","editor/command/cursor/moveHeadForward.ts","editor/command/cursor/moveForwardByWord.ts","editor/command/cursor/moveForward.ts","editor/command/cursor/moveHeadToDocumentStart.ts","editor/command/cursor/moveHeadToPreviousLine.ts","editor/command/cursor/moveToDocumentStart.ts","editor/command/cursor/moveToPreviousLine.ts","editor/command/cursor/moveHeadToDocumentEnd.ts","editor/command/cursor/moveHeadToNextLine.ts","editor/command/cursor/moveToDocumentEnd.ts","editor/command/cursor/moveToNextLine.ts","editor/state/DocumentTransformation.ts","editor/event/DocumentEventObserver.ts","editor/command/document/insertText.ts","editor/TaleWeaver.ts","editor/state/State.ts","editor/cursor/Cursor.ts","App.tsx","editor/state/helpers/parseStateJSON.ts","serviceWorker.ts","index.tsx"],"names":["Doc","Object","classCallCheck","this","children","child","push","index","indexOf","splice","size","forEach","getSize","Paragraph","Block","parent","TextWord","Word","block","text","length","PageView","docView","config","lineViews","mounted","lineView","pageViews","getPageViews","setPageView","domDocumentContent","getDOM","domPage","document","createElement","className","style","width","concat","height","padding","paddingTop","paddingRight","paddingBottom","paddingLeft","userSelect","position","appendChild","domPageContent","mount","from","to","viewPositionBoxes","offset","cumulatedHeight","n","nn","lineViewPositionBox","mapModelPositionRangeToViewPositionBox","Math","max","min","x1","y1","x2","y2","getHeight","x","y","mapViewPositionToModelPosition","lineViewAwarePosition","resolveModelPosition","objectSpread","pageView","pageViewPosition","Error","CursorTransformation","steps","step","TranslateCursor","displacement","preserveLineViewPosition","arguments","undefined","moveToLineStart","taleWeaver","transformation","editorCursor","getState","getEditorCursor","head","getHead","viewAwarePosition","getDocView","lineViewPosition","addStep","moveToLineEnd","TranslateCursorHead","moveHeadTo","moveHeadToLineStart","moveHeadRightByLine","EditorCursorView","domSelections","selecting","blinkState","blinkInterval","lineViewX","lastLineViewX","renderHead","renderSelections","updateNativeCursor","_viewPositionBoxes$","mapModelPositionRangeToViewPositionBoxes","pageViewPositionBox","domHead","left","top","parentElement","removeChild","element","rect","getBoundingClientRect","bottom","window","innerHeight","documentElement","clientHeight","right","innerWidth","clientWidth","isElementInViewport","scrollIntoView","_this","anchor","getAnchor","selectionsCount","domSelection","pop","background","selectionIndex","_ref","pointerEvents","domWordContent","wordView","selection","getSelection","removeAllRanges","range","createRange","selectNode","addRange","_this2","marginLeft","visibility","render","startBlinking","observe","extraArgs","stopBlinking","_this3","setInterval","clearInterval","applyEditorCursorTransformation","moveTo","KeyPressEvent","key","shift","meta","alt","DocView","doc","handleContextMenu","event","preventDefault","handleMouseDown","editorCursorView","clientX","clientY","beginSelect","handleMouseMove","func","milliseconds","throttledRunTimeout","lastRunAt","_len","args","Array","_key","clearTimeout","setTimeout","apply","Date","now","throttle","moveSelect","handleMouseUp","endSelect","handleKeyDown","dispatchEvent","shiftKey","metaKey","altKey","handleKeyUp","wordViewBlocks","buildWordViewBlocks","buildLineViews","buildPageViews","buildEditorCursorView","domWrapper","domDocument","contentEditable","spellcheck","outline","addEventListener","_loop","clientRects","offsets","sqDistances","map","clientRect","xDistance","yDistance","toConsumableArray","pageModelPosition","pageViewAwarePosition","docViewPosition","registry","getRegistry","getChildren","wordViewBlock","wordViews","word","getWordViewClass","getType","_this4","pageContentWidth","pageWidth","pagePaddingLeft","pagePaddingRight","LineView","getLineViewClass","cumulatedWidth","getWidth","setLineView","appendWordView","_this5","pageViewConigs","pageHeight","pagePaddingTop","pagePaddingBottom","pageContentHeight","appendLineView","setDocView","ParagraphLineView","possibleConstructorReturn","getPrototypeOf","call","getPageView","domParagraphLine","domLine","domLineContent","getLineViews","previousPageView","getPreviousPageView","previousPageLineViews","nextPageView","getNextPageView","viewPositionBox","wordViewPositionBox","wordViewAwarePosition","WordView","getWordViews","previousLineView","getPreviousLineView","previousLineWordViews","nextLineView","getNextLineView","wordViewPosition","textMeasurer","TextMeasurer","$iframe","src","border","body","$textContainers","Map","createClass","value","textStyle","textStyleKey","JSON","stringify","getTextStyleKey","has","$textContainer","display","whiteSpace","fontFamily","fontSize","fontWeight","lineHeight","letterSpacing","contentDocument","set","get","adjustedText","replace","getTextContainerElement","innerHTML","boundingClientRect","measureText","measure","placeholderTextStyle","TextView","getLineView","textWord","domTextWord","createTextNode","getText","domWord","getScreenX","lastWidth","substring","measurement","at","CursorTransformer","cursor","getSteps","getDisplacement","getExtraArgs","Assign","DocumentTransformer","setText","EventObserver","cursorCommand","cursorTransformation","documentCommand","documentTransformation","applyDocumentTransformation","EditorCursorEventObserver","keyPressEvent","dispatchCursorCommand","previousWordView","getPreviousWordView","nextWordView","getNextWordView","moveHeadToLineEnd","getDoc","getEditorCursorView","getLineViewX","previousLinePosition","documentSize","nextLinePosition","DocumentTransformation","DocumentEventObserver","dispatchDocumentCommand","TaleWeaverRegistry","blockClasses","wordClasses","lineViewClasses","wordViewClasses","eventObservers","registerDocClass","registerBlockClass","registerWordClass","registerDocViewClass","registerPageViewClass","registerLineViewClass","registerWordViewClass","registerCursorTransformer","registerDocumentTransformer","registerEventObserver","docClass","type","blockClass","wordClass","docViewClass","pageViewClass","lineViewClass","wordViewClass","cursorTransformer","documentTransformer","eventObserver","TaleWeaver","state","getDocViewClass","State","observerCursors","getEventObservers","onEvent","getCursorTransformer","getDocumentTransformer","Cursor","id","toString","random","observers","observer","notifyObservers","initialStateJSON","trim","split","paragraph","paragraphJSON","wordJSON","TaleWeaverComponent","props","domRef","React","createRef","setState","stateJSON","getDocClass","blockJSON","getBlockClass","getWordClass","setDoc","setEditorCursor","observerCursorJSON","observerCursor","appendObserverCursor","parseStateJSON","domElement","current","attach","react_default","a","ref","Component","App","App_TaleWeaverComponent","Boolean","location","hostname","match","ReactDOM","src_App_0","getElementById","navigator","serviceWorker","ready","then","registration","unregister"],"mappings":"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","file":"static/js/main.2729a37f.chunk.js","sourcesContent":["import Block from './block/Block';\n\n/**\n * Models a document. This is the root of the\n * element tree.\n */\nexport default class Doc {\n  /** Child elements. */\n  protected children: Block[];\n\n  /**\n   * Creates a new document element instance.\n   */\n  constructor() {\n    this.children = [];\n  }\n\n  /**\n   * Appends a child element.\n   * @param child - Child element to append.\n   */\n  appendChild(child: Block) {\n    this.children.push(child);\n  }\n\n  /**\n   * Removes a child element;\n   * @param child - Child element to remove.\n   */\n  removeChild(child: Block) {\n    const index = this.children.indexOf(child);\n    if (index < 0) {\n      return;\n    }\n    this.children.splice(index, 1);\n  }\n\n  /**\n   * Gets all child elements.\n   */\n  getChildren(): Block[] {\n    return this.children;\n  }\n\n  /**\n   * Gets the size of the document.\n   */\n  getSize(): number {\n    let size = 0;\n    this.children.forEach(child => {\n      size += child.getSize();\n    });\n    return size;\n  }\n}\n","import Block from './Block';\n\n/**\n * Paragraph block.\n */\nexport default class Paragraph extends Block {\n  getType(): string {\n    return 'Paragraph';\n  }\n}\n","import Doc from '../Doc';\nimport Word from '../word/Word';\n\n/**\n * Models a block element in a document.\n * A block element should be the child of a\n * document element and may contain inline\n * elements as children.\n */\nexport default abstract class Block {\n  /** Parent element. */\n  protected parent?: Doc;\n  /** Child elements. */\n  protected children: Word[];\n\n  /** Creates a new block element instance. */\n  constructor() {\n    this.children = [];\n  }\n\n  /**\n   * Gets the type of block element.\n   */\n  abstract getType(): string;\n\n  /**\n   * Sets the parent element.\n   * @param parent - Parent element to set.\n   */\n  setParent(parent: Doc) {\n    this.parent = parent;\n  }\n\n  /**\n   * Gets a parent element.\n   */\n  getParent(): Doc {\n    return this.parent!;\n  }\n\n  /**\n   * Appends a child element.\n   * @param child - Child element to append.\n   */\n  appendChild(child: Word) {\n    this.children.push(child);\n  }\n\n  /**\n   * Removes a child element.\n   * @param child - Child element to remove.\n   */\n  removeChild(child: Word) {\n    const index = this.children.indexOf(child);\n    if (index < 0) {\n      return;\n    }\n    this.children.splice(index, 1);\n  }\n\n  /**\n   * Gets all child elements.\n   */\n  getChildren(): Word[] {\n    return this.children;\n  }\n\n  /**\n   * Gets the size of the block element.\n   */\n  getSize(): number {\n    let size = 0;\n    this.children.forEach(child => {\n      size += child.getSize();\n    });\n    return size;\n  }\n}\n","import Word from './Word';\n\n/**\n * Word for text elements.\n */\nexport default class TextWord extends Word {\n  getType(): string {\n    return 'Text';\n  }\n}\n","import Block from '../block/Block';\n\n/**\n * Models a segment of the document that\n * cannot be split when rendered. This is\n * the basic building block of a document's\n * layout.\n */\nexport default abstract class Word {\n  /** Block this word belongs to. */\n  protected block: Block;\n  /** Text content. */\n  protected text?: string;\n\n  /**\n   * Creates a new word instance.\n   * @param block - Block this word belongs to.\n   */\n  constructor(block: Block) {\n    this.block = block;\n  }\n\n  /**\n   * Gets the type of word.\n   */\n  abstract getType(): string;\n\n  /**\n   * Gets the block this word belongs to.\n   */\n  getBlock(): Block {\n    return this.block;\n  }\n\n  /**\n   * Sets the text content.\n   * @param text - The text content to set.\n   */\n  setText(text: string) {\n    this.text = text;\n  }\n\n  /**\n   * Gets the text content.\n   */\n  getText(): string {\n    return this.text!;\n  };\n\n  /**\n   * Gets the size of the word.\n   */\n  getSize(): number {\n    return this.text!.length;\n  }\n}\n","import DocView from './DocView';\nimport LineView, { LineViewAwarePosition } from './LineView';\n\n/**\n * Page view configs.\n */\nexport interface PageViewConfig {\n  width: number;\n  height: number;\n  paddingTop: number;\n  paddingBottom: number;\n  paddingLeft: number;\n  paddingRight: number;\n}\n\nexport interface PageViewDOMElements {\n  domPage: HTMLDivElement;\n  domPageContent: HTMLDivElement;\n}\n\nexport interface PageViewPositionBox {\n  x1: number;\n  y1: number;\n  x2: number;\n  y2: number;\n}\n\nexport interface PageViewAwarePosition extends LineViewAwarePosition {\n  pageView: PageView;\n  pageViewPosition: number;\n};\n\nexport default class PageView {\n  private docView: DocView;\n  private config: PageViewConfig;\n\n  private lineViews: LineView[];\n\n  private mounted: boolean;\n  private domPage?: HTMLDivElement;\n  private domPageContent?: HTMLDivElement;\n\n  constructor(docView: DocView, config: PageViewConfig) {\n    this.docView = docView;\n    this.config = config;\n\n    this.lineViews = [];\n\n    this.mounted = false;\n  }\n\n  /**\n   * Gets the model size of the page.\n   */\n  getSize(): number {\n    let size = 0;\n    this.lineViews!.forEach(lineView => size += lineView.getSize());\n    return size;\n  }\n\n  /**\n   * Gets the parent document view.\n   */\n  getDocView(): DocView {\n    return this.docView!;\n  }\n\n  /**\n   * Gets the previous page view in the parent document view.\n   */\n  getPreviousPageView(): PageView | null {\n    const pageViews = this.docView!.getPageViews();\n    const index = pageViews.indexOf(this);\n    if (index < 0) {\n      return null;\n    }\n    if (index === 0) {\n      return null;\n    }\n    return pageViews[index - 1];\n  }\n\n  /**\n   * Gets the next page view in the parent document view.\n   */\n  getNextPageView(): PageView | null {\n    const pageViews = this.docView!.getPageViews();\n    const index = pageViews.indexOf(this);\n    if (index < 0) {\n      return null;\n    }\n    if (index === pageViews.length - 1) {\n      return null;\n    }\n    return pageViews[index + 1];\n  }\n\n  /**\n   * Appends a line view to the page.\n   */\n  appendLineView(lineView: LineView) {\n    this.lineViews.push(lineView);\n    lineView.setPageView(this);\n  }\n\n  /**\n   * Remove a line view from the page.\n   */\n  removeLineView(lineView: LineView) {\n    const index = this.lineViews.indexOf(lineView);\n    if (index < 0) {\n      return;\n    }\n    this.lineViews.splice(index, 1);\n  }\n\n  /**\n   * Gets the child line views.\n   */\n  getLineViews(): LineView[] {\n    return this.lineViews;\n  }\n\n  /**\n   * Mounts the view to DOM.\n   */\n  mount() {\n    // Do not mount if already mounted\n    if (this.mounted) {\n      return;\n    }\n\n    // Get wrapper element\n    const { domDocumentContent } = this.docView.getDOM();\n\n    // Build page element\n    this.domPage = document.createElement('div');\n    this.domPage.className = 'tw--page';\n    this.domPage.style.width = `${this.config.width}px`;\n    this.domPage.style.height = `${this.config.height}px`;\n    this.domPage.style.padding = `${this.config.paddingTop}px ${this.config.paddingRight}px ${this.config.paddingBottom}px ${this.config.paddingLeft}px`;\n    this.domPage.style.userSelect = 'none';\n    this.domPage.style.position = 'relative';\n    domDocumentContent.appendChild(this.domPage);\n\n    // Build page content element\n    this.domPageContent = document.createElement('div');\n    this.domPageContent.className = 'tw--page-content';\n    this.domPageContent.style.position = 'relative';\n    this.domPageContent.style.height = '100%';\n    this.domPage.appendChild(this.domPageContent);\n\n    // Mount line views\n    this.lineViews.forEach(lineView => lineView.mount());\n  }\n\n  /**\n   * Gets DOM elements mounted by the view.\n   */\n  getDOM(): PageViewDOMElements {\n    return {\n      domPage: this.domPage!,\n      domPageContent: this.domPageContent!,\n    };\n  }\n\n  /**\n   * Gets the height of the view.\n   */\n  getHeight(): number {\n    return this.config.height;\n  }\n\n  /**\n   * Maps a model position range to view position boxes.\n   * @param from - Left-bound of the model position range.\n   * @param to - Right-bound of the model position range.\n   */\n  mapModelPositionRangeToViewPositionBoxes(from: number, to: number): PageViewPositionBox[] {\n    // Iterate through lines to break up model position range\n    const viewPositionBoxes: PageViewPositionBox[] = [];\n    let offset = 0;\n    let cumulatedHeight = 0;\n    for (let n = 0, nn = this.lineViews.length; n < nn; n++) {\n      const lineView = this.lineViews[n];\n      // If overlap between position range and line\n      if (to >= offset && from < offset + lineView.getSize()) {\n        // Get line view position boxes\n        const lineViewPositionBox = lineView.mapModelPositionRangeToViewPositionBox(\n          Math.max(0, from - offset),\n          Math.min(lineView.getSize(), to - offset),\n        );\n        // Map line view position box to document view position box\n        viewPositionBoxes.push({\n          x1: lineViewPositionBox.x1,\n          y1: cumulatedHeight,\n          x2: lineViewPositionBox.x2,\n          y2: cumulatedHeight + lineViewPositionBox.height,\n        });\n      }\n      offset += lineView.getSize();\n      cumulatedHeight += lineView.getHeight();\n    }\n    return viewPositionBoxes;\n  }\n\n  /**\n   * Maps a view position to model position.\n   * @param x - X-coordinate of the view position.\n   * @param y - Y-coordinate of the view position.\n   */\n  mapViewPositionToModelPosition(x: number, y: number): number {\n    // Iterate through lines until the line that contains the view position\n    // is found\n    let offset = 0;\n    let cumulatedHeight = 0;\n    for (let n = 0, nn = this.lineViews.length; n < nn; n++) {\n      const lineView = this.lineViews[n];\n      // If posterior of line is past Y-coordinate\n      if (cumulatedHeight + lineView.getHeight() >= y) {\n        // Get model position in line\n        const lineModelPosition = lineView.mapViewPositionToModelPosition(x);\n        // Map line model position to page model position\n        return offset + lineModelPosition;\n      }\n      offset += lineView.getSize();\n      cumulatedHeight += lineView.getHeight();\n    }\n    return offset - 1;\n  }\n\n  /**\n   * Resolves a flat model position to a view-aware position\n   * object.\n   * @param position - Flat model position to resolve.\n   */\n  resolveModelPosition(position: number): PageViewAwarePosition {\n    // Iterate through lines until the line that contains the view position\n    // is found\n    let offset = 0;\n    for (let n = 0, nn = this.lineViews.length; n < nn; n++) {\n      const lineView = this.lineViews[n];\n      // If posterior of line is past position\n      if (offset + lineView.getSize() > position) {\n        // Resolve model position in line\n        const lineViewAwarePosition = lineView.resolveModelPosition(position - offset);\n        // Map line view aware position to page view aware position\n        return {\n          ...lineViewAwarePosition,\n          pageView: this,\n          pageViewPosition: position,\n        };\n      }\n      offset += lineView.getSize();\n    }\n    throw new Error(`Cannot resolve page model position ${position}.`);\n  }\n}\n","import CursorTransformationStep from './CursorTransformationStep';\n\n/**\n * Describes a cursor transformation as a series\n * of steps.\n */\nexport default class CursorTransformation {\n  private steps: CursorTransformationStep[] = [];\n\n  /**\n   * Create a new cursor transformation.\n   */\n  constructor() {\n    this.steps = [];\n  }\n\n  /**\n   * Add a step to the transformation.\n   */\n  addStep(step: CursorTransformationStep) {\n    this.steps.push(step);\n  }\n\n  /**\n   * Get all steps of the transformation.\n   */\n  getSteps(): CursorTransformationStep[] {\n    return this.steps;\n  }\n}\n","import CursorTransformationStep from '../CursorTransformationStep';\nimport { CursorTransformationExtraArgs } from '../../cursor/Cursor';\n\n/**\n * A transformation step for translating the cursor\n * by a certain displacement. The cursor head gets\n * displaced and the anchor gets moved to the head.\n */\nexport default class TranslateCursor implements CursorTransformationStep {\n  private displacement: number;\n  private preserveLineViewPosition: boolean;\n\n  /**\n   * Create a new move cursor anchor transformation step.\n   * @param displacement - Vector to displace the cursor anchor by.\n   * @param preserveLineViewPosition - Whether to preserve line view position.\n   */\n  constructor(displacement: number, preserveLineViewPosition: boolean = false) {\n    this.displacement = displacement;\n    this.preserveLineViewPosition = preserveLineViewPosition;\n  }\n\n  getType(): string {\n    return 'TranslateCursor';\n  }\n\n  getExtraArgs(): CursorTransformationExtraArgs {\n    return { preserveLineViewPosition: this.preserveLineViewPosition };\n  }\n\n  /**\n   * Get displacement vector.\n   */\n  getDisplacement(): number {\n    return this.displacement;\n  }\n}\n","import TaleWeaver from '../../TaleWeaver';\nimport CursorCommand from '../CursorCommand';\nimport CursorTransformation from '../../state/CursorTransformation';\nimport TranslateCursor from '../../state/cursortransformationsteps/TranslateCursor';\n\nexport default function moveToLineStart(): CursorCommand {\n  return (taleWeaver: TaleWeaver): CursorTransformation => {\n    const transformation = new CursorTransformation();\n    const editorCursor = taleWeaver.getState().getEditorCursor();\n    if (!editorCursor) {\n      return transformation;\n    }\n    const head = editorCursor.getHead();\n    const docView = taleWeaver.getDocView();\n    const viewAwarePosition = docView.resolveModelPosition(head);\n    if (viewAwarePosition.lineViewPosition > 0) {\n      transformation.addStep(new TranslateCursor(0 - viewAwarePosition.lineViewPosition));\n    }\n    return transformation;\n  };\n}\n","import TaleWeaver from '../../TaleWeaver';\nimport CursorCommand from '../CursorCommand';\nimport CursorTransformation from '../../state/CursorTransformation';\nimport TranslateCursor from '../../state/cursortransformationsteps/TranslateCursor';\n\nexport default function moveToLineEnd(): CursorCommand {\n  return (taleWeaver: TaleWeaver): CursorTransformation => {\n    const transformation = new CursorTransformation();\n    const editorCursor = taleWeaver.getState().getEditorCursor();\n    if (!editorCursor) {\n      return transformation;\n    }\n    const head = editorCursor.getHead();\n    const docView = taleWeaver.getDocView();\n    const viewAwarePosition = docView.resolveModelPosition(head);\n    if (viewAwarePosition.lineViewPosition < viewAwarePosition.lineView.getSize() - 1) {\n      transformation.addStep(new TranslateCursor(viewAwarePosition.lineView.getSize() - 1 - viewAwarePosition.lineViewPosition));\n    }\n    return transformation;\n  };\n}\n","import CursorTransformationStep from '../CursorTransformationStep';\nimport { CursorTransformationExtraArgs } from '../../cursor/Cursor';\n\n/**\n * A transformation step for translating the cursor head\n * by a certain displacement.\n */\nexport default class TranslateCursorHead implements CursorTransformationStep {\n  private displacement: number;\n  private preserveLineViewPosition: boolean;\n\n  /**\n   * Create a new move cursor head transformation step.\n   * @param displacement - Vector to displace the cursor head by.\n   * @param preserveLineViewPosition - Whether to preserve line view position.\n   */\n  constructor(displacement: number, preserveLineViewPosition: boolean = false) {\n    this.displacement = displacement;\n    this.preserveLineViewPosition = preserveLineViewPosition;\n  }\n\n  getType(): string {\n    return 'TranslateCursorHead';\n  }\n\n  getExtraArgs(): CursorTransformationExtraArgs {\n    return { preserveLineViewPosition: this.preserveLineViewPosition };\n  }\n\n  /**\n   * Get displacement vector.\n   */\n  getDisplacement(): number {\n    return this.displacement;\n  }\n}\n","import TaleWeaver from '../../TaleWeaver';\nimport CursorCommand from '../CursorCommand';\nimport CursorTransformation from '../../state/CursorTransformation';\nimport TranslateCursorHead from '../../state/cursortransformationsteps/TranslateCursorHead';\n\nexport default function moveHeadTo(position: number): CursorCommand {\n  return (taleWeaver: TaleWeaver): CursorTransformation => {\n    const transformation = new CursorTransformation();\n    const editorCursor = taleWeaver.getState().getEditorCursor();\n    if (!editorCursor) {\n      return transformation;\n    }\n    transformation.addStep(new TranslateCursorHead(position - editorCursor.getHead()));\n    return transformation;\n  };\n}\n","import TaleWeaver from '../../TaleWeaver';\nimport CursorCommand from '../CursorCommand';\nimport CursorTransformation from '../../state/CursorTransformation';\nimport TranslateCursorHead from '../../state/cursortransformationsteps/TranslateCursorHead';\n\nexport default function moveHeadToLineStart(): CursorCommand {\n  return (taleWeaver: TaleWeaver): CursorTransformation => {\n    const transformation = new CursorTransformation();\n    const editorCursor = taleWeaver.getState().getEditorCursor();\n    if (!editorCursor) {\n      return transformation;\n    }\n    const head = editorCursor.getHead();\n    const docView = taleWeaver.getDocView();\n    const viewAwarePosition = docView.resolveModelPosition(head);\n    if (viewAwarePosition.lineViewPosition > 0) {\n      transformation.addStep(new TranslateCursorHead(0 - viewAwarePosition.lineViewPosition));\n    }\n    return transformation;\n  };\n}\n","import TaleWeaver from '../../TaleWeaver';\nimport CursorCommand from '../CursorCommand';\nimport CursorTransformation from '../../state/CursorTransformation';\nimport TranslateCursorHead from '../../state/cursortransformationsteps/TranslateCursorHead';\n\nexport default function moveHeadRightByLine(): CursorCommand {\n  return (taleWeaver: TaleWeaver): CursorTransformation => {\n    const transformation = new CursorTransformation();\n    const editorCursor = taleWeaver.getState().getEditorCursor();\n    if (!editorCursor) {\n      return transformation;\n    }\n    const head = editorCursor.getHead();\n    const docView = taleWeaver.getDocView();\n    const viewAwarePosition = docView.resolveModelPosition(head);\n    if (viewAwarePosition.lineViewPosition < viewAwarePosition.lineView.getSize() - 1) {\n      transformation.addStep(new TranslateCursorHead(viewAwarePosition.lineView.getSize() - 1 - viewAwarePosition.lineViewPosition));\n    }\n    return transformation;\n  };\n}\n","import TaleWeaver from '../TaleWeaver';\nimport Cursor from '../cursor/Cursor';\nimport DocView from './DocView';\nimport { moveTo, moveHeadTo } from '../command/cursor';\nimport isElementInViewport from '../helpers/isElementInViewport';\n\nexport default class EditorCursorView {\n  private taleWeaver: TaleWeaver;\n  private editorCursor: Cursor;\n  private docView?: DocView;\n  private domHead?: HTMLElement;\n  private domSelections: HTMLElement[];\n  private selecting: boolean;\n  private blinkState: boolean;\n  private blinkInterval: NodeJS.Timeout | null;\n  private lineViewX: number | null;\n  private lastLineViewX: number;\n\n  constructor(taleWeaver: TaleWeaver, editorCursor: Cursor) {\n    this.taleWeaver = taleWeaver;\n    this.editorCursor = editorCursor;\n    this.domSelections = [];\n    this.selecting = false;\n    this.blinkState = false;\n    this.blinkInterval = null;\n    this.lineViewX = null;\n    this.lastLineViewX = 0;\n  }\n\n  private render(preserveLineViewPosition: boolean = false) {\n    this.renderHead(preserveLineViewPosition);\n    this.renderSelections();\n    this.updateNativeCursor();\n  }\n\n  private renderHead(preserveLineViewPosition: boolean) {\n    const editorCursor = this.editorCursor;\n    const head = editorCursor.getHead();\n    const viewPositionBoxes = this.docView!.mapModelPositionRangeToViewPositionBoxes(head, head);\n    const { pageView, pageViewPositionBox } = viewPositionBoxes[0];\n    const domHead = this.domHead!;\n    domHead.style.left = `${pageViewPositionBox.x1}px`;\n    domHead.style.top = `${pageViewPositionBox.y1}px`;\n    domHead.style.height = `${pageViewPositionBox.y2 - pageViewPositionBox.y1}px`;\n    const { domPageContent } = pageView.getDOM();\n    if (domHead.parentElement && domHead.parentElement !== domPageContent) {\n      domHead.parentElement!.removeChild(domHead);\n    }\n    if (!domHead.parentElement) {\n      domPageContent.appendChild(domHead);\n    }\n    if (preserveLineViewPosition) {\n      if (this.lineViewX === null) {\n        this.lineViewX = this.lastLineViewX;\n      }\n    } else {\n      this.lineViewX = null;\n    }\n    this.lastLineViewX = pageViewPositionBox.x1;\n\n    // Scroll view port to head if head is out of view port\n    if (!isElementInViewport(domHead)) {\n      domHead.scrollIntoView({ block: 'nearest' });\n    }\n  }\n\n  private renderSelections() {\n    const editorCursor = this.editorCursor;\n    const anchor = editorCursor.getAnchor();\n    const head = editorCursor.getHead();\n    const from = Math.min(anchor, head);\n    const to = Math.max(anchor, head);\n    const viewPositionBoxes = this.docView!.mapModelPositionRangeToViewPositionBoxes(from, to);\n    let selectionsCount = viewPositionBoxes.length;\n    while (this.domSelections.length > selectionsCount) {\n      const domSelection = this.domSelections.pop()!;\n      domSelection.parentElement!.removeChild(domSelection);\n    }\n    while (this.domSelections.length < selectionsCount) {\n      const domSelection = document.createElement('div');\n      domSelection.className = 'tw--editor-cursor-selection';\n      domSelection.style.position = 'absolute';\n      domSelection.style.background = 'hsla(217, 100%, 65%, 0.25)';\n      this.domSelections.push(domSelection);\n    }\n    let selectionIndex = 0;\n    viewPositionBoxes.forEach(({ pageView, pageViewPositionBox }) => {\n      const { domPageContent } = pageView.getDOM();\n      const domSelection = this.domSelections[selectionIndex]!;\n      domSelection.style.left = `${pageViewPositionBox.x1}px`;\n      domSelection.style.width = `${pageViewPositionBox.x2 - pageViewPositionBox.x1}px`;\n      domSelection.style.top = `${pageViewPositionBox.y1}px`;\n      domSelection.style.height = `${pageViewPositionBox.y2 - pageViewPositionBox.y1}px`;\n      domSelection.style.pointerEvents = 'none';\n      if (domSelection.parentElement && domSelection.parentElement !== domPageContent) {\n        domSelection.parentElement!.removeChild(domSelection);\n      }\n      if (!domSelection.parentElement) {\n        domPageContent.appendChild(domSelection);\n      }\n      selectionIndex++;\n    });\n  }\n\n  private updateNativeCursor() {\n    const docView = this.taleWeaver.getDocView();\n    const anchor = this.editorCursor.getAnchor();\n    const head = this.editorCursor.getHead();\n    const viewAwarePosition = docView.resolveModelPosition(anchor);\n    const { domWordContent } = viewAwarePosition.wordView.getDOM();\n    const selection = getSelection();\n    selection.removeAllRanges();\n    const range = document.createRange();\n    range.selectNode(domWordContent);\n    selection.addRange(range);\n  }\n\n  getLineViewX(): number | null {\n    return this.lineViewX;\n  }\n\n  setDocView(docView: DocView) {\n    this.docView = docView;\n  }\n\n  mount() {\n    if (!this.domHead) {\n      this.domHead = document.createElement('div');\n      this.domHead.className = 'tw--editor-cursor-head';\n      this.domHead.style.position = 'absolute';\n      this.domHead.style.width = '2px';\n      this.domHead.style.marginLeft = '-1px';\n      this.domHead.style.background = 'hsla(217, 100%, 65%, 1)';\n      this.domHead.style.visibility = 'hidden';\n    }\n    this.render();\n    this.startBlinking();\n    this.editorCursor.observe((editorCursor, extraArgs) => {\n      this.render(extraArgs.preserveLineViewPosition);\n      if (this.blinkInterval !== null) {\n        this.stopBlinking();\n        this.startBlinking();\n      }\n    });\n  }\n\n  getEditorCursor(): Cursor {\n    return this.editorCursor;\n  }\n\n  getDocView(): DocView {\n    return this.docView!;\n  }\n\n  startBlinking() {\n    if (this.blinkInterval !== null) {\n      return;\n    }\n    this.blinkInterval = setInterval(() => {\n      if (this.blinkState) {\n        this.domHead!.style.visibility = 'hidden';\n      } else {\n        this.domHead!.style.visibility = 'visible';\n      }\n      this.blinkState = !this.blinkState;\n    }, 500);\n  }\n\n  stopBlinking() {\n    if (this.blinkInterval === null) {\n      return;\n    }\n    this.blinkState = true;\n    this.domHead!.style.visibility = 'visible';\n    clearInterval(this.blinkInterval);\n    this.blinkInterval = null;\n  }\n\n  beginSelect(position: number) {\n    this.taleWeaver.getState().applyEditorCursorTransformation(moveTo(position)(this.taleWeaver));\n    this.selecting = true;\n    this.stopBlinking();\n  }\n\n  moveSelect(position: number) {\n    if (this.selecting) {\n      this.taleWeaver.getState().applyEditorCursorTransformation(moveHeadTo(position)(this.taleWeaver));\n    }\n  }\n\n  endSelect(position: number) {\n    this.taleWeaver.getState().applyEditorCursorTransformation(moveHeadTo(position)(this.taleWeaver));\n    this.selecting = false;\n    this.startBlinking();\n  }\n}\n","export default function isElementInViewport(element: HTMLElement) {\n  const rect = element.getBoundingClientRect();\n  return (\n      rect.top >= 0 &&\n      rect.left >= 0 &&\n      rect.bottom <= (window.innerHeight || document.documentElement!.clientHeight) &&\n      rect.right <= (window.innerWidth || document.documentElement!.clientWidth)\n  );\n}\n","import TaleWeaver from '../../TaleWeaver';\nimport CursorCommand from '../CursorCommand';\nimport CursorTransformation from '../../state/CursorTransformation';\nimport TranslateCursor from '../../state/cursortransformationsteps/TranslateCursor';\n\nexport default function moveTo(position: number): CursorCommand {\n  return (taleWeaver: TaleWeaver): CursorTransformation => {\n    const transformation = new CursorTransformation();\n    const editorCursor = taleWeaver.getState().getEditorCursor();\n    if (!editorCursor) {\n      return transformation;\n    }\n    transformation.addStep(new TranslateCursor(position - editorCursor.getHead()));\n    return transformation;\n  };\n}\n","export default interface Event {}\n\nexport class KeyPressEvent implements Event {\n  public readonly key: string;\n  public readonly shift: boolean;\n  public readonly meta: boolean;\n  public readonly alt: boolean;\n\n  constructor(key: string, shift: boolean, meta: boolean, alt: boolean) {\n    this.key = key;\n    this.shift = shift;\n    this.meta = meta;\n    this.alt = alt;\n  }\n}\n","import TaleWeaver from '../TaleWeaver';\nimport Doc from '../model/Doc';\nimport Block from '../model/block/Block';\nimport throttle from '../helpers/throttle';\nimport PageView, { PageViewPositionBox, PageViewAwarePosition } from './PageView';\nimport WordView from './WordView';\nimport LineView from './LineView';\nimport EditorCursorView from './EditorCursorView';\nimport { KeyPressEvent } from '../event/Event';\n\n/**\n * Box views of a block element, useful\n * as an intermediate data structure\n * where the word views can be further\n * broken down into line views.\n */\ninterface WordViewBlock {\n  block: Block;\n  wordViews: WordView[];\n};\n\n/**\n * Document view configs.\n */\ninterface DocViewConfig {\n  /** Width of a page in the document. */\n  pageWidth: number;\n  /** Height of a page in the document. */\n  pageHeight: number;\n  /** Topping padding of a page in the document. */\n  pagePaddingTop: number;\n  /** Bottom padding of a page in the document. */\n  pagePaddingBottom: number;\n  /** Left padding of a page in the document. */\n  pagePaddingLeft: number;\n  /** Right padding of a page in the document. */\n  pagePaddingRight: number;\n};\n\nexport interface DocViewDOMElements {\n  domDocument: HTMLDivElement;\n  domDocumentContent: HTMLDivElement;\n}\n\nexport interface DocViewPositionBox {\n  pageView: PageView;\n  pageViewPositionBox: PageViewPositionBox;\n};\n\nexport interface DocViewAwarePosition extends PageViewAwarePosition {\n  docView: DocView;\n  docViewPosition: number;\n};\n\n/**\n * View of a document.\n */\nexport default class DocView {\n  private taleWeaver: TaleWeaver;\n  private doc: Doc;\n  private config: DocViewConfig;\n\n  private wordViewBlocks: WordViewBlock[];\n  private lineViews: LineView[];\n  private pageViews: PageView[];\n  private editorCursorView: EditorCursorView | null;\n\n  private mounted: boolean;\n  private domDocument?: HTMLDivElement;\n  private domDocumentContent?: HTMLDivElement;\n\n  /**\n   * Creates a new document view instance.\n   * @param taleWeaver - A TaleWeaver instance.\n   * @param config - Configs for the document view.\n   */\n  constructor(taleWeaver: TaleWeaver, doc: Doc, config: DocViewConfig) {\n    this.taleWeaver = taleWeaver;\n    this.doc = doc;\n    this.config = config;\n\n    this.wordViewBlocks = [];\n    this.lineViews = [];\n    this.pageViews = [];\n    this.editorCursorView = null;\n\n    this.mounted = false;\n    \n    // Build child views\n    this.buildWordViewBlocks();\n    this.buildLineViews();\n    this.buildPageViews();\n    this.buildEditorCursorView();\n  }\n\n  /**\n   * Gets the model size of the document.\n   */\n  getSize(): number {\n    return this.doc.getSize();\n  }\n\n  /**\n   * Gets the child page views.\n   */\n  getPageViews(): PageView[] {\n    return this.pageViews;\n  }\n\n  /**\n   * Gets the child editor cursor view.\n   */\n  getEditorCursorView(): EditorCursorView | null {\n    return this.editorCursorView;\n  }\n\n  /**\n   * Mounts the view to DOM.\n   * @param domWrapper - DOM wrapper for the document view.\n   */\n  mount(domWrapper: HTMLElement) {\n    // Do not mount if already mounted\n    if (this.mounted) {\n      return;\n    }\n\n    // Build document element\n    this.domDocument = document.createElement('div');\n    this.domDocument.className = 'tw--document';\n    this.domDocument.contentEditable = 'true';\n    this.domDocument.spellcheck = false;\n    this.domDocument.style.outline = 'none';\n    // @ts-ignore: caret-color is a valid CSS property\n    // this.domDocumentContent.style.caretColor = 'transparent';\n    domWrapper.appendChild(this.domDocument);\n\n    // Build document content element\n    this.domDocumentContent = document.createElement('div');\n    this.domDocumentContent.className = 'tw--document-content';\n    this.domDocument.appendChild(this.domDocumentContent);\n\n    // Mount page views\n    this.pageViews.forEach(pageView => pageView.mount());\n\n    // Mount editor cursor view\n    this.editorCursorView!.mount();\n\n    // Attach event listeners\n    this.domDocument.addEventListener('contextmenu', this.handleContextMenu);\n    this.domDocument.addEventListener('mousedown', this.handleMouseDown);\n    this.domDocument.addEventListener('mousemove', this.handleMouseMove);\n    window.addEventListener('mouseup', this.handleMouseUp);\n    window.addEventListener('keydown', this.handleKeyDown);\n    window.addEventListener('keyup', this.handleKeyUp);\n  }\n\n  /**\n   * Gets DOM elements mounted by the view.\n   */\n  getDOM(): DocViewDOMElements {\n    return {\n      domDocument: this.domDocument!,\n      domDocumentContent: this.domDocumentContent!,\n    };\n  }\n\n  /**\n   * Maps a model position range to view position boxes.\n   * @param from - Left-bound of the model position range.\n   * @param to - Right-bound of the model position range.\n   */\n  mapModelPositionRangeToViewPositionBoxes(from: number, to: number): DocViewPositionBox[] {\n    // Iterate through pages to break up model position range\n    const viewPositionBoxes: DocViewPositionBox[] = [];\n    let offset = 0;\n    for (let n = 0, nn = this.pageViews.length; n < nn; n++) {\n      const pageView = this.pageViews[n];\n      // If overlap between position range and page\n      if (to >= offset && from < offset + pageView.getSize()) {\n        // Get page view position boxes\n        const pageViewPositionBoxes = pageView.mapModelPositionRangeToViewPositionBoxes(\n          Math.max(0, from - offset),\n          Math.min(pageView.getSize(), to - offset),\n        );\n        // Map page view position boxes to document view position boxes\n        pageViewPositionBoxes.forEach(pageViewPositionBox => {\n          viewPositionBoxes.push({\n            pageView,\n            pageViewPositionBox,\n          });\n        });\n      }\n      offset += pageView.getSize();\n    }\n    return viewPositionBoxes;\n  }\n\n  /**\n   * Maps a view position to model position.\n   * @param x - X-coordinate of the view position.\n   * @param y - Y-coordinate of the view position.\n   */\n  mapViewPositionToModelPosition(x: number, y: number): number {\n    // Iterate through pages until the page that contains the view position\n    // is found\n    let offset = 0;\n    const clientRects: ClientRect[] = [];\n    const offsets: number[] = [];\n    for (let n = 0, nn = this.pageViews.length; n < nn; n++) {\n      const pageView = this.pageViews[n];\n      // Get page bounding client rect\n      const { domPageContent } = pageView.getDOM();\n      clientRects.push(domPageContent.getBoundingClientRect());\n      offsets.push(offset);\n      offset += pageView.getSize();\n    }\n    // Find page view closest to the view position\n    const sqDistances = clientRects.map(clientRect => {\n      const xDistance = Math.max(Math.max(clientRect.left - x, 0), Math.max(x - (clientRect.left + clientRect.width), 0));\n      const yDistance = Math.max(Math.max(clientRect.top - y, 0), Math.max(y - (clientRect.top + clientRect.height), 0));\n      return xDistance * xDistance + yDistance * yDistance;\n    });\n    const index = sqDistances.indexOf(Math.min(...sqDistances));\n    // Map position on closest page\n    const pageView = this.pageViews[index];\n    const clientRect = clientRects[index];\n    const pageModelPosition = pageView.mapViewPositionToModelPosition(\n      Math.min(Math.max(x - clientRect.left, 0), clientRect.width),\n      Math.min(Math.max(y - clientRect.top, 0), clientRect.height),\n    );\n    return offsets[index] + pageModelPosition;\n  }\n\n  /**\n   * Resolves a flat model position to a view-aware position\n   * object.\n   * @param position - Flat model position to resolve.\n   */\n  resolveModelPosition(position: number): DocViewAwarePosition {\n    // Iterate through pages until the page that contains the view position\n    // is found\n    let offset = 0;\n    for (let n = 0, nn = this.pageViews.length; n < nn; n++) {\n      const pageView = this.pageViews[n];\n      // If posterior of page is past position\n      if (offset + pageView.getSize() > position) {\n        // Resolve model position in page\n        const pageViewAwarePosition = pageView.resolveModelPosition(position - offset);\n        // Map page view aware position to document view aware position\n        return {\n          ...pageViewAwarePosition,\n          docView: this,\n          docViewPosition: position,\n        };\n      }\n      offset += pageView.getSize();\n    }\n    throw new Error(`Cannot resolve document model position ${position}.`);\n  }\n\n  /**\n   * Builds word views for each block element in\n   * the document.\n   */\n  private buildWordViewBlocks() {\n    const registry = this.taleWeaver.getRegistry();\n    // Reset wordViewBlocks\n    this.wordViewBlocks.length = 0;\n    // Loop through block elements in the document\n    this.doc.getChildren().forEach(block => {\n      const wordViewBlock: WordViewBlock = {\n        block,\n        wordViews: [],\n      };\n      // Loop through inline elements in the block element\n      block.getChildren().forEach(word => {\n        // Build word view from word\n        const WordView = registry.getWordViewClass(word.getType())!;\n        const wordView = new WordView(word, {});\n        wordViewBlock.wordViews.push(wordView);\n      });\n      this.wordViewBlocks.push(wordViewBlock);\n    });\n  }\n\n  /**\n   * Builds line views from word views, should not\n   * be called unless buildWordViewBlocks was called.\n   */\n  private buildLineViews() {\n    // Reset lineViews\n    this.lineViews.length = 0;\n    const registry = this.taleWeaver.getRegistry();\n    // Determine page content width as width minus paddings\n    const pageContentWidth = this.config.pageWidth - this.config.pagePaddingLeft - this.config.pagePaddingRight;\n    // Loop through blocks of word views\n    this.wordViewBlocks.forEach(wordViewBlock => {\n      // Build line views for block\n      const LineView = registry.getLineViewClass(wordViewBlock.block.getType())!;\n      let lineView = new LineView({\n        width: this.config.pageWidth - this.config.pagePaddingLeft - this.config.pagePaddingRight,\n      });\n      this.lineViews.push(lineView);\n      let cumulatedWidth = 0;\n      // Loop through word views in block\n      wordViewBlock.wordViews.forEach(wordView => {\n        // Start new line if current line i is full\n        if (cumulatedWidth + wordView.getWidth() > pageContentWidth) {\n          lineView = new LineView({\n            width: this.config.pageWidth - this.config.pagePaddingLeft - this.config.pagePaddingRight,\n          });\n          this.lineViews.push(lineView);\n          cumulatedWidth = 0;\n        }\n        // Append word view to current line view\n        wordView.setLineView(lineView);\n        lineView.appendWordView(wordView);\n        cumulatedWidth += wordView.getWidth();\n      });\n    });\n  }\n\n  /**\n   * Builds page views from line views, should not\n   * be called unless buildLineViews was called.\n   */\n  private buildPageViews() {\n    // Reset pageViews\n    this.pageViews.length = 0;\n    // Build page views\n    const pageViewConigs = {\n      width: this.config.pageWidth,\n      height: this.config.pageHeight,\n      paddingTop: this.config.pagePaddingTop,\n      paddingBottom: this.config.pagePaddingBottom,\n      paddingLeft: this.config.pagePaddingLeft,\n      paddingRight: this.config.pagePaddingRight,\n    };\n    let pageView = new PageView(this, pageViewConigs);\n    this.pageViews.push(pageView);\n    let cumulatedHeight = 0;\n    // Determine page content height as height minus paddings\n    const pageContentHeight = this.config.pageHeight - this.config.pagePaddingTop - this.config.pagePaddingBottom;\n    // Loop through line views\n    this.lineViews.forEach(lineView => {\n      // Start new page if current page is full\n      if (cumulatedHeight + lineView.getHeight() > pageContentHeight) {\n        pageView = new PageView(this, pageViewConigs);\n        this.pageViews.push(pageView);\n        cumulatedHeight = 0;\n      }\n      // Append line view to page view\n      lineView.setPageView(pageView);\n      pageView.appendLineView(lineView);\n      cumulatedHeight += lineView.getHeight();\n    });\n  }\n\n  /**\n   * Builds editor cursor views.\n   */\n  private buildEditorCursorView() {\n    const editorCursor = this.taleWeaver.getState().getEditorCursor();\n    if (!editorCursor) {\n      return;\n    }\n    this.editorCursorView = new EditorCursorView(this.taleWeaver!, editorCursor);\n    this.editorCursorView.setDocView(this);\n  }\n\n  private handleContextMenu = (event: Event) => {\n    // Disable browser context menu functionality\n    event.preventDefault();\n  }\n\n  /**\n   * Handles mouse down DOM event.\n   */\n  private handleMouseDown = (event: MouseEvent) => {\n    event.preventDefault();\n    // No need to handle mouse down if no editor cursor\n    if (!this.editorCursorView) {\n      return;\n    }\n    const position = this.mapViewPositionToModelPosition(event.clientX, event.clientY);\n    this.editorCursorView.beginSelect(position);\n  }\n\n  /**\n   * Handles mouse move DOM event.\n   */\n  private handleMouseMove = throttle((event: MouseEvent) => {\n    // No need to handle mouse down if no editor cursor\n    if (!this.editorCursorView) {\n      return;\n    }\n    const position = this.mapViewPositionToModelPosition(event.clientX, event.clientY);\n    this.editorCursorView.moveSelect(position);\n  }, 5)\n\n  /**\n   * Handles mouse up DOM event.\n   */\n  private handleMouseUp = (event: MouseEvent) => {\n    // No need to handle mouse down if no editor cursor\n    if (!this.editorCursorView) {\n      return;\n    }\n    const position = this.mapViewPositionToModelPosition(event.clientX, event.clientY);\n    this.editorCursorView.endSelect(position);\n  }\n\n  /**\n   * Handles key down DOM event.\n   */\n  private handleKeyDown = (event: KeyboardEvent) => {\n    this.taleWeaver.getState().dispatchEvent(new KeyPressEvent(event.key, event.shiftKey, event.metaKey, event.altKey));\n    event.preventDefault();\n  }\n\n  /**\n   * Handles key up DOM event.\n   */\n  private handleKeyUp = (event: KeyboardEvent) => {\n  }\n}\n","/**\n * Throttles a function so that it runs at most\n * once per specified number of milliseconds.\n */\nexport default function throttle(func: (...args: any) => void, milliseconds: number) {\n  let throttledRunTimeout: NodeJS.Timeout;\n  let lastRunAt: number;\n  return (...args: any) => {\n    if (!lastRunAt) {\n      func(...args);\n      lastRunAt = Date.now();\n    } else {\n      clearTimeout(throttledRunTimeout);\n      throttledRunTimeout = setTimeout(() => {\n        func(...args);\n        lastRunAt = Date.now();\n      }, milliseconds - (Date.now() - lastRunAt));\n    }\n  };\n}\n","import LineView, { LineViewDOMElements, LineViewConfig } from './LineView';\n\nexport default class ParagraphLineView extends LineView {\n  private domParagraphLine?: HTMLDivElement;\n  private mounted: boolean;\n\n  constructor(config: LineViewConfig) {\n    super(config);\n    this.mounted = false;\n  }\n\n  mount() {\n    if (this.mounted) {\n      return;\n    }\n    // Get wrapper element\n    const { domPageContent } = this.getPageView().getDOM();\n\n    // Build line element\n    this.domParagraphLine = document.createElement('div');\n    this.domParagraphLine.className = 'tw--paragraph-line';\n    domPageContent.appendChild(this.domParagraphLine);\n\n    // Mount word views\n    this.wordViews.forEach(wordView => wordView.mount());\n  }\n\n  getDOM(): LineViewDOMElements {\n    return {\n      domLine: this.domParagraphLine!,\n      domLineContent: this.domParagraphLine!,\n    };\n  }\n}\n","import PageView from './PageView';\nimport WordView, { WordViewAwarePosition } from './WordView';\n\n/**\n * Line view configs.\n */\nexport interface LineViewConfig {\n  width: number;\n}\n\nexport interface LineViewDOMElements {\n  domLine: HTMLElement;\n  domLineContent: HTMLElement;\n}\n\n/**\n * Describes a screen selection within a line view.\n */\nexport interface LineViewPositionBox {\n  x1: number;\n  x2: number;\n  height: number;\n}\n\nexport interface LineViewAwarePosition extends WordViewAwarePosition {\n  lineView: LineView;\n  lineViewPosition: number;\n};\n\n/**\n * Abstract class for line views.\n */\nexport default abstract class LineView {\n  /** Config for the line view. */\n  protected config: LineViewConfig;\n  /** Parent page view. */\n  protected pageView?: PageView;\n  /** Child word views. */\n  protected wordViews: WordView[];\n\n  /**\n   * Creates a new line view instance.\n   * @param config - Config for the line view.\n   */\n  constructor(config: LineViewConfig) {\n    this.config = config;\n    this.wordViews = [];\n  }\n\n  /**\n   * Gets the size of the line in the document.\n   */\n  getSize(): number {\n    let size = 0;\n    this.wordViews!.forEach(wordView => size += wordView.getSize());\n    return size;\n  }\n\n  /**\n   * Sets the parent page view.\n   * @param pageView - Parent page view.\n   */\n  setPageView(pageView: PageView) {\n    this.pageView = pageView;\n  }\n\n  /**\n   * Gets the parent page view.\n   */\n  getPageView(): PageView {\n    return this.pageView!;\n  }\n\n  /**\n   * Gets the previous line view in the parent page view.\n   */\n  getPreviousLineView(): LineView | null {\n    const lineViews = this.pageView!.getLineViews();\n    const index = lineViews.indexOf(this);\n\n    // Short circuit if line view is not found in the parent\n    // page view\n    if (index < 0) {\n      return null;\n    }\n\n    // If this is the first line of the page, try to move\n    // to last line of previous page\n    if (index === 0) {\n      const previousPageView = this.pageView!.getPreviousPageView();\n      if (!previousPageView) {\n        return null;\n      }\n      const previousPageLineViews = previousPageView.getLineViews();\n      return previousPageLineViews[previousPageLineViews.length - 1];\n    }\n    return lineViews[index - 1];\n  }\n\n  /**\n   * Gets the next line view in the parent page view.\n   */\n  getNextLineView(): LineView | null {\n    const lineViews = this.pageView!.getLineViews();\n    const index = lineViews.indexOf(this);\n\n    // Short circuit if line view is not found in the parent\n    // page view\n    if (index < 0) {\n      return null;\n    }\n\n    // If this is the last line of the page, try to move\n    // to first line of next page\n    if (index === lineViews.length - 1) {\n      const nextPageView = this.pageView!.getNextPageView();\n      if (!nextPageView) {\n        return null;\n      }\n      const nextPageLineViews = nextPageView.getLineViews();\n      return nextPageLineViews[0];\n    }\n    return lineViews[index + 1];\n  }\n\n  /**\n   * Appends a child word view.\n   * @param wordView - Child word view to append.\n   */\n  appendWordView(wordView: WordView) {\n    this.wordViews.push(wordView);\n  }\n\n  /**\n   * Removes a child word view.\n   * @param wordView - Child word view to remove.\n   */\n  removeWordView(wordView: WordView) {\n    const index = this.wordViews.indexOf(wordView);\n    if (index < 0) {\n      return;\n    }\n    this.wordViews.splice(index, 1);\n  }\n\n  /**\n   * Gets the child word views.\n   */\n  getWordViews(): WordView[] {\n    return this.wordViews;\n  }\n\n  /**\n   * Mounts the view to DOM.\n   */\n  abstract mount(): void;\n\n  /**\n   * Gets DOM elements mounted by the view.\n   */\n  abstract getDOM(): LineViewDOMElements;\n\n  /**\n   * Gets the height of the view.\n   */\n  getHeight(): number {\n    return Math.max(...this.wordViews.map(wordView => wordView.getHeight()));\n  }\n\n  /**\n   * Maps a model position range to view position boxes.\n   * @param from - Left-bound of the model position range.\n   * @param to - Right-bound of the model position range.\n   */\n  mapModelPositionRangeToViewPositionBox(from: number, to: number): LineViewPositionBox {\n    // Iterate through words to break up model position range\n    const viewPositionBox: LineViewPositionBox = {\n      x1: -1,\n      x2: -1,\n      height: 0,\n    };\n    let offset = 0;\n    let cumulatedWidth = 0;\n    for (let n = 0, nn = this.wordViews.length; n < nn; n++) {\n      const wordView = this.wordViews[n];\n      // If overlap between position range and word\n      if (to >= offset && from < offset + wordView.getSize()) {\n        const wordViewPositionBox = wordView.mapModelPositionRangeToViewPositionBox(\n          Math.max(0, from - offset),\n          Math.min(wordView.getSize(), to - offset),\n        );\n        if (offset <= from && offset + wordView.getSize() > from) {\n          viewPositionBox.x1 = cumulatedWidth + wordViewPositionBox.x1;\n        }\n        if (offset <= to && offset + wordView.getSize() >= to) {\n          viewPositionBox.x2 = cumulatedWidth + wordViewPositionBox.x2;\n        }\n        if (viewPositionBox.height < wordViewPositionBox.height) {\n          viewPositionBox.height = wordViewPositionBox.height;\n        }\n      }\n      offset += wordView.getSize();\n      cumulatedWidth += wordView.getWidth();\n    }\n    return viewPositionBox;\n  }\n\n  /**\n   * Maps a view position to model position.\n   * @param x - X-coordinate of the view position.\n   */\n  mapViewPositionToModelPosition(x: number): number {\n    // Iterate through words until the word that contains the view position\n    // is found\n    let offset = 0;\n    let cumulatedWidth = 0;\n    for (let n = 0, nn = this.wordViews.length; n < nn; n++) {\n      const wordView = this.wordViews[n];\n      // If posterior of word is past X-coordinate\n      if (cumulatedWidth + wordView.getWidth() >= x) {\n        // Get model position in word\n        const wordModelPosition = wordView.mapViewPositionToModelPosition(x - cumulatedWidth);\n        // Map word model position to line model position\n        return offset + wordModelPosition;\n      }\n      offset += wordView.getSize();\n      cumulatedWidth += wordView.getWidth();\n    }\n    return offset - 1;\n  }\n\n  /**\n   * Resolves a flat model position to a view-aware position\n   * object.\n   * @param position - Flat model position to resolve.\n   */\n  resolveModelPosition(position: number): LineViewAwarePosition {\n    // Iterate through words until the word that contains the view position\n    // is found\n    let offset = 0;\n    for (let n = 0, nn = this.wordViews.length; n < nn; n++) {\n      const wordView = this.wordViews[n];\n      // If posterior of word is past position\n      if (offset + wordView.getSize() >= position) {\n        // Resolve model position in word\n        const wordViewAwarePosition = wordView.resolveModelPosition(position - offset);\n        // Map word view aware position to line view aware position\n        return {\n          ...wordViewAwarePosition,\n          lineView: this,\n          lineViewPosition: position,\n        };\n      }\n      offset += wordView.getSize();\n    }\n    throw new Error(`Cannot resolve line model position ${position}.`);\n  }\n}\n","import LineView from './LineView';\nimport Word from '../model/word/Word';\n\n/**\n * Word view config.\n */\nexport interface WordViewConfig {\n}\n\nexport interface WordViewDOMElements {\n  domWord: HTMLElement | Text;\n  domWordContent: HTMLElement | Text;\n}\n\n/**\n * Describes a screen selection within a word view.\n */\nexport interface WordViewPositionBox {\n  x1: number;\n  x2: number;\n  height: number;\n}\n\nexport interface WordViewAwarePosition {\n  wordView: WordView;\n  wordViewPosition: number;\n};\n\n/**\n * Abstract class for word views.\n */\nexport default abstract class WordView {\n  /** Config for the word view. */\n  protected config: WordViewConfig;\n  /** Word model. */\n  protected word: Word;\n  /** Parent line view. */\n  protected lineView?: LineView;\n  /** Rendered DOM element. */\n  protected domElement?: HTMLElement | Text;\n\n  /**\n   * Creates a new work view instance.\n   * @param config - Config for the word view.\n   */\n  constructor(word: Word, config: WordViewConfig) {\n    this.word = word;\n    this.config = config;\n  }\n\n  /**\n   * Gets the size of the word in the document.\n   */\n  getSize(): number {\n    return this.word.getSize();\n  }\n\n  /**\n   * Sets the parent line view.\n   * @param lineView - Parent line view.\n   */\n  setLineView(lineView: LineView) {\n    this.lineView = lineView;\n  }\n\n  /**\n   * Gets the parent line view.\n   */\n  getLineView(): LineView {\n    return this.lineView!;\n  }\n\n  /**\n   * Gets the previous word view in the parent line view.\n   */\n  getPreviousWordView(): WordView | null {\n    const wordViews = this.lineView!.getWordViews();\n    const index = wordViews.indexOf(this);\n\n    // Short circuit if word view is not found in the parent\n    // line view\n    if (index < 0) {\n      return null;\n    }\n\n    // If this is the first word of the line, try to move\n    // to last word of previous line\n    if (index === 0) {\n      const previousLineView = this.lineView!.getPreviousLineView();\n      if (!previousLineView) {\n        return null;\n      }\n      const previousLineWordViews = previousLineView.getWordViews();\n      return previousLineWordViews[previousLineWordViews.length - 1];\n    }\n    return wordViews[index - 1];\n  }\n\n  /**\n   * Gets the next word view in the parent line view.\n   */\n  getNextWordView(): WordView | null {\n    const wordViews = this.lineView!.getWordViews();\n    const index = wordViews.indexOf(this);\n\n    // Short circuit if word view is not found in the parent\n    // line view\n    if (index < 0) {\n      return null;\n    }\n\n    // If this is the last word of the line, try to move\n    // to first word of next line\n    if (index === wordViews.length - 1) {\n      const nextLineView = this.lineView!.getNextLineView();\n      if (!nextLineView) {\n        return null;\n      }\n      const nextLineWordViews = nextLineView.getWordViews();\n      return nextLineWordViews[0];\n    }\n    return wordViews[index + 1];\n  }\n\n  /**\n   * Mounts the view to DOM.\n   */\n  abstract mount(): void;\n\n  /**\n   * Gets DOM elements mounted by the view.\n   */\n  abstract getDOM(): WordViewDOMElements;\n\n  /**\n   * Gets the width of the word view.\n   */\n  abstract getWidth(): number;\n\n  /**\n   * Gets the height of the word view.\n   */\n  abstract getHeight(): number;\n\n  /**\n   * Maps a model position range to view position boxes.\n   * @param from - Left-bound of the model position range.\n   * @param to - Right-bound of the model position range.\n   */\n  abstract mapModelPositionRangeToViewPositionBox(from: number, to: number): WordViewPositionBox;\n\n  /**\n   * Maps a view position to model position.\n   * @param x - X-coordinate of the view position.\n   */\n  abstract mapViewPositionToModelPosition(x: number): number;\n\n  /**\n   * Resolves a flat model position to a view-aware position\n   * object.\n   * @param position - Flat model position to resolve.\n   */\n  resolveModelPosition(position: number): WordViewAwarePosition {\n    return {\n      wordView: this,\n      wordViewPosition: position,\n    };\n  }\n}\n","import TextStyle from './TextStyle';\n\ntype Measurement = {\n  width: number;\n  height: number;\n};\n\nfunction getTextStyleKey(textStyle: TextStyle): string {\n  return JSON.stringify(textStyle);\n}\n\nexport class TextMeasurer {\n  private $iframe: HTMLIFrameElement;\n  private $textContainers: Map<string, HTMLSpanElement>;\n\n  constructor() {\n    this.$iframe = document.createElement('iframe');\n    this.$iframe.src = 'about:blank';\n    this.$iframe.style.width = '0';\n    this.$iframe.style.height = '0';\n    this.$iframe.style.border = 'none';\n    document.body.appendChild(this.$iframe);\n    this.$textContainers = new Map<string, HTMLSpanElement>();\n  }\n\n  getTextContainerElement(textStyle: TextStyle): HTMLSpanElement {\n    const textStyleKey = getTextStyleKey(textStyle);\n    if (!this.$textContainers.has(textStyleKey)) {\n      const $textContainer = document.createElement('span');\n      $textContainer.style.display = 'inline-block';\n      $textContainer.style.whiteSpace = 'pre';\n      $textContainer.style.fontFamily = textStyle.fontFamily;\n      $textContainer.style.fontSize = `${textStyle.fontSize}px`;\n      $textContainer.style.fontWeight = `${textStyle.fontWeight}`;\n      $textContainer.style.lineHeight = `${textStyle.lineHeight}px`;\n      $textContainer.style.letterSpacing = `${textStyle.letterSpacing}`;\n      this.$iframe.contentDocument!.body.appendChild($textContainer);\n      this.$textContainers.set(textStyleKey, $textContainer);\n    }\n    const $textContainer = this.$textContainers.get(textStyleKey);\n    return $textContainer!;\n  }\n\n  measure(text: string, textStyle: TextStyle) {\n    // Substitute trailing new line with space\n    const adjustedText = text.replace(/\\n$/, ' ');\n    const $textContainer = this.getTextContainerElement(textStyle);\n    if ($textContainer.innerHTML !== adjustedText) {\n      $textContainer.innerHTML = adjustedText;\n    }\n    const boundingClientRect = $textContainer.getBoundingClientRect();\n    return {\n      width: boundingClientRect.width,\n      height: boundingClientRect.height,\n    };\n  }\n}\n\nconst textMeasurer = new TextMeasurer();\n\nexport default function measureText(text: string, textStyle: TextStyle): Measurement {\n  return textMeasurer.measure(text, textStyle);\n}\n","import WordView, { WordViewConfig, WordViewPositionBox, WordViewDOMElements } from './WordView';\nimport Word from '../model/word/Word';\nimport TextWord from '../model/word/TextWord';\nimport measureText from './helpers/measureText';\n\nconst placeholderTextStyle = {\n  fontFamily: 'Arial',\n  fontSize: 18,\n  fontWeight: 400,\n  lineHeight: 36,\n  letterSpacing: 0,\n};\n\n/**\n * View for a text word.\n */\nexport default class TextView extends WordView {\n  /** Cached width of the rendered text word */\n  private width?: number;\n  /** Cached height of the rendered text word */\n  private height?: number;\n  /** Whether the view is mounted to DOM. */\n  private mounted: boolean;\n  /** DOM text node. */\n  private domTextWord?: Text;\n\n  constructor(word: Word, config: WordViewConfig) {\n    super(word, config);\n    this.mounted = false;\n  }\n\n  mount() {\n    if (this.mounted) {\n      return;\n    }\n    const { domLineContent } = this.getLineView().getDOM();\n    const textWord = <TextWord> this.word;\n    this.domTextWord = document.createTextNode(textWord.getText());\n    domLineContent.appendChild(this.domTextWord);\n  }\n\n  getDOM(): WordViewDOMElements {\n    return {\n      domWord: this.domTextWord!,\n      domWordContent: this.domTextWord!,\n    };\n  }\n\n  getWidth(): number {\n    if (this.width === undefined) {\n      this.measure();\n    }\n    return this.width!;\n  }\n\n  getHeight(): number {\n    if (this.height === undefined) {\n      this.measure();\n    }\n    return this.height!;\n  }\n\n  mapModelPositionRangeToViewPositionBox(from: number, to: number): WordViewPositionBox {\n    return {\n      x1: this.getScreenX(from),\n      x2: this.getScreenX(to),\n      height: this.getHeight(),\n    };\n  }\n\n  mapViewPositionToModelPosition(x: number): number {\n    const textWord = <TextWord> this.word;\n    const text = textWord.getText();\n    let lastWidth = 0;\n    for (let n = 1, nn = text.length; n < nn; n++) {\n      const width = measureText(text.substring(0, n), placeholderTextStyle).width;\n      if (width > x) {\n        if (x - lastWidth > width - x) {\n          return n;\n        }\n        return n - 1;\n      }\n      lastWidth = width;\n    }\n    if (x === lastWidth) {\n      return text.length - 1;\n    }\n    return text.length;\n  }\n\n  /**\n   * Measures the dimensions of the rendered text word.\n   */\n  private measure() {\n    const textWord = <TextWord> this.word;\n    const measurement = measureText(textWord.getText(), placeholderTextStyle);\n    this.width = measurement.width;\n    this.height = measurement.height;\n  }\n\n  /**\n   * Gets screen x coordinate by document position.\n   * @param at - Document position within the text word.\n   */\n  private getScreenX(at: number): number {\n    const textWord = <TextWord> this.word;\n    const text = textWord.getText();\n    if (at === 0) {\n      return 0;\n    }\n    return measureText(text.substring(0, at), placeholderTextStyle).width;\n  }\n}\n","import Cursor from '../cursor/Cursor';\nimport CursorTransformation from './CursorTransformation';\nimport TranslateCursor from './cursortransformationsteps/TranslateCursor';\nimport TranslateCursorHead from './cursortransformationsteps/TranslateCursorHead';\n\n/**\n * Transformer for applying transformations\n * on cursors.\n */\nexport default class CursorTransformer {\n  /**\n   * Applies a transformation on a cursor.\n   * @param cursor - Cursor to apply transformation on.\n   * @param transformation - Transformation to apply.\n   */\n  apply(cursor: Cursor, transformation: CursorTransformation) {\n    const steps = transformation.getSteps();\n    steps.forEach(step => {\n      if (step instanceof TranslateCursor) {\n        cursor.moveTo(cursor.getHead() + step.getDisplacement(), step.getExtraArgs());\n      } else if (step instanceof TranslateCursorHead) {\n        cursor.moveHeadTo(cursor.getHead() + step.getDisplacement(), step.getExtraArgs());\n      } else {\n        throw new Error(`Unrecognized cursor transformation step: ${step.getType()}`);\n      }\n    });\n  }\n}\n","import DocumentTransformationStep from '../DocumentTransformationStep';\n\n/**\n * A transformation step for assigning content\n * to a word in the document.\n */\nexport default class Assign implements DocumentTransformationStep {\n  private text: string;\n\n  /**\n   * Create a new assign document transformation step.\n   * @param text - Text to assign to the inline element.\n   */\n  constructor(text: string) {\n    this.text = text;\n  }\n\n  getType(): string {\n    return 'Assign';\n  }\n\n  getText(): string {\n    return this.text;\n  }\n}\n","import Doc from '../model/Doc';\nimport DocumentTransformation from './DocumentTransformation';\nimport Assign from './documenttransformationsteps/Assign';\n\n/**\n * Transformer for applying transformations\n * on the document.\n */\nexport default class DocumentTransformer {\n  /**\n   * Applies a transformation on a document element.\n   * @param doc - Document element to apply transformation on.\n   * @param transformation - Transformation to apply.\n   */\n  apply(doc: Doc, transformation: DocumentTransformation) {\n    const steps = transformation.getSteps();\n    steps.forEach(step => {\n      if (step instanceof Assign) {\n        doc.getChildren()[0].getChildren()[0].setText(step.getText());\n      } else {\n        throw new Error(`Unrecognized document transformation step: ${step.getType()}`);\n      }\n    });\n  }\n}\n","import TaleWeaver from '../TaleWeaver';\nimport Event from './Event';\nimport CursorCommand from '../command/CursorCommand';\nimport DocumentCommand from '../command/DocumentCommand';\n\nexport default abstract class EventObserver {\n  protected taleWeaver: TaleWeaver;\n\n  constructor(taleWeaver: TaleWeaver) {\n    this.taleWeaver = taleWeaver;\n  }\n\n  dispatchCursorCommand(cursorCommand: CursorCommand) {\n    const cursorTransformation = cursorCommand(this.taleWeaver);\n    this.taleWeaver.getState().applyEditorCursorTransformation(cursorTransformation);\n  }\n\n  dispatchDocumentCommand(documentCommand: DocumentCommand) {\n    const documentTransformation = documentCommand(this.taleWeaver);\n    this.taleWeaver.getState().applyDocumentTransformation(documentTransformation);\n  }\n\n  abstract onEvent(event: Event): void;\n}\n","import EventObserver from './EventObserver';\nimport Event, { KeyPressEvent } from './Event';\nimport {\n  moveBackward,\n  moveForward,\n  moveBackwardByWord,\n  moveForwardByWord,\n  moveToLineStart,\n  moveToLineEnd,\n  moveToDocumentStart,\n  moveToDocumentEnd,\n  moveHeadBackward,\n  moveHeadForward,\n  moveHeadBackwardByWord,\n  moveHeadForwardByWord,\n  moveHeadToLineStart,\n  moveHeadToLineEnd,\n  moveHeadToDocumentStart,\n  moveHeadToDocumentEnd,\n  moveToPreviousLine,\n  moveToNextLine,\n  moveHeadToPreviousLine,\n  moveHeadToNextLine,\n} from '../command/cursor';\n\nexport default class EditorCursorEventObserver extends EventObserver {\n  onEvent(event: Event) {\n    if (event instanceof KeyPressEvent) {\n      const keyPressEvent = <KeyPressEvent> event;\n      if (keyPressEvent.key === 'ArrowLeft') {\n        if (keyPressEvent.shift) {\n          if (keyPressEvent.alt) {\n            this.dispatchCursorCommand(moveHeadBackwardByWord());\n          } else if (keyPressEvent.meta) {\n            this.dispatchCursorCommand(moveHeadToLineStart());\n          } else {\n            this.dispatchCursorCommand(moveHeadBackward());\n          }\n        } else {\n          if (keyPressEvent.alt) {\n            this.dispatchCursorCommand(moveBackwardByWord());\n          } else if (keyPressEvent.meta) {\n            this.dispatchCursorCommand(moveToLineStart());\n          } else {\n            this.dispatchCursorCommand(moveBackward());\n          }\n        }\n      } else if (keyPressEvent.key === 'ArrowRight') {\n        if (keyPressEvent.shift) {\n          if (keyPressEvent.alt) {\n            this.dispatchCursorCommand(moveHeadForwardByWord());\n          } else if (keyPressEvent.meta) {\n            this.dispatchCursorCommand(moveHeadToLineEnd());\n          } else {\n            this.dispatchCursorCommand(moveHeadForward());\n          }\n        } else {\n          if (keyPressEvent.alt) {\n            this.dispatchCursorCommand(moveForwardByWord());\n          } else if (keyPressEvent.meta) {\n            this.dispatchCursorCommand(moveToLineEnd());\n          } else {\n            this.dispatchCursorCommand(moveForward());\n          }\n        }\n      } else if (keyPressEvent.key === 'ArrowUp') {\n        if (keyPressEvent.shift) {\n          if (keyPressEvent.alt) {\n            this.dispatchCursorCommand(moveHeadToLineStart());\n          } else if (keyPressEvent.meta) {\n            this.dispatchCursorCommand(moveHeadToDocumentStart());\n          } else {\n            this.dispatchCursorCommand(moveHeadToPreviousLine());\n          }\n        } else {\n          if (keyPressEvent.alt) {\n            this.dispatchCursorCommand(moveToLineStart());\n          } else if (keyPressEvent.meta) {\n            this.dispatchCursorCommand(moveToDocumentStart());\n          } else {\n            this.dispatchCursorCommand(moveToPreviousLine());\n          }\n        }\n      } else if (keyPressEvent.key === 'ArrowDown') {\n        if (keyPressEvent.shift) {\n          if (keyPressEvent.alt) {\n            this.dispatchCursorCommand(moveHeadToLineEnd());\n          } else if (keyPressEvent.meta) {\n            this.dispatchCursorCommand(moveHeadToDocumentEnd());\n          } else {\n            this.dispatchCursorCommand(moveHeadToNextLine())\n          }\n        } else {\n          if (keyPressEvent.alt) {\n            this.dispatchCursorCommand(moveToLineEnd());\n          } else if (keyPressEvent.meta) {\n            this.dispatchCursorCommand(moveToDocumentEnd());\n          } else {\n            this.dispatchCursorCommand(moveToNextLine())\n          }\n        }\n      }\n    }\n  }\n}\n","import TaleWeaver from '../../TaleWeaver';\nimport CursorCommand from '../CursorCommand';\nimport CursorTransformation from '../../state/CursorTransformation';\nimport TranslateCursorHead from '../../state/cursortransformationsteps/TranslateCursorHead';\n\nexport default function moveHeadBackwardByWord(): CursorCommand {\n  return (taleWeaver: TaleWeaver): CursorTransformation => {\n    const transformation = new CursorTransformation();\n    const editorCursor = taleWeaver.getState().getEditorCursor();\n    if (!editorCursor) {\n      return transformation;\n    }\n    const head = editorCursor.getHead();\n    const docView = taleWeaver.getDocView();\n    const viewAwarePosition = docView.resolveModelPosition(head);\n    if (viewAwarePosition.wordViewPosition > 0) {\n      transformation.addStep(new TranslateCursorHead(0 - viewAwarePosition.wordViewPosition));\n    } else {\n      const previousWordView = viewAwarePosition.wordView.getPreviousWordView();\n      if (previousWordView) {\n        transformation.addStep(new TranslateCursorHead(0 - previousWordView.getSize()));\n      }\n    }\n    return transformation;\n  };\n}\n","import TaleWeaver from '../../TaleWeaver';\nimport CursorCommand from '../CursorCommand';\nimport CursorTransformation from '../../state/CursorTransformation';\nimport TranslateCursorHead from '../../state/cursortransformationsteps/TranslateCursorHead';\n\nexport default function moveHeadBackward(): CursorCommand {\n  return (taleWeaver: TaleWeaver): CursorTransformation => {\n    const transformation = new CursorTransformation();\n    const editorCursor = taleWeaver.getState().getEditorCursor();\n    if (!editorCursor) {\n      return transformation;\n    }\n    if (editorCursor.getHead() < 1) {\n      return transformation;\n    }\n    transformation.addStep(new TranslateCursorHead(-1));\n    return transformation;\n  };\n}\n","import TaleWeaver from '../../TaleWeaver';\nimport CursorCommand from '../CursorCommand';\nimport CursorTransformation from '../../state/CursorTransformation';\nimport TranslateCursor from '../../state/cursortransformationsteps/TranslateCursor';\n\nexport default function moveBackwardByWord(): CursorCommand {\n  return (taleWeaver: TaleWeaver): CursorTransformation => {\n    const transformation = new CursorTransformation();\n    const editorCursor = taleWeaver.getState().getEditorCursor();\n    if (!editorCursor) {\n      return transformation;\n    }\n    const head = editorCursor.getHead();\n    const docView = taleWeaver.getDocView();\n    const viewAwarePosition = docView.resolveModelPosition(head);\n    if (viewAwarePosition.wordViewPosition > 0) {\n      transformation.addStep(new TranslateCursor(0 - viewAwarePosition.wordViewPosition));\n    } else {\n      const previousWordView = viewAwarePosition.wordView.getPreviousWordView();\n      if (previousWordView) {\n        transformation.addStep(new TranslateCursor(0 - previousWordView.getSize()));\n      }\n    }\n    return transformation;\n  };\n}\n","import TaleWeaver from '../../TaleWeaver';\nimport CursorCommand from '../CursorCommand';\nimport CursorTransformation from '../../state/CursorTransformation';\nimport TranslateCursor from '../../state/cursortransformationsteps/TranslateCursor';\n\nexport default function moveBackward(): CursorCommand {\n  return (taleWeaver: TaleWeaver): CursorTransformation => {\n    const transformation = new CursorTransformation();\n    const editorCursor = taleWeaver.getState().getEditorCursor();\n    if (!editorCursor) {\n      return transformation;\n    }\n    const anchor = editorCursor.getAnchor();\n    const head = editorCursor.getHead();\n    if (anchor === head) {\n      if (head < 1) {\n        return transformation;\n      }\n      transformation.addStep(new TranslateCursor(-1));\n    } else {\n      if (anchor < head) {\n        transformation.addStep(new TranslateCursor(anchor - head));\n      } else if (anchor > head) {\n        transformation.addStep(new TranslateCursor(0));\n      }\n    }\n    return transformation;\n  };\n}\n","import TaleWeaver from '../../TaleWeaver';\nimport CursorCommand from '../CursorCommand';\nimport CursorTransformation from '../../state/CursorTransformation';\nimport TranslateCursorHead from '../../state/cursortransformationsteps/TranslateCursorHead';\n\nexport default function moveHeadForwardByWord(): CursorCommand {\n  return (taleWeaver: TaleWeaver): CursorTransformation => {\n    const transformation = new CursorTransformation();\n    const editorCursor = taleWeaver.getState().getEditorCursor();\n    if (!editorCursor) {\n      return transformation;\n    }\n    const head = editorCursor.getHead();\n    const docView = taleWeaver.getDocView();\n    const viewAwarePosition = docView.resolveModelPosition(head);\n    if (viewAwarePosition.wordViewPosition < viewAwarePosition.wordView.getSize()) {\n      transformation.addStep(new TranslateCursorHead(viewAwarePosition.wordView.getSize() - viewAwarePosition.wordViewPosition));\n    } else {\n      const nextWordView = viewAwarePosition.wordView.getNextWordView();\n      if (nextWordView) {\n        transformation.addStep(new TranslateCursorHead(nextWordView.getSize()));\n      }\n    }\n    return transformation;\n  };\n}\n","import TaleWeaver from '../../TaleWeaver';\nimport CursorCommand from '../CursorCommand';\nimport CursorTransformation from '../../state/CursorTransformation';\nimport TranslateCursorHead from '../../state/cursortransformationsteps/TranslateCursorHead';\n\nexport default function moveHeadForward(): CursorCommand {\n  return (taleWeaver: TaleWeaver): CursorTransformation => {\n    const transformation = new CursorTransformation();\n    const editorCursor = taleWeaver.getState().getEditorCursor();\n    if (!editorCursor) {\n      return transformation;\n    }\n    if (editorCursor.getHead() > taleWeaver.getState().getDoc().getSize() - 1) {\n      return transformation;\n    }\n    transformation.addStep(new TranslateCursorHead(1));\n    return transformation;\n  };\n}\n","import TaleWeaver from '../../TaleWeaver';\nimport CursorCommand from '../CursorCommand';\nimport CursorTransformation from '../../state/CursorTransformation';\nimport TranslateCursor from '../../state/cursortransformationsteps/TranslateCursor';\n\nexport default function moveForwardByWord(): CursorCommand {\n  return (taleWeaver: TaleWeaver): CursorTransformation => {\n    const transformation = new CursorTransformation();\n    const editorCursor = taleWeaver.getState().getEditorCursor();\n    if (!editorCursor) {\n      return transformation;\n    }\n    const head = editorCursor.getHead();\n    const docView = taleWeaver.getDocView();\n    const viewAwarePosition = docView.resolveModelPosition(head);\n    if (viewAwarePosition.wordViewPosition < viewAwarePosition.wordView.getSize()) {\n      transformation.addStep(new TranslateCursor(viewAwarePosition.wordView.getSize() - viewAwarePosition.wordViewPosition));\n    } else {\n      const nextWordView = viewAwarePosition.wordView.getNextWordView();\n      if (nextWordView) {\n        transformation.addStep(new TranslateCursor(nextWordView.getSize()));\n      }\n    }\n    return transformation;\n  };\n}\n","import TaleWeaver from '../../TaleWeaver';\nimport CursorCommand from '../CursorCommand';\nimport CursorTransformation from '../../state/CursorTransformation';\nimport TranslateCursor from '../../state/cursortransformationsteps/TranslateCursor';\n\nexport default function moveForward(): CursorCommand {\n  return (taleWeaver: TaleWeaver): CursorTransformation => {\n    const transformation = new CursorTransformation();\n    const editorCursor = taleWeaver.getState().getEditorCursor();\n    if (!editorCursor) {\n      return transformation;\n    }\n    const anchor = editorCursor.getAnchor();\n    const head = editorCursor.getHead();\n    if (anchor === head) {\n      const documentSize = taleWeaver.getState().getDoc().getSize();\n      if (head > documentSize - 1) {\n        return transformation;\n      }\n      transformation.addStep(new TranslateCursor(1));\n    } else {\n      if (anchor < head) {\n        transformation.addStep(new TranslateCursor(0));\n      } else if (anchor > head) {\n        transformation.addStep(new TranslateCursor(anchor - head));\n      }\n    }\n    return transformation;\n  };\n}\n","import TaleWeaver from '../../TaleWeaver';\nimport CursorCommand from '../CursorCommand';\nimport CursorTransformation from '../../state/CursorTransformation';\nimport TranslateCursorHead from '../../state/cursortransformationsteps/TranslateCursorHead';\n\nexport default function moveHeadToDocumentStart(): CursorCommand {\n  return (taleWeaver: TaleWeaver): CursorTransformation => {\n    const transformation = new CursorTransformation();\n    const editorCursor = taleWeaver.getState().getEditorCursor();\n    if (!editorCursor) {\n      return transformation;\n    }\n    const head = editorCursor.getHead();\n    transformation.addStep(new TranslateCursorHead(0 - head));\n    return transformation;\n  };\n}\n","import TaleWeaver from '../../TaleWeaver';\nimport CursorCommand from '../CursorCommand';\nimport CursorTransformation from '../../state/CursorTransformation';\nimport TranslateCursorHead from '../../state/cursortransformationsteps/TranslateCursorHead';\nimport moveHeadToLineStart from './moveHeadToLineStart';\n\nexport default function moveHeadToPreviousLine(): CursorCommand {\n  return (taleWeaver: TaleWeaver): CursorTransformation => {\n    const transformation = new CursorTransformation();\n    const editorCursor = taleWeaver.getState().getEditorCursor();\n    if (!editorCursor) {\n      return transformation;\n    }\n    const head = editorCursor.getHead();\n    const docView = taleWeaver.getDocView();\n    const viewAwarePosition = docView.resolveModelPosition(head);\n    const previousLineView = viewAwarePosition.lineView.getPreviousLineView();\n    if (!previousLineView) {\n      return moveHeadToLineStart()(taleWeaver);\n    }\n    const editorCursorView = docView.getEditorCursorView();\n    if (!editorCursorView) {\n      return transformation;\n    }\n    let lineViewX: number;\n    if (editorCursorView.getLineViewX() !== null) {\n      lineViewX = editorCursorView.getLineViewX()!;\n    } else {\n      lineViewX = viewAwarePosition.lineView.mapModelPositionRangeToViewPositionBox(\n        viewAwarePosition.lineViewPosition,\n        viewAwarePosition.lineViewPosition,\n      ).x1;\n    }\n    const previousLinePosition = previousLineView.mapViewPositionToModelPosition(lineViewX);\n    transformation.addStep(new TranslateCursorHead(0 - viewAwarePosition.lineViewPosition - previousLineView.getSize() + previousLinePosition, true));\n    return transformation;\n  };\n}\n","import TaleWeaver from '../../TaleWeaver';\nimport CursorCommand from '../CursorCommand';\nimport CursorTransformation from '../../state/CursorTransformation';\nimport TranslateCursor from '../../state/cursortransformationsteps/TranslateCursor';\n\nexport default function moveToDocumentStart(): CursorCommand {\n  return (taleWeaver: TaleWeaver): CursorTransformation => {\n    const transformation = new CursorTransformation();\n    const editorCursor = taleWeaver.getState().getEditorCursor();\n    if (!editorCursor) {\n      return transformation;\n    }\n    const head = editorCursor.getHead();\n    transformation.addStep(new TranslateCursor(0 - head));\n    return transformation;\n  };\n}\n","import TaleWeaver from '../../TaleWeaver';\nimport CursorCommand from '../CursorCommand';\nimport CursorTransformation from '../../state/CursorTransformation';\nimport TranslateCursor from '../../state/cursortransformationsteps/TranslateCursor';\nimport moveToLineStart from './moveToLineStart';\n\nexport default function moveToPreviousLine(): CursorCommand {\n  return (taleWeaver: TaleWeaver): CursorTransformation => {\n    const transformation = new CursorTransformation();\n    const editorCursor = taleWeaver.getState().getEditorCursor();\n    if (!editorCursor) {\n      return transformation;\n    }\n    const position = Math.min(editorCursor.getHead(), editorCursor.getAnchor());\n    const docView = taleWeaver.getDocView();\n    const viewAwarePosition = docView.resolveModelPosition(position);\n    const previousLineView = viewAwarePosition.lineView.getPreviousLineView();\n    if (!previousLineView) {\n      return moveToLineStart()(taleWeaver);\n    }\n    const editorCursorView = docView.getEditorCursorView();\n    if (!editorCursorView) {\n      return transformation;\n    }\n    let lineViewX: number;\n    if (editorCursorView.getLineViewX() !== null) {\n      lineViewX = editorCursorView.getLineViewX()!;\n    } else {\n      lineViewX = viewAwarePosition.lineView.mapModelPositionRangeToViewPositionBox(\n        viewAwarePosition.lineViewPosition,\n        viewAwarePosition.lineViewPosition,\n      ).x1;\n    }\n    const previousLinePosition = previousLineView.mapViewPositionToModelPosition(lineViewX);\n    transformation.addStep(new TranslateCursor(0 - viewAwarePosition.lineViewPosition - previousLineView.getSize() + previousLinePosition, true));\n    return transformation;\n  };\n}\n","import TaleWeaver from '../../TaleWeaver';\nimport CursorCommand from '../CursorCommand';\nimport CursorTransformation from '../../state/CursorTransformation';\nimport TranslateCursorHead from '../../state/cursortransformationsteps/TranslateCursorHead';\n\nexport default function moveHeadToDocumentEnd(): CursorCommand {\n  return (taleWeaver: TaleWeaver): CursorTransformation => {\n    const transformation = new CursorTransformation();\n    const editorCursor = taleWeaver.getState().getEditorCursor();\n    if (!editorCursor) {\n      return transformation;\n    }\n    const head = editorCursor.getHead();\n    const documentSize = taleWeaver.getState().getDoc().getSize();\n    transformation.addStep(new TranslateCursorHead(documentSize - 1 - head));\n    return transformation;\n  };\n}\n","import TaleWeaver from '../../TaleWeaver';\nimport CursorCommand from '../CursorCommand';\nimport CursorTransformation from '../../state/CursorTransformation';\nimport TranslateCursorHead from '../../state/cursortransformationsteps/TranslateCursorHead';\nimport moveHeadToLineEnd from './moveHeadToLineEnd';\n\nexport default function moveHeadToNextLine(): CursorCommand {\n  return (taleWeaver: TaleWeaver): CursorTransformation => {\n    const transformation = new CursorTransformation();\n    const editorCursor = taleWeaver.getState().getEditorCursor();\n    if (!editorCursor) {\n      return transformation;\n    }\n    const head = editorCursor.getHead();\n    const docView = taleWeaver.getDocView();\n    const viewAwarePosition = docView.resolveModelPosition(head);\n    const nextLineView = viewAwarePosition.lineView.getNextLineView();\n    if (!nextLineView) {\n      return moveHeadToLineEnd()(taleWeaver);\n    }\n    const editorCursorView = docView.getEditorCursorView();\n    if (!editorCursorView) {\n      return transformation;\n    }\n    let lineViewX: number;\n    if (editorCursorView.getLineViewX() !== null) {\n      lineViewX = editorCursorView.getLineViewX()!;\n    } else {\n      lineViewX = viewAwarePosition.lineView.mapModelPositionRangeToViewPositionBox(\n        viewAwarePosition.lineViewPosition,\n        viewAwarePosition.lineViewPosition,\n      ).x1;\n    }\n    const nextLinePosition = nextLineView.mapViewPositionToModelPosition(lineViewX);\n    transformation.addStep(new TranslateCursorHead(viewAwarePosition.lineView.getSize() - viewAwarePosition.lineViewPosition + nextLinePosition, true));\n    return transformation;\n  };\n}\n","import TaleWeaver from '../../TaleWeaver';\nimport CursorCommand from '../CursorCommand';\nimport CursorTransformation from '../../state/CursorTransformation';\nimport TranslateCursor from '../../state/cursortransformationsteps/TranslateCursor';\n\nexport default function moveToDocumentEnd(): CursorCommand {\n  return (taleWeaver: TaleWeaver): CursorTransformation => {\n    const transformation = new CursorTransformation();\n    const editorCursor = taleWeaver.getState().getEditorCursor();\n    if (!editorCursor) {\n      return transformation;\n    }\n    const head = editorCursor.getHead();\n    const documentSize = taleWeaver.getState().getDoc().getSize();\n    transformation.addStep(new TranslateCursor(documentSize - 1- head));\n    return transformation;\n  };\n}\n","import TaleWeaver from '../../TaleWeaver';\nimport CursorCommand from '../CursorCommand';\nimport CursorTransformation from '../../state/CursorTransformation';\nimport TranslateCursor from '../../state/cursortransformationsteps/TranslateCursor';\nimport moveToLineEnd from './moveToLineEnd';\n\nexport default function moveToNextLine(): CursorCommand {\n  return (taleWeaver: TaleWeaver): CursorTransformation => {\n    const transformation = new CursorTransformation();\n    const editorCursor = taleWeaver.getState().getEditorCursor();\n    if (!editorCursor) {\n      return transformation;\n    }\n    const position = Math.max(editorCursor.getHead(), editorCursor.getAnchor());\n    const docView = taleWeaver.getDocView();\n    const viewAwarePosition = docView.resolveModelPosition(position);\n    const nextLineView = viewAwarePosition.lineView.getNextLineView();\n    if (!nextLineView) {\n      return moveToLineEnd()(taleWeaver);\n    }\n    const editorCursorView = docView.getEditorCursorView();\n    if (!editorCursorView) {\n      return transformation;\n    }\n    let lineViewX: number;\n    if (editorCursorView.getLineViewX() !== null) {\n      lineViewX = editorCursorView.getLineViewX()!;\n    } else {\n      lineViewX = viewAwarePosition.lineView.mapModelPositionRangeToViewPositionBox(\n        viewAwarePosition.lineViewPosition,\n        viewAwarePosition.lineViewPosition,\n      ).x1;\n    }\n    const nextLinePosition = nextLineView.mapViewPositionToModelPosition(lineViewX);\n    transformation.addStep(new TranslateCursor(viewAwarePosition.lineView.getSize() - viewAwarePosition.lineViewPosition + nextLinePosition, true));\n    return transformation;\n  };\n}\n","import DocumentTransformationStep from './DocumentTransformationStep';\n\n/**\n * Describes a document transformation as a series\n * of steps.\n */\nexport default class DocumentTransformation {\n  private steps: DocumentTransformationStep[] = [];\n\n  /**\n   * Create a new document transformation.\n   */\n  constructor() {\n    this.steps = [];\n  }\n\n  /**\n   * Add a step to the transformation.\n   */\n  addStep(step: DocumentTransformationStep) {\n    this.steps.push(step);\n  }\n\n  /**\n   * Get all steps of the transformation.\n   */\n  getSteps(): DocumentTransformationStep[] {\n    return this.steps;\n  }\n}\n","import EventObserver from './EventObserver';\nimport Event, { KeyPressEvent } from './Event';\nimport {\n  insertText,\n} from '../command/document';\n\nexport default class DocumentEventObserver extends EventObserver {\n  onEvent(event: Event) {\n    if (event instanceof KeyPressEvent) {\n      const keyPressEvent = <KeyPressEvent> event;\n      if (keyPressEvent.key === 'a') {\n        this.dispatchDocumentCommand(insertText('a'));\n      }\n    }\n  }\n}\n","import TaleWeaver from '../../TaleWeaver';\nimport DocumentCommand from '../DocumentCommand';\nimport DocumentTransformation from '../../state/DocumentTransformation';\nimport Assign from '../../state/documenttransformationsteps/Assign';\n\nexport default function insertText(text: string): DocumentCommand {\n  return (taleWeaver: TaleWeaver): DocumentTransformation => {\n    const transformation = new DocumentTransformation();\n    transformation.addStep(new Assign(text));\n    return transformation;\n  };\n}\n","import Doc from './model/Doc';\nimport Block from './model/block/Block';\nimport Word from './model/word/Word';\nimport Paragraph from './model/block/Paragraph';\nimport TextWord from './model/word/TextWord';\nimport DocView from './view/DocView';\nimport PageView from './view/PageView';\nimport LineView from './view/LineView';\nimport WordView from './view/WordView';\nimport ParagraphLineView from './view/ParagraphLineView';\nimport TextView from './view/TextView';\nimport State from './state/State';\nimport CursorTransformer from './state/CursorTransformer';\nimport DocumentTransformer from './state/DocumentTransformer';\nimport EventObserver from './event/EventObserver';\nimport EditorCursorEventObserver from './event/EditorCursorEventObserver';\nimport DocumentEventObserver from './event/DocumentEventObserver';\n\ntype DocClass = new (...args: any[]) => Doc;\ntype BlockClass = new (...args: any[]) => Block;\ntype WordClass = new (...args: any[]) => Word;\ntype DocViewClass = new (...args: any[]) => DocView;\ntype PageViewClass = new (...args: any[]) => PageView;\ntype LineViewClass = new (...args: any[]) => LineView;\ntype WordViewClass = new (...args: any[]) => WordView;\n\n/**\n * Configs for TaleWeaver.\n */\ntype TaleWeaverConfig = {\n  /** Width of a page in the document. */\n  pageWidth: number;\n  /** Height of a page in the document. */\n  pageHeight: number;\n  /** Topping padding of a page in the document. */\n  pagePaddingTop: number;\n  /** Bottom padding of a page in the document. */\n  pagePaddingBottom: number;\n  /** Left padding of a page in the document. */\n  pagePaddingLeft: number;\n  /** Right padding of a page in the document. */\n  pagePaddingRight: number;\n}\n\n/**\n * Registry for model element classes and view classes.\n * Useful for customizing and extending TaleWeaver.\n */\nclass TaleWeaverRegistry {\n  /** TaleWeaver instance. */\n  private taleWeaver: TaleWeaver;\n  /** Registered document element class. */\n  private docClass?: DocClass;\n  /** Registered block element classes. */\n  private blockClasses: Map<string, BlockClass>;\n  /** Registered inline element classes. */\n  private wordClasses: Map<string, WordClass>;\n  /** Registered document view class. */\n  private docViewClass?: DocViewClass;\n  /** Registered page view class. */\n  private pageViewClass?: PageViewClass;\n  /** Registered line view classes. */\n  private lineViewClasses: Map<string, LineViewClass>;\n  /** Registered box view classes. */\n  private wordViewClasses: Map<string, WordViewClass>;\n  /** Registered cursor transformer. */\n  private cursorTransformer?: CursorTransformer;\n  /** Registered document transformer. */\n  private documentTransformer?: DocumentTransformer;\n  /** Registered event handlers. */\n  private eventObservers: EventObserver[];\n\n  /**\n   * Creates a new TaleWeaver registry instance.\n   */\n  constructor(taleWeaver: TaleWeaver) {\n    this.taleWeaver = taleWeaver;\n\n    // Init registry maps\n    this.blockClasses = new Map<string, BlockClass>();\n    this.wordClasses = new Map<string, WordClass>();\n    this.lineViewClasses = new Map<string, LineViewClass>();\n    this.wordViewClasses = new Map<string, WordViewClass>();\n    this.eventObservers = [];\n\n    // Register defaults\n    this.registerDocClass(Doc);\n    this.registerBlockClass('Paragraph', Paragraph);\n    this.registerWordClass('Text', TextWord);\n    this.registerDocViewClass(DocView);\n    this.registerPageViewClass(PageView);\n    this.registerLineViewClass('Paragraph', ParagraphLineView);\n    this.registerWordViewClass('Text', TextView);\n    this.registerCursorTransformer(new CursorTransformer());\n    this.registerDocumentTransformer(new DocumentTransformer());\n    this.registerEventObserver(new EditorCursorEventObserver(this.taleWeaver));\n    this.registerEventObserver(new DocumentEventObserver(this.taleWeaver));\n  }\n\n  /**\n   * Registers the document element class.\n   * @param docClass - Document element class to register.\n   */\n  registerDocClass(docClass: DocClass) {\n    this.docClass = docClass;\n  }\n\n  /**\n   * Gets the registered document element class.\n   */\n  getDocClass(): DocClass {\n    if (!this.docClass) {\n      throw new Error('No document element class registered.');\n    }\n    return this.docClass;\n  }\n\n  /**\n   * Registers a block element class by type.\n   * @param type - Type of the block element class.\n   * @param blockClass - Block element class to register.\n   */\n  registerBlockClass(type: string, blockClass: BlockClass) {\n    this.blockClasses.set(type, blockClass);\n  }\n\n  /**\n   * Gets a registered block element class by type.\n   * @param type - Type of the block element class.\n   */\n  getBlockClass(type: string): BlockClass {\n    const blockClass = this.blockClasses.get(type);\n    if (!blockClass) {\n      throw new Error(`Unregistered block element class type: ${type}.`);\n    }\n    return blockClass;\n  }\n\n  /**\n   * Registers an inline element class by type.\n   * @param type - Type of the inline element class.\n   * @param wordClass - Word class to register.\n   */\n  registerWordClass(type: string, wordClass: WordClass) {\n    this.wordClasses.set(type, wordClass);\n  }\n\n  /**\n   * Gets a registered inline element class by type.\n   * @param type - Type of the inline element class.\n   */\n  getWordClass(type: string): WordClass {\n    const wordClass = this.wordClasses.get(type);\n    if (!wordClass) {\n      throw new Error(`Unregistered inline element class type: ${type}.`);\n    }\n    return wordClass;\n  }\n\n  /**\n   * Registers the document view class.\n   * @param docViewClass - Document view class to register.\n   */\n  registerDocViewClass(docViewClass: DocViewClass) {\n    this.docViewClass = docViewClass;\n  }\n\n  /**\n   * Gets the registered document view class.\n   */\n  getDocViewClass(): DocViewClass {\n    if (!this.docViewClass) {\n      throw new Error('No document view class registered.');\n    }\n    return this.docViewClass;\n  }\n\n  /**\n   * Registers the page view class.\n   * @param pageViewClass - Page view class to register.\n   */\n  registerPageViewClass(pageViewClass: PageViewClass) {\n    this.pageViewClass = pageViewClass;\n  }\n\n  /**\n   * Gets the registered page view class.\n   */\n  getPageViewClass(): PageViewClass {\n    if (!this.pageViewClass) {\n      throw new Error('No page view class registered.');\n    }\n    return this.pageViewClass;\n  }\n\n  /**\n   * Regsiters a line view class by type.\n   * @param type - Type of the line view class.\n   * @param lineViewClass - Line view class to register.\n   */\n  registerLineViewClass(type: string, lineViewClass: LineViewClass) {\n    this.lineViewClasses.set(type, lineViewClass);\n  }\n\n  /**\n   * Gets a registered line view class by type.\n   * @param type - Type of the line view class.\n   */\n  getLineViewClass(type: string): LineViewClass {\n    const lineViewClass = this.lineViewClasses.get(type);\n    if (!lineViewClass) {\n      throw new Error(`Unregistered line view class: ${type}.`);\n    }\n    return lineViewClass;\n  }\n\n  /**\n   * Registers a box view class by type.\n   * @param type - Type of the box view class.\n   * @param wordViewType - Box view class to register.\n   */\n  registerWordViewClass(type: string, wordViewClass: WordViewClass) {\n    this.wordViewClasses.set(type, wordViewClass);\n  }\n\n  /**\n   * Gets a registered box view class by type.\n   * @param type - Type of the box view class.\n   */\n  getWordViewClass(type: string): WordViewClass {\n    const wordViewClass = this.wordViewClasses.get(type);\n    if (!wordViewClass) {\n      throw new Error(`Unregistered box view class: ${type}.`);\n    }\n    return wordViewClass;\n  }\n\n  /**\n   * Registers the cursor transformer.\n   * @param cursorTransformer - Cursor transformer to register.\n   */\n  registerCursorTransformer(cursorTransformer: CursorTransformer) {\n    this.cursorTransformer = cursorTransformer;\n  }\n\n  /**\n   * Gets the registered cursor transformer.\n   */\n  getCursorTransformer(): CursorTransformer {\n    if (!this.cursorTransformer) {\n      throw new Error('No cursor transformer registered.');\n    }\n    return this.cursorTransformer;\n  }\n\n  /**\n   * Registers the document transformer.\n   * @param documentTransformer - Document transformer to register.\n   */\n  registerDocumentTransformer(documentTransformer: DocumentTransformer) {\n    this.documentTransformer = documentTransformer;\n  }\n\n  /**\n   * Gets the registered document transformer.\n   */\n  getDocumentTransformer(): DocumentTransformer {\n    if (!this.documentTransformer) {\n      throw new Error('No document transformer registered.');\n    }\n    return this.documentTransformer;\n  }\n\n  /**\n   * Registers an event handler.\n   * @param eventObserver - Event handler to register.\n   */\n  registerEventObserver(eventObserver: EventObserver) {\n    this.eventObservers.push(eventObserver)\n  }\n\n  /**\n   * Gets all registered event handlers.\n   */\n  getEventObservers(): EventObserver[] {\n    return this.eventObservers;\n  }\n}\n\n/**\n * Root of TaleWeaver, holds things together.\n */\nexport default class TaleWeaver {\n  private config: TaleWeaverConfig;\n  private registry: TaleWeaverRegistry;\n  private state?: State;\n  private docView?: DocView;\n\n  /**\n   * Creates a new TaleWeaver instance.\n   * @param config - Configs for TaleWeaver.\n   */\n  constructor(config: TaleWeaverConfig) {\n    this.config = config;\n    this.registry = new TaleWeaverRegistry(this);\n  }\n\n  /**\n   * Gets the registry.\n   */\n  getRegistry(): TaleWeaverRegistry {\n    return this.registry;\n  }\n\n  /**\n   * Gets the configs.\n   */\n  getConfig(): TaleWeaverConfig {\n    return this.config;\n  }\n\n  /**\n   * Sets the state.\n   * @param state - State to set.\n   */\n  setState(state: State) {\n    this.state = state!;\n  }\n\n  /**\n   * Gets the state.\n   */\n  getState(): State {\n    return this.state!;\n  }\n\n  /**\n   * Sets the document view.\n   * @param docView - The document view to set.\n   */\n  setDocView(docView: DocView) {\n    this.docView = docView;\n  }\n\n  /**\n   * Gets the document view.\n   */\n  getDocView(): DocView {\n    return this.docView!;\n  }\n\n  /**\n   * Attaches TaleWeaver to the DOM.\n   * @param domWrapper - Wrapper DOM element for TaleWeaver.\n   */\n  attach(domWrapper: HTMLElement) {\n    const DocView = this.registry.getDocViewClass();\n    const docView = new DocView(\n      this,\n      this.getState().getDoc(),\n      {\n        pageWidth: this.config.pageWidth,\n        pageHeight: this.config.pageHeight,\n        pagePaddingTop: this.config.pagePaddingTop,\n        pagePaddingBottom: this.config.pagePaddingBottom,\n        pagePaddingLeft: this.config.pagePaddingLeft,\n        pagePaddingRight: this.config.pagePaddingRight,\n      },\n    );\n    this.setDocView(docView);\n    this.getDocView().mount(domWrapper);\n  }\n}\n","import Doc from '../model/Doc';\nimport Cursor from '../cursor/Cursor';\nimport CursorTransformation from './CursorTransformation';\nimport TaleWeaver from '../TaleWeaver';\nimport Event from '../event/Event';\nimport DocumentTransformation from './DocumentTransformation';\n\n/**\n * State container for TaleWeaver.\n * Keeps track of the state of the document\n * and its cursors.\n */\nexport default class State {\n  /** TaleWeaver instance. */\n  private taleWeaver: TaleWeaver;\n  /** Document element. */\n  private doc?: Doc;\n  /** Editor cursor. */\n  private editorCursor: Cursor | null;\n  /** Observer cursors. */\n  private observerCursors: Cursor[];\n\n  /**\n   * Creates a new state instance.\n   * @param taleWeaver - TaleWeaver instance.\n   */\n  constructor(taleWeaver: TaleWeaver) {\n    this.taleWeaver = taleWeaver;\n    this.editorCursor = null;\n    this.observerCursors = [];\n  }\n\n  /**\n   * Sets the document element.\n   * @param doc - Document element to set.\n   */\n  setDoc(doc: Doc) {\n    this.doc = doc;\n  }\n\n  /**\n   * Gets the document element.\n   */\n  getDoc(): Doc {\n    return this.doc!;\n  }\n\n  /**\n   * Sets the editor cursor.\n   * @param cursor - Editor cursor to set.\n   */\n  setEditorCursor(cursor: Cursor) {\n    this.editorCursor = cursor;\n  }\n\n  /**\n   * Gets the editor cursor. It's possible to not have an editor cursor.\n   */\n  getEditorCursor(): Cursor | null {\n    return this.editorCursor;\n  }\n\n  /**\n   * Gets all observer cursors.\n   */\n  getObserverCursors(): Cursor[] {\n    return this.observerCursors;\n  }\n\n  /**\n   * Appends an observer cursor.\n   * @param cursor - Observer cursor to append.\n   */\n  appendObserverCursor(cursor: Cursor) {\n    this.observerCursors.push(cursor);\n  }\n\n  /**\n   * Removes an observer cursor.\n   * @param cursor - Observer cursor to remove.\n   */\n  removeObserverCursor(cursor: Cursor) {\n    const index = this.observerCursors.indexOf(cursor);\n    if (index < 0) {\n      return;\n    }\n    this.observerCursors.splice(index, 1);\n  }\n\n  /**\n   * Dispatches an event to the event observers.\n   * @param event - Event to dispatch.\n   */\n  dispatchEvent(event: Event) {\n    const eventObservers = this.taleWeaver.getRegistry().getEventObservers();\n    eventObservers.forEach(eventObserver => {\n      eventObserver.onEvent(event);\n    });\n  }\n\n  /**\n   * Applies a transformation on the editor cursor.\n   * @param transformation - Cursor transformation to apply.\n   */\n  applyEditorCursorTransformation(transformation: CursorTransformation) {\n    if (!this.editorCursor) {\n      throw new Error('No editor cursor available to apply transformation.');\n    }\n    const transformer = this.taleWeaver.getRegistry().getCursorTransformer();\n    transformer.apply(this.editorCursor, transformation);\n    const { domDocumentContent } = this.taleWeaver.getDocView().getDOM();\n  }\n\n  applyDocumentTransformation(transformation: DocumentTransformation) {\n    if (!this.doc) {\n      throw new Error('No document available to apply transformation.');\n    }\n    const transformer = this.taleWeaver.getRegistry().getDocumentTransformer();\n    transformer.apply(this.doc, transformation);\n  }\n}\n","/**\n * Interface for extra observer args, which is just\n * an arbitrary key-value map.\n */\nexport interface CursorTransformationExtraArgs {\n  preserveLineViewPosition: boolean;\n}\n\n/** Observer to cursor state change. */\ntype CursorObserver = (cursor: Cursor, extraArgs: CursorTransformationExtraArgs) => void;\n\n/**\n * Generates a unique cursor ID.\n */\nfunction generateID(): string {\n  // Generate cursor ID with current timestamp and a random number.\n  return `${Date.now().toString(36)}${Math.random().toString(36).substring(2)}`\n}\n\n/**\n * Models a cursor on the document.\n */\nexport default class Cursor {\n  /** ID of the cursor. */\n  private id: string;\n  /** Anchor position of the cursor. */\n  private anchor: number;\n  /** Head position of the cursor. */\n  private head: number;\n  /** Observers registered with the cursor. */\n  private observers: CursorObserver[];\n\n  /**\n   * Creates a new cursor instance.\n   * @param anchor - Initial anchor position of the cursor.\n   * @param head - Initial head position of the cursor.\n   * @param id - ID of the cursor.\n   */\n  constructor(anchor: number, head: number, id?: string) {\n    this.id = id || generateID();\n    this.anchor = anchor;\n    this.head = head;\n    this.observers = [];\n  }\n\n  /**\n   * Notifies observers of state change.\n   */\n  private notifyObservers(extraArgs: CursorTransformationExtraArgs) {\n    this.observers.forEach(observer => {\n      observer(this, extraArgs);\n    });\n  }\n\n  /**\n   * Gets the ID of the cursor.\n   */\n  getID() {\n    return this.id;\n  }\n\n  /**\n   * Registers an observer.\n   * @param observer - Observer to register.\n   */\n  observe(observer: CursorObserver) {\n    this.observers.push(observer);\n  }\n\n  /**\n   * Moves the cursor to a certain position.\n   * @param position - Position to move cursor to.\n   */\n  moveTo(position: number, extraArgs: CursorTransformationExtraArgs) {\n    this.anchor = position;\n    this.head = position;\n    this.notifyObservers(extraArgs);\n  }\n\n  /**\n   * Moves the cursor head to a certain position.\n   * The anchor is not moved.\n   * @param position - Position to move cursor head to.\n   */\n  moveHeadTo(position: number, extraArgs: CursorTransformationExtraArgs) {\n    this.head = position;\n    this.notifyObservers(extraArgs);\n  }\n\n  /**\n   * Gets the anchor position.\n   */\n  getAnchor(): number {\n    return this.anchor!;\n  }\n\n  /**\n   * Gets the head position.\n   */\n  getHead(): number {\n    return this.head!;\n  }\n}\n","import React from 'react';\nimport './App.css';\nimport TaleWeaver from './editor/TaleWeaver';\nimport parseStateJSON from './editor/state/helpers/parseStateJSON';\n\nconst docText = `\nLorem ipsum dolor sit amet, consectetur adipiscing elit. Donec luctus commodo magna eu gravida. Quisque et neque ornare nunc maximus faucibus. Ut molestie diam non interdum fringilla. In hac habitasse platea dictumst. Proin dignissim id diam a pharetra. Praesent nec arcu felis. Nam et cursus mi. Duis facilisis ex vel leo vulputate laoreet. Pellentesque turpis quam, sollicitudin at lobortis non, rhoncus eu neque. Quisque egestas, ex vitae porta accumsan, justo dui elementum nisi, et bibendum lectus diam ut mauris. Proin imperdiet vulputate congue. Lorem ipsum dolor sit amet, consectetur adipiscing elit. Suspendisse nec tristique odio. Nulla eget tortor eu felis mattis mattis. Duis in nulla ultricies, egestas nunc ac, tempor tellus.\nCras condimentum nisi diam, vitae ornare libero porttitor at. Curabitur id nibh aliquam lacus malesuada tincidunt id eget mauris. Donec venenatis non ipsum quis fermentum. Vestibulum dignissim finibus neque, et mattis orci mollis id. Nunc pellentesque, neque sed fermentum fermentum, felis nunc porttitor lorem, et pulvinar leo quam ut elit. Quisque sit amet venenatis mauris. In hac habitasse platea dictumst. Praesent sem mauris, tincidunt ut sollicitudin et, molestie ac magna. Etiam faucibus porta dapibus. Cras velit augue, molestie id est in, ullamcorper sodales mauris. Nunc ullamcorper eros purus, eget placerat eros pharetra fermentum. Nunc ullamcorper euismod dui, tempor pulvinar mi pretium vel. Nullam nec nisi mi. Phasellus fermentum diam vel lacus bibendum imperdiet. Cras enim mi, cursus at velit feugiat, sagittis sagittis urna.\nMaecenas id efficitur nulla, ornare posuere felis. Nulla lobortis tortor vel massa lobortis, sit amet rhoncus neque placerat. Curabitur maximus iaculis faucibus. In tincidunt posuere justo at pulvinar. Maecenas viverra at odio nec porta. Pellentesque ultrices eros vitae velit scelerisque, et tempor lectus sodales. Duis tempus quam nec tortor consequat consectetur. Nulla facilisi. Nam id lectus magna. Nulla metus mauris, tincidunt at ante a, pulvinar tincidunt metus. Nulla nec magna sit amet sapien feugiat commodo at in dolor. Aenean mauris enim, posuere et dolor quis, ornare sollicitudin dui. Vivamus aliquet metus turpis, in maximus enim aliquam in. Sed vel quam vitae metus condimentum aliquam.\nSuspendisse egestas vulputate arcu, ut laoreet felis feugiat sed. Donec dui sem, aliquet euismod sollicitudin sed, cursus non urna. Ut blandit enim diam, vitae rhoncus nisl accumsan non. Nulla facilisi. Vestibulum nec scelerisque augue, sed volutpat est. Integer augue turpis, varius ac velit non, ornare venenatis lectus. Nullam porta neque vel risus semper ornare id a enim. Cras tristique non quam quis commodo.\nFusce condimentum arcu et diam faucibus, sit amet mattis velit pharetra. Praesent sagittis rhoncus libero, placerat ornare dui varius eget. Fusce consequat metus ut dignissim luctus. In congue lectus ut magna varius, at aliquam mi rutrum. Nam eu nunc eu ipsum varius pulvinar ac ut nulla. Nullam non elit neque. Vestibulum quis molestie dolor, eu vehicula risus. Sed luctus velit sem, id vestibulum orci blandit at. In aliquam gravida aliquam. Vivamus semper vulputate purus eu vehicula. Ut condimentum quis velit et feugiat. Curabitur eget ex eget mi interdum condimentum eget sit amet purus. Aliquam et libero erat. Aliquam erat volutpat.\n`;\n\nconst initialStateJSON = {\n  document: {\n    children: [],\n  },\n  editorCursor: { anchor: 0, head: 20 },\n  observerCursors: [],\n};\n\ndocText.trim().split('\\n').forEach(paragraph => {\n  const docJSON = initialStateJSON.document;\n  const paragraphJSON = {\n    type: 'Paragraph',\n    children: [],\n  };\n  // @ts-ignore\n  docJSON.children.push(paragraphJSON);\n  paragraph.split(' ').forEach(word => {\n    const wordJSON = {\n      type: 'Text',\n      text: word + ' ',\n    };\n    // @ts-ignore\n    paragraphJSON.children.push(wordJSON);\n    // @ts-ignore\n    paragraphJSON.children[ paragraphJSON.children.length - 1].text.replace(' ', '\\n');\n  });\n});\n\ntype TaleWeaverComponentProps = {\n  initialStateJSON: object;\n}\ntype TaleWeaverComponentState = {\n  taleWeaver: TaleWeaver;\n}\nclass TaleWeaverComponent extends React.Component<TaleWeaverComponentProps, TaleWeaverComponentState> {\n  private domRef: React.RefObject<HTMLDivElement>;\n\n  constructor(props: any) {\n    super(props);\n    this.domRef = React.createRef();\n    const taleWeaver = new TaleWeaver({\n      pageWidth: 800,\n      pageHeight: 1000,\n      pagePaddingTop: 60,\n      pagePaddingBottom: 60,\n      pagePaddingLeft: 60,\n      pagePaddingRight: 60,\n    });\n    taleWeaver.setState(parseStateJSON(taleWeaver, props.initialStateJSON));\n    this.state = { taleWeaver };\n  }\n\n  componentDidMount() {\n    const domElement = this.domRef.current!;\n    this.state.taleWeaver.attach(domElement);\n  }\n\n  render() {\n    return (\n      <div className=\"tw--container\" ref={this.domRef} />\n    );\n  }\n}\n\nclass App extends React.Component {\n  render() {\n    return (\n      <div className=\"app\">\n        <TaleWeaverComponent initialStateJSON={initialStateJSON} />\n      </div>\n    );\n  }\n}\n\nexport default App;\n","import TaleWeaver from '../../TaleWeaver';\nimport State from '../State';\nimport Cursor from '../../cursor/Cursor';\n\ntype WordJSON = {\n  type: string;\n  text: string;\n}\ntype BlockJSON = {\n  type: string;\n  children: WordJSON[];\n}\ntype DocJSON = {\n  children: BlockJSON[];\n}\ntype CursorJSON = {\n  anchor: number;\n  head: number;\n}\ntype StateJSON = {\n  document: DocJSON;\n  editorCursor: CursorJSON | null;\n  observerCursors: CursorJSON[];\n}\n\n/**\n * Parses a JSON-serialized state.\n * @param taleWeaver - TaleWeaver instance.\n * @param stateJSON - JSON-serialized state to parse.\n */\nexport default function parseStateJSON(taleWeaver: TaleWeaver, stateJSON: StateJSON): State {\n  // Create state\n  const state = new State(taleWeaver);\n\n  // Parse document state\n  const registry = taleWeaver.getRegistry();\n  const Doc = registry.getDocClass();\n  const doc = new Doc();\n  stateJSON.document.children.forEach(blockJSON => {\n    const Block = registry.getBlockClass(blockJSON.type);\n    const block = new Block();\n    blockJSON.children.forEach(wordJSON => {\n      const Word = registry.getWordClass(wordJSON.type);\n      const word = new Word();\n      word.setText(wordJSON.text);\n      block.appendChild(word);\n    });\n    doc.appendChild(block);\n  });\n  state.setDoc(doc);\n\n  // Parse editor cursor state\n  if (stateJSON.editorCursor) {\n    const editorCursor = new Cursor(stateJSON.editorCursor.anchor, stateJSON.editorCursor.head);\n    state.setEditorCursor(editorCursor);\n  }\n\n  // Parse observer cursors states\n  stateJSON.observerCursors.forEach(observerCursorJSON => {\n    const observerCursor = new Cursor(observerCursorJSON.anchor, observerCursorJSON.head);\n    state.appendObserverCursor(observerCursor);\n  });\n\n  return state;\n}\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read http://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.1/8 is considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\ntype Config = {\n  onSuccess?: (registration: ServiceWorkerRegistration) => void;\n  onUpdate?: (registration: ServiceWorkerRegistration) => void;\n};\n\nexport function register(config?: Config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(\n      (process as { env: { [key: string]: string } }).env.PUBLIC_URL,\n      window.location.href\n    );\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit http://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl: string, config?: Config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See http://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl: string, config?: Config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl)\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready.then(registration => {\n      registration.unregister();\n    });\n  }\n}\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\nimport * as serviceWorker from './serviceWorker';\n\nReactDOM.render(<App />, document.getElementById('root'));\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: http://bit.ly/CRA-PWA\nserviceWorker.unregister();\n"],"sourceRoot":""}