(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{11:function(e,t,i){e.exports=i(20)},16:function(e,t,i){},18:function(e,t,i){},20:function(e,t,i){"use strict";i.r(t);var n=i(7),o=i.n(n),r=i(10),a=i.n(r),s=(i(16),i(0)),u=i(1),c=i(4),l=i(2),h=i(3),d=(i(18),i(5)),g=function e(){Object(s.a)(this,e)},f=function(e){function t(){return Object(s.a)(this,t),Object(c.a)(this,Object(l.a)(t).apply(this,arguments))}return Object(h.a)(t,e),t}(g),w=function(e){function t(){return Object(s.a)(this,t),Object(c.a)(this,Object(l.a)(t).apply(this,arguments))}return Object(h.a)(t,e),t}(g),v=function(e){function t(){return Object(s.a)(this,t),Object(c.a)(this,Object(l.a)(t).apply(this,arguments))}return Object(h.a)(t,e),t}(g),p=function(){function e(t,i){Object(s.a)(this,e),this.node=t,this.offset=i}return Object(u.a)(e,[{key:"getNode",value:function(){return this.node}},{key:"getOffset",value:function(){return this.offset}},{key:"toParent",value:function(){return this.node instanceof w?this.node.parentAt(this.offset):this.node instanceof v?this.node.parentAt(this.offset):null}},{key:"toChild",value:function(){return this.node instanceof f?this.node.childAt(this.offset):this.node instanceof w?this.node.childAt(this.offset):null}}]),e}(),m=function(){function e(t){Object(s.a)(this,e),this.attributes=t}return Object(u.a)(e,[{key:"getAttributes",value:function(){return this.attributes}}]),e}(),y=function e(){Object(s.a)(this,e)},b=function(){function e(t,i){Object(s.a)(this,e),this.type=t,this.attributes=i}return Object(u.a)(e,[{key:"getType",value:function(){return this.type}},{key:"getAttributes",value:function(){return this.attributes}}]),e}(),V=function e(){Object(s.a)(this,e)},k=function(e){function t(e,i){var n;if(Object(s.a)(this,t),(n=Object(c.a)(this,Object(l.a)(t).call(this))).taleWeaver=e,n.children=[],!(i[0]instanceof m))throw new Error("Error building doc from tokens, expecting first token to be DocStartToken.");if(!(i[i.length-1]instanceof y))throw new Error("Error building doc from tokens, expecting last token to be DocEndToken.");var o=i[0];n.attributes=o.getAttributes();for(var r=1,a=0,u=1,h=i.length-1;u<h;u++){var g=i[u];if(g instanceof b?(0===a&&(r=u),a+=1):g instanceof V&&(a-=1),0===a){var f=i.slice(r,u+1),w=i[r],v=new(e.getConfig().getBlockClass(w.getType()))(e,Object(d.a)(Object(d.a)(n)),f);n.appendChild(v)}}return n}return Object(h.a)(t,e),Object(u.a)(t,null,[{key:"getType",value:function(){return"Doc"}}]),Object(u.a)(t,[{key:"getType",value:function(){return t.getType()}},{key:"getSize",value:function(){var e=0;return this.children.forEach(function(t){e+=t.getSize()}),e}},{key:"appendChild",value:function(e){this.children.push(e)}},{key:"removeChild",value:function(e){var t=this.children.indexOf(e);t<0||this.children.splice(t,1)}},{key:"getChildren",value:function(){return this.children}},{key:"childAt",value:function(e){if(e<0)throw new Error("Doc offset out of range: ".concat(e));for(var t=0,i=0,n=this.children.length;i<n;i++){var o=this.children[i],r=o.getSize();if(e<t+r)return new p(o,e-t);t+=r}throw new Error("Doc offset out of range: ".concat(e))}}]),t}(f),C=i(6),O=function(e){function t(e,i,n){var o;Object(s.a)(this,t),(o=Object(c.a)(this,Object(l.a)(t).call(this))).taleWeaver=e,o.block=i,o.parent=n,o.children=[];var r=new Set;return i.getChildren().forEach(function(t){var i,n=e.getConfig().getWordViewModelClass(t.getType());r.add(n);var a=n.fromInline(e,t,Object(d.a)(Object(d.a)(o)));(i=o.children).push.apply(i,Object(C.a)(a))}),r.forEach(function(t){o.children=t.postProcess(e,o.children,Object(d.a)(Object(d.a)(o)))}),o}return Object(h.a)(t,e),Object(u.a)(t,[{key:"getType",value:function(){return this.block.getType()}},{key:"getSize",value:function(){return this.block.getSize()}},{key:"getParent",value:function(){return this.parent}},{key:"getPreviousSibling",value:function(){var e=this.parent.getChildren(),t=e.indexOf(this);if(t<0)throw new Error("Model is corrupted, block not found in parent.");return 0===t?null:e[t-1]}},{key:"getNextSibling",value:function(){var e=this.parent.getChildren(),t=e.indexOf(this);if(t<0)throw new Error("Model is corrupted, block not found in parent.");return t===e.length-1?null:e[t+1]}},{key:"getChildren",value:function(){return this.children}},{key:"parentAt",value:function(e){if(e<0)throw new Error("Block view offset out of range: ".concat(e,"."));if(e>this.getSize()-1)throw new Error("Block view offset out of range: ".concat(e,"."));for(var t=this.parent,i=t.getChildren(),n=1,o=0,r=i.length;o<r;o++){var a=i[o];if(a===this)return new p(t,n+e);n+=a.getSize()}throw new Error("View model is corrupted, block view not found in parent.")}},{key:"childAt",value:function(e){if(e<1)throw new Error("Block view offset out of range: ".concat(e));for(var t=1,i=0,n=this.children.length;i<n;i++){var o=this.children[i],r=o.getSize();if(e<t+r)return new p(o,e-t);t+=r}throw new Error("Block view offset out of range: ".concat(e))}}]),t}(w),P=function(e){function t(e,i){var n;return Object(s.a)(this,t),(n=Object(c.a)(this,Object(l.a)(t).call(this))).taleWeaver=e,n.doc=i,n.children=i.getChildren().map(function(t){return new O(e,t,Object(d.a)(Object(d.a)(n)))}),n}return Object(h.a)(t,e),Object(u.a)(t,null,[{key:"getType",value:function(){return"Doc"}}]),Object(u.a)(t,[{key:"getType",value:function(){return t.getType()}},{key:"getSize",value:function(){return this.doc.getSize()}},{key:"getChildren",value:function(){return this.children}},{key:"childAt",value:function(e){if(e<1)throw new Error("Doc view offset out of range: ".concat(e));for(var t=1,i=0,n=this.children.length;i<n;i++){var o=this.children[i],r=o.getSize();if(e<t+r)return new p(o,e-t);t+=r}throw new Error("Doc view offset out of range: ".concat(e))}}]),t}(f),E=i(8);var S=function e(){Object(s.a)(this,e)},j=function(){function e(t,i){Object(s.a)(this,e),this.docView=t,this.config=i,this.lineViews=[],this.mounted=!1}return Object(u.a)(e,[{key:"getSize",value:function(){var e=0;return this.lineViews.forEach(function(t){return e+=t.getSize()}),e}},{key:"getDocView",value:function(){return this.docView}},{key:"getPreviousPageView",value:function(){var e=this.docView.getPageViews(),t=e.indexOf(this);return t<0?null:0===t?null:e[t-1]}},{key:"getNextPageView",value:function(){var e=this.docView.getPageViews(),t=e.indexOf(this);return t<0?null:t===e.length-1?null:e[t+1]}},{key:"appendLineView",value:function(e){this.lineViews.push(e),e.setPageView(this)}},{key:"removeLineView",value:function(e){var t=this.lineViews.indexOf(e);t<0||this.lineViews.splice(t,1)}},{key:"getLineViews",value:function(){return this.lineViews}},{key:"mount",value:function(){if(!this.mounted){var e=this.docView.getDOM().domDocumentContent;this.domPage=document.createElement("div"),this.domPage.className="tw--page",this.domPage.style.width="".concat(this.config.width,"px"),this.domPage.style.height="".concat(this.config.height,"px"),this.domPage.style.padding="".concat(this.config.paddingTop,"px ").concat(this.config.paddingRight,"px ").concat(this.config.paddingBottom,"px ").concat(this.config.paddingLeft,"px"),this.domPage.style.userSelect="none",this.domPage.style.position="relative",e.appendChild(this.domPage),this.domPageContent=document.createElement("div"),this.domPageContent.className="tw--page-content",this.domPageContent.style.position="relative",this.domPageContent.style.height="100%",this.domPage.appendChild(this.domPageContent),this.lineViews.forEach(function(e){return e.mount()})}}},{key:"getDOM",value:function(){return{domPage:this.domPage,domPageContent:this.domPageContent}}},{key:"getHeight",value:function(){return this.config.height}},{key:"mapModelPositionRangeToViewPositionBoxes",value:function(e,t){for(var i=[],n=0,o=0,r=0,a=this.lineViews.length;r<a;r++){var s=this.lineViews[r];if(t>=n&&e<n+s.getSize()){var u=s.mapModelPositionRangeToViewPositionBox(Math.max(0,e-n),Math.min(s.getSize(),t-n));i.push({x1:u.x1,y1:o,x2:u.x2,y2:o+u.height})}n+=s.getSize(),o+=s.getHeight()}return i}},{key:"mapViewPositionToModelPosition",value:function(e,t){for(var i=0,n=0,o=0,r=this.lineViews.length;o<r;o++){var a=this.lineViews[o];if(n+a.getHeight()>=t)return i+a.mapViewPositionToModelPosition(e);i+=a.getSize(),n+=a.getHeight()}return i-1}},{key:"resolveModelPosition",value:function(e){for(var t=0,i=0,n=this.lineViews.length;i<n;i++){var o=this.lineViews[i];if(t+o.getSize()>e){var r=o.resolveModelPosition(e-t);return Object(E.a)({},r,{pageView:this,pageViewPosition:e})}t+=o.getSize()}throw new Error("Cannot resolve page model position ".concat(e,"."))}}]),e}(),x=function(){function e(){Object(s.a)(this,e),this.steps=[],this.steps=[]}return Object(u.a)(e,[{key:"addStep",value:function(e){this.steps.push(e)}},{key:"getSteps",value:function(){return this.steps}}]),e}(),M=function(){function e(t){var i=arguments.length>1&&void 0!==arguments[1]&&arguments[1];Object(s.a)(this,e),this.displacement=t,this.preserveLineViewPosition=i}return Object(u.a)(e,[{key:"getType",value:function(){return"TranslateCursor"}},{key:"getExtraArgs",value:function(){return{preserveLineViewPosition:this.preserveLineViewPosition}}},{key:"getDisplacement",value:function(){return this.displacement}}]),e}();function T(){return function(e){var t=new x,i=e.getEditorCursor();if(!i)return t;var n=i.getHead(),o=e.getDocView().resolveModelPosition(n);return o.lineViewPosition>0&&t.addStep(new M(0-o.lineViewPosition)),t}}function D(){return function(e){var t=new x,i=e.getEditorCursor();if(!i)return t;var n=i.getHead(),o=e.getDocView().resolveModelPosition(n);return o.lineViewPosition<o.lineView.getSize()-1&&t.addStep(new M(o.lineView.getSize()-1-o.lineViewPosition)),t}}var z=function(){function e(t){var i=arguments.length>1&&void 0!==arguments[1]&&arguments[1];Object(s.a)(this,e),this.displacement=t,this.preserveLineViewPosition=i}return Object(u.a)(e,[{key:"getType",value:function(){return"TranslateCursorHead"}},{key:"getExtraArgs",value:function(){return{preserveLineViewPosition:this.preserveLineViewPosition}}},{key:"getDisplacement",value:function(){return this.displacement}}]),e}();function W(e){return function(t){var i=new x,n=t.getEditorCursor();return n?(i.addStep(new z(e-n.getHead())),i):i}}function L(){return function(e){var t=new x,i=e.getEditorCursor();if(!i)return t;var n=i.getHead(),o=e.getDocView().resolveModelPosition(n);return o.lineViewPosition>0&&t.addStep(new z(0-o.lineViewPosition)),t}}function H(){return function(e){var t=new x,i=e.getEditorCursor();if(!i)return t;var n=i.getHead(),o=e.getDocView().resolveModelPosition(n);return o.lineViewPosition<o.lineView.getSize()-1&&t.addStep(new z(o.lineView.getSize()-1-o.lineViewPosition)),t}}var B=function(){function e(t,i){Object(s.a)(this,e),this.taleWeaver=t,this.editorCursor=i,this.domSelections=[],this.selecting=!1,this.blinkState=!1,this.blinkInterval=null,this.lineViewX=null,this.lastLineViewX=0}return Object(u.a)(e,[{key:"render",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.renderHead(e),this.renderSelections(),this.updateNativeCursor()}},{key:"renderHead",value:function(e){var t=this.editorCursor.getHead(),i=this.docView.mapModelPositionRangeToViewPositionBoxes(t,t)[0],n=i.pageView,o=i.pageViewPositionBox,r=this.domHead;r.style.left="".concat(o.x1,"px"),r.style.top="".concat(o.y1,"px"),r.style.height="".concat(o.y2-o.y1,"px");var a=n.getDOM().domPageContent;r.parentElement&&r.parentElement!==a&&r.parentElement.removeChild(r),r.parentElement||a.appendChild(r),e?null===this.lineViewX&&(this.lineViewX=this.lastLineViewX):this.lineViewX=null,this.lastLineViewX=o.x1,function(e){var t=e.getBoundingClientRect();return t.top>=0&&t.left>=0&&t.bottom<=(window.innerHeight||document.documentElement.clientHeight)&&t.right<=(window.innerWidth||document.documentElement.clientWidth)}(r)||r.scrollIntoView({block:"nearest"})}},{key:"renderSelections",value:function(){for(var e=this,t=this.editorCursor,i=t.getAnchor(),n=t.getHead(),o=Math.min(i,n),r=Math.max(i,n),a=this.docView.mapModelPositionRangeToViewPositionBoxes(o,r),s=a.length;this.domSelections.length>s;){var u=this.domSelections.pop();u.parentElement.removeChild(u)}for(;this.domSelections.length<s;){var c=document.createElement("div");c.className="tw--editor-cursor-selection",c.style.position="absolute",c.style.background="hsla(217, 100%, 65%, 0.25)",this.domSelections.push(c)}var l=0;a.forEach(function(t){var i=t.pageView,n=t.pageViewPositionBox,o=i.getDOM().domPageContent,r=e.domSelections[l];r.style.left="".concat(n.x1,"px"),r.style.width="".concat(n.x2-n.x1,"px"),r.style.top="".concat(n.y1,"px"),r.style.height="".concat(n.y2-n.y1,"px"),r.style.pointerEvents="none",r.parentElement&&r.parentElement!==o&&r.parentElement.removeChild(r),r.parentElement||o.appendChild(r),l++})}},{key:"updateNativeCursor",value:function(){var e=this.taleWeaver.getDocView(),t=this.editorCursor.getAnchor(),i=this.editorCursor.getHead(),n=e.resolveModelPosition(t),o=(e.resolveModelPosition(i),n.wordView.getDOM().domWordContent),r=getSelection();r.removeAllRanges();var a=document.createRange();a.selectNode(o),r.addRange(a)}},{key:"getLineViewX",value:function(){return this.lineViewX}},{key:"setDocView",value:function(e){this.docView=e}},{key:"mount",value:function(){var e=this;this.domHead||(this.domHead=document.createElement("div"),this.domHead.className="tw--editor-cursor-head",this.domHead.style.position="absolute",this.domHead.style.width="2px",this.domHead.style.marginLeft="-1px",this.domHead.style.background="hsla(217, 100%, 65%, 1)",this.domHead.style.visibility="hidden"),this.render(),this.startBlinking(),this.editorCursor.observe(function(t,i){e.render(i.preserveLineViewPosition),null!==e.blinkInterval&&(e.stopBlinking(),e.startBlinking())})}},{key:"getEditorCursor",value:function(){return this.editorCursor}},{key:"getDocView",value:function(){return this.docView}},{key:"startBlinking",value:function(){var e=this;null===this.blinkInterval&&(this.blinkInterval=setInterval(function(){e.blinkState?e.domHead.style.visibility="hidden":e.domHead.style.visibility="visible",e.blinkState=!e.blinkState},500))}},{key:"stopBlinking",value:function(){null!==this.blinkInterval&&(this.blinkState=!0,this.domHead.style.visibility="visible",clearInterval(this.blinkInterval),this.blinkInterval=null)}},{key:"beginSelect",value:function(e){this.taleWeaver.applyEditorCursorTransformation(function(e){return function(t){var i=new x,n=t.getEditorCursor();return n?(i.addStep(new M(e-n.getHead())),i):i}}(e)(this.taleWeaver)),this.selecting=!0,this.stopBlinking()}},{key:"moveSelect",value:function(e){this.selecting&&this.taleWeaver.applyEditorCursorTransformation(W(e)(this.taleWeaver))}},{key:"endSelect",value:function(e){this.taleWeaver.applyEditorCursorTransformation(W(e)(this.taleWeaver)),this.selecting=!1,this.startBlinking()}}]),e}(),N=function e(t,i,n,o){Object(s.a)(this,e),this.key=t,this.shift=i,this.meta=n,this.alt=o},A=function(e){function t(e,i,n){var o;return Object(s.a)(this,t),(o=Object(c.a)(this,Object(l.a)(t).call(this))).handleContextMenu=function(e){e.preventDefault()},o.handleMouseDown=function(e){if(e.preventDefault(),o.editorCursorView){var t=o.mapViewPositionToModelPosition(e.clientX,e.clientY);o.editorCursorView.beginSelect(t)}},o.handleMouseMove=function(e,t){var i,n;return function(){for(var o=arguments.length,r=new Array(o),a=0;a<o;a++)r[a]=arguments[a];n?(clearTimeout(i),i=setTimeout(function(){e.apply(void 0,r),n=Date.now()},t-(Date.now()-n))):(e.apply(void 0,r),n=Date.now())}}(function(e){if(o.editorCursorView){var t=o.mapViewPositionToModelPosition(e.clientX,e.clientY);o.editorCursorView.moveSelect(t)}},5),o.handleMouseUp=function(e){if(o.editorCursorView){var t=o.mapViewPositionToModelPosition(e.clientX,e.clientY);o.editorCursorView.endSelect(t)}},o.handleKeyDown=function(e){o.taleWeaver.dispatchEvent(new N(e.key,e.shiftKey,e.metaKey,e.altKey)),e.preventDefault()},o.handleKeyUp=function(e){},o.taleWeaver=e,o.docViewModel=i,o.config=n,o.wordViewBlocks=[],o.lineViews=[],o.pageViews=[],o.editorCursorView=null,o.mounted=!1,o.buildWordViewBlocks(),o.buildLineViews(),o.buildPageViews(),o.buildEditorCursorView(),o}return Object(h.a)(t,e),Object(u.a)(t,[{key:"getSize",value:function(){return this.docViewModel.getSize()}},{key:"mount",value:function(e){this.mounted||(this.domDocument=document.createElement("div"),this.domDocument.className="tw--document",this.domDocument.contentEditable="true",this.domDocument.spellcheck=!1,this.domDocument.style.outline="none",e.appendChild(this.domDocument),this.domDocumentContent=document.createElement("div"),this.domDocumentContent.className="tw--document-content",this.domDocument.appendChild(this.domDocumentContent),this.pageViews.forEach(function(e){return e.mount()}),this.editorCursorView&&this.editorCursorView.mount(),this.domDocument.addEventListener("contextmenu",this.handleContextMenu),this.domDocument.addEventListener("mousedown",this.handleMouseDown),this.domDocument.addEventListener("mousemove",this.handleMouseMove),window.addEventListener("mouseup",this.handleMouseUp),window.addEventListener("keydown",this.handleKeyDown),window.addEventListener("keyup",this.handleKeyUp))}},{key:"getDOM",value:function(){return{domDocument:this.domDocument,domDocumentContent:this.domDocumentContent}}},{key:"getPageViews",value:function(){return this.pageViews}},{key:"getEditorCursorView",value:function(){return this.editorCursorView}},{key:"mapModelPositionRangeToViewPositionBoxes",value:function(e,t){for(var i=this,n=[],o=0,r=function(r,a){var s=i.pageViews[r];t>=o&&e<o+s.getSize()&&s.mapModelPositionRangeToViewPositionBoxes(Math.max(0,e-o),Math.min(s.getSize(),t-o)).forEach(function(e){n.push({pageView:s,pageViewPositionBox:e})});o+=s.getSize()},a=0,s=this.pageViews.length;a<s;a++)r(a);return n}},{key:"mapViewPositionToModelPosition",value:function(e,t){for(var i=0,n=[],o=[],r=0,a=this.pageViews.length;r<a;r++){var s=this.pageViews[r],u=s.getDOM().domPageContent;n.push(u.getBoundingClientRect()),o.push(i),i+=s.getSize()}var c=n.map(function(i){var n=Math.max(Math.max(i.left-e,0),Math.max(e-(i.left+i.width),0)),o=Math.max(Math.max(i.top-t,0),Math.max(t-(i.top+i.height),0));return n*n+o*o}),l=c.indexOf(Math.min.apply(Math,Object(C.a)(c))),h=this.pageViews[l],d=n[l],g=h.mapViewPositionToModelPosition(Math.min(Math.max(e-d.left,0),d.width),Math.min(Math.max(t-d.top,0),d.height));return o[l]+g}},{key:"resolveModelPosition",value:function(e){for(var t=0,i=0,n=this.pageViews.length;i<n;i++){var o=this.pageViews[i];if(t+o.getSize()>e){var r=o.resolveModelPosition(e-t);return Object(E.a)({},r,{docView:this,docViewPosition:e})}t+=o.getSize()}throw new Error("Cannot resolve document model position ".concat(e,"."))}},{key:"buildWordViewBlocks",value:function(){var e=this,t=this.taleWeaver.getConfig();this.wordViewBlocks.length=0,this.docViewModel.getChildren().forEach(function(i){var n={blockViewModel:i,wordViews:[]};i.getChildren().forEach(function(e){var i=new(t.getWordViewClass(e.getType()))(e,{});n.wordViews.push(i)}),e.wordViewBlocks.push(n)})}},{key:"buildLineViews",value:function(){var e=this;this.lineViews.length=0;var t=this.taleWeaver.getConfig(),i=this.config.pageWidth-this.config.pagePaddingLeft-this.config.pagePaddingRight;this.wordViewBlocks.forEach(function(n){var o=t.getLineViewClass(n.blockViewModel.getType()),r=new o({width:e.config.pageWidth-e.config.pagePaddingLeft-e.config.pagePaddingRight});e.lineViews.push(r);var a=0;n.wordViews.forEach(function(t){a+t.getWidth()>i&&(r=new o({width:e.config.pageWidth-e.config.pagePaddingLeft-e.config.pagePaddingRight}),e.lineViews.push(r),a=0),t.setLineView(r),r.appendWordView(t),a+=t.getWidth()})})}},{key:"buildPageViews",value:function(){var e=this;this.pageViews.length=0;var t={width:this.config.pageWidth,height:this.config.pageHeight,paddingTop:this.config.pagePaddingTop,paddingBottom:this.config.pagePaddingBottom,paddingLeft:this.config.pagePaddingLeft,paddingRight:this.config.pagePaddingRight},i=new j(this,t);this.pageViews.push(i);var n=0,o=this.config.pageHeight-this.config.pagePaddingTop-this.config.pagePaddingBottom;this.lineViews.forEach(function(r){n+r.getHeight()>o&&(i=new j(e,t),e.pageViews.push(i),n=0),r.setPageView(i),i.appendLineView(r),n+=r.getHeight()})}},{key:"buildEditorCursorView",value:function(){var e=this.taleWeaver.getEditorCursor();e&&(this.editorCursorView=new B(this.taleWeaver,e),this.editorCursorView.setDocView(this))}}]),t}(S),I=function(){function e(){Object(s.a)(this,e)}return Object(u.a)(e,[{key:"apply",value:function(e,t){t.getSteps().forEach(function(t){if(t instanceof M)e.moveTo(e.getHead()+t.getDisplacement(),t.getExtraArgs());else{if(!(t instanceof z))throw new Error("Unrecognized cursor transformation step: ".concat(t.getType()));e.moveHeadTo(e.getHead()+t.getDisplacement(),t.getExtraArgs())}})}}]),e}(),q=function(){function e(t){Object(s.a)(this,e),this.text=t}return Object(u.a)(e,[{key:"getType",value:function(){return"Assign"}},{key:"getText",value:function(){return this.text}}]),e}(),R=function(){function e(){Object(s.a)(this,e)}return Object(u.a)(e,[{key:"apply",value:function(e,t){t.getSteps().forEach(function(t){if(!(t instanceof q))throw new Error("Unrecognized document transformation step: ".concat(t.getType()));e.getChildren()[0].getChildren()[0].setContent(t.getText())})}}]),e}(),X=function(){function e(t,i,n){var o=this;Object(s.a)(this,e),this.config=t,this.state=i,this.editorCursor=n,this.doc=new k(this,this.state.getTokens()),this.docViewModel=new P(this,this.doc),this.docView=new A(this,this.docViewModel,{pageWidth:800,pageHeight:1200,pagePaddingTop:60,pagePaddingBottom:60,pagePaddingLeft:60,pagePaddingRight:60}),this.cursorTransformer=new I,this.docTransformer=new R,this.eventObservers=t.getEventObserverClasses().map(function(e){return new e(o)})}return Object(u.a)(e,[{key:"getConfig",value:function(){return this.config}},{key:"getState",value:function(){return this.state}},{key:"getDoc",value:function(){return this.doc}},{key:"getDocView",value:function(){return this.docView}},{key:"getEditorCursor",value:function(){return this.editorCursor}},{key:"mount",value:function(e){this.docView.mount(e)}},{key:"dispatchEvent",value:function(e){this.eventObservers.forEach(function(t){t.onEvent(e)})}},{key:"applyEditorCursorTransformation",value:function(e){if(!this.editorCursor)throw new Error("No editor cursor available to apply transformation.");this.cursorTransformer.apply(this.editorCursor,e);this.docView.getDOM().domDocumentContent}},{key:"applyDocumentTransformation",value:function(e){if(!this.doc)throw new Error("No document available to apply transformation.");this.docTransformer.apply(this.doc,e)}}]),e}(),$=function(){function e(t){Object(s.a)(this,e),this.tokens=t}return Object(u.a)(e,[{key:"getTokens",value:function(){return this.tokens}}]),e}(),U=function(){function e(t,i){Object(s.a)(this,e),this.type=t,this.attributes=i}return Object(u.a)(e,[{key:"getType",value:function(){return this.type}},{key:"getAttributes",value:function(){return this.attributes}}]),e}(),J=function e(){Object(s.a)(this,e)},K=function(){function e(){Object(s.a)(this,e)}return Object(u.a)(e,[{key:"serialize",value:function(e){return e.getTokens().map(function(e){if(e instanceof m){var t=e;return"<Doc ".concat(JSON.stringify(t.getAttributes()),">")}return e instanceof y?"</Doc>":e instanceof b?"<Block.".concat(e.getType()," ").concat(JSON.stringify(e.getAttributes()),">"):e instanceof V?"</Block>":e instanceof U?"<Inline.".concat(e.getType()," ").concat(JSON.stringify(e.getAttributes()),">"):e instanceof J?"</Inline>":"\n"===e?"\\n":e}).join("\n")}},{key:"parse",value:function(e){var t=e.split("\n").map(function(e){var t=/^<Doc\s(.+)>/;if(t.test(e)){var i=e.match(t),n=JSON.parse(i[1]);return new m(n)}if("</Doc>"===e)return new y;var o=/^<Block\.(\w+)\s(.+)>/;if(o.test(e)){var r=e.match(o),a=r[1],s=JSON.parse(r[2]);return new b(a,s)}if("</Block>"===e)return new V;var u=/^<Inline\.(\w+)\s(.+)>/;if(u.test(e)){var c=e.match(u),l=c[1],h=JSON.parse(c[2]);return new U(l,h)}if("</Inline>"===e)return new J;if(1===e.length)return e;if("\\n"===e)return"\n";throw new Error("Cannot parse serialized token: ".concat(e))});return new $(t)}}]),e}(),F=function(e){function t(){return Object(s.a)(this,t),Object(c.a)(this,Object(l.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(u.a)(t,[{key:"getType",value:function(){return t.getType()}}],[{key:"getType",value:function(){return"Paragraph"}}]),t}(function(e){function t(e,i,n){var o;if(Object(s.a)(this,t),(o=Object(c.a)(this,Object(l.a)(t).call(this))).taleWeaver=e,o.parent=i,o.children=[],!(n[0]instanceof b))throw new Error("Error building block from tokens, expecting first token to be BlockStartToken.");if(!(n[n.length-1]instanceof V))throw new Error("Error building block from tokens, expecting last token to be BlockEndToken.");var r=n[0];o.attributes=r.getAttributes();for(var a=1,u=0,h=1,g=n.length-1;h<g;h++){var f=n[h];if(f instanceof U?(0===u&&(a=h),u+=1):f instanceof J&&(u-=1),0===u){var w=n.slice(a,h+1),v=n[a],p=new(e.getConfig().getInlineClass(v.getType()))(e,Object(d.a)(Object(d.a)(o)),w);o.appendChild(p)}}return o}return Object(h.a)(t,e),Object(u.a)(t,[{key:"getSize",value:function(){var e=0;return this.children.forEach(function(t){e+=t.getSize()}),e}},{key:"getParent",value:function(){return this.parent}},{key:"getPreviousSibling",value:function(){var e=this.parent.getChildren(),t=e.indexOf(this);if(t<0)throw new Error("Model is corrupted, block not found in parent.");return 0===t?null:e[t-1]}},{key:"getNextSibling",value:function(){var e=this.parent.getChildren(),t=e.indexOf(this);if(t<0)throw new Error("Model is corrupted, block not found in parent.");return t===e.length-1?null:e[t+1]}},{key:"appendChild",value:function(e){this.children.push(e)}},{key:"removeChild",value:function(e){var t=this.children.indexOf(e);t<0||this.children.splice(t,1)}},{key:"getChildren",value:function(){return this.children}},{key:"parentAt",value:function(e){if(e<0)throw new Error("Block offset out of range: ".concat(e,"."));if(e>this.getSize()-1)throw new Error("Block offset out of range: ".concat(e,"."));for(var t=this.parent,i=t.getChildren(),n=1,o=0,r=i.length;o<r;o++){var a=i[o];if(a===this)return new p(t,n+e);n+=a.getSize()}throw new Error("Model is corrupted, block not found in parent.")}},{key:"childAt",value:function(e){if(e<0)throw new Error("Block offset out of range: ".concat(e,"."));for(var t=0,i=0,n=this.children.length;i<n;i++){var o=this.children[i],r=o.getSize();if(e<t+r)return new p(o,e-t);t+=r}throw new Error("Block offset out of range: ".concat(e,"."))}}]),t}(w)),Q=function(e){function t(){return Object(s.a)(this,t),Object(c.a)(this,Object(l.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(u.a)(t,[{key:"getType",value:function(){return t.getType()}}],[{key:"getType",value:function(){return"Text"}}]),t}(function(e){function t(e,i,n){var o;if(Object(s.a)(this,t),(o=Object(c.a)(this,Object(l.a)(t).call(this))).taleWeaver=e,o.parent=i,!(n[0]instanceof U))throw new Error("Error building inline from tokens, expecting first token to be InlineStartToken.");if(!(n[n.length-1]instanceof J))throw new Error("Error building inline from tokens, expecting last token to be InlineEndToken.");var r=n[0];return o.attributes=r.getAttributes(),o.content=n.slice(1,n.length-1).join(""),o}return Object(h.a)(t,e),Object(u.a)(t,null,[{key:"fromTokens",value:function(e,t,i){if(!(i[0]instanceof U))throw new Error("Error building block from tokens, expecting first token to be InlineStartToken.");if(!(i[i.length-1]instanceof J))throw new Error("Error building block from tokens, expecting last token to be InlineEndToken.");var n=i[0];return new(e.getConfig().getInlineClass(n.getType()))(t,i.slice(1,i.length-1).join(""),n.getAttributes())}}]),Object(u.a)(t,[{key:"getSize",value:function(){return this.content.length}},{key:"getParent",value:function(){return this.parent}},{key:"getPreviousSibling",value:function(){var e=this.parent.getChildren(),t=e.indexOf(this);if(t<0)throw new Error("Model is corrupted, block not found in parent.");return 0===t?null:e[t-1]}},{key:"getNextSibling",value:function(){var e=this.parent.getChildren(),t=e.indexOf(this);if(t<0)throw new Error("Model is corrupted, block not found in parent.");return t===e.length-1?null:e[t+1]}},{key:"parentAt",value:function(e){if(e<0)throw new Error("Inline offset out of range: ".concat(e,"."));if(e>this.getSize()-1)throw new Error("Inline offset out of range: ".concat(e,"."));for(var t=this.parent,i=t.getChildren(),n=1,o=0,r=i.length;o<r;o++){var a=i[o];if(a===this)return new p(t,n+e);n+=a.getSize()}throw new Error("Model is corrupted, inline not found in parent.")}},{key:"setContent",value:function(e){this.content=e}},{key:"getContent",value:function(){return this.content}}]),t}(v)),Y=[" ","\t","\n"],G=function(e){function t(){return Object(s.a)(this,t),Object(c.a)(this,Object(l.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(u.a)(t,[{key:"getType",value:function(){return t.getType()}},{key:"getSize",value:function(){var e=0;return this.segments.forEach(function(t){e+=t.to-t.from+1}),e}}],[{key:"getType",value:function(){return"Text"}},{key:"fromInline",value:function(e,i,n){for(var o=i.getContent(),r=0,a=0,s=[],u=o.length;a<u;a++){var c=o[a];Y.indexOf(c)>=0&&(s.push(new t(e,[{inline:i,from:r,to:a}],n)),r=a+1)}return r<a-1&&s.push(new t(e,[{inline:i,from:r,to:a-1}],n)),s}},{key:"postProcess",value:function(e,i,n){var o=[],r=[];return i.forEach(function(i){if(!(i instanceof t))return r.length>0&&(o.push(new t(e,r,n)),r=[]),void o.push(i);var a,s=i.getSegments(),u=s[s.length-1],c=u.inline.getContent();Y.indexOf(c[u.to])>=0?r.length>0?(o.push(new t(e,Object(C.a)(r).concat(Object(C.a)(i.getSegments())),n)),r=[]):o.push(i):(a=r).push.apply(a,Object(C.a)(s))}),r.length>0&&o.push(new t(e,r,n)),o}}]),t}(function(e){function t(e,i,n){var o;return Object(s.a)(this,t),(o=Object(c.a)(this,Object(l.a)(t).call(this))).taleWeaver=e,o.segments=i,o.parent=n,o}return Object(h.a)(t,e),Object(u.a)(t,[{key:"getParent",value:function(){return this.parent}},{key:"getPreviousSibling",value:function(){var e=this.parent.getChildren(),t=e.indexOf(this);if(t<0)throw new Error("Model is corrupted, block not found in parent.");return 0===t?null:e[t-1]}},{key:"getNextSibling",value:function(){var e=this.parent.getChildren(),t=e.indexOf(this);if(t<0)throw new Error("Model is corrupted, block not found in parent.");return t===e.length-1?null:e[t+1]}},{key:"parentAt",value:function(e){if(e<0)throw new Error("Word view offset out of range: ".concat(e,"."));if(e>this.getSize()-1)throw new Error("Word view offset out of range: ".concat(e,"."));for(var t=this.parent,i=t.getChildren(),n=1,o=0,r=i.length;o<r;o++){var a=i[o];if(a===this)return new p(t,n+e);n+=a.getSize()}throw new Error("View model is corrupted, word view not found in parent.")}},{key:"getSegments",value:function(){return this.segments}}]),t}(v)),Z=function(e){function t(e){var i;return Object(s.a)(this,t),(i=Object(c.a)(this,Object(l.a)(t).call(this,e))).mounted=!1,i}return Object(h.a)(t,e),Object(u.a)(t,[{key:"mount",value:function(){if(!this.mounted){var e=this.getPageView().getDOM().domPageContent;this.domParagraphLine=document.createElement("div"),this.domParagraphLine.className="tw--paragraph-line",e.appendChild(this.domParagraphLine),this.wordViews.forEach(function(e){return e.mount()})}}},{key:"getDOM",value:function(){return{domLine:this.domParagraphLine,domLineContent:this.domParagraphLine}}}]),t}(function(){function e(t){Object(s.a)(this,e),this.config=t,this.wordViews=[]}return Object(u.a)(e,[{key:"getSize",value:function(){var e=0;return this.wordViews.forEach(function(t){return e+=t.getSize()}),e}},{key:"setPageView",value:function(e){this.pageView=e}},{key:"getPageView",value:function(){return this.pageView}},{key:"getPreviousLineView",value:function(){var e=this.pageView.getLineViews(),t=e.indexOf(this);if(t<0)return null;if(0===t){var i=this.pageView.getPreviousPageView();if(!i)return null;var n=i.getLineViews();return n[n.length-1]}return e[t-1]}},{key:"getNextLineView",value:function(){var e=this.pageView.getLineViews(),t=e.indexOf(this);if(t<0)return null;if(t===e.length-1){var i=this.pageView.getNextPageView();return i?i.getLineViews()[0]:null}return e[t+1]}},{key:"appendWordView",value:function(e){this.wordViews.push(e)}},{key:"removeWordView",value:function(e){var t=this.wordViews.indexOf(e);t<0||this.wordViews.splice(t,1)}},{key:"getWordViews",value:function(){return this.wordViews}},{key:"getHeight",value:function(){return Math.max.apply(Math,Object(C.a)(this.wordViews.map(function(e){return e.getHeight()})))}},{key:"mapModelPositionRangeToViewPositionBox",value:function(e,t){for(var i={x1:-1,x2:-1,height:0},n=0,o=0,r=0,a=this.wordViews.length;r<a;r++){var s=this.wordViews[r];if(t>=n&&e<n+s.getSize()){var u=s.mapModelPositionRangeToViewPositionBox(Math.max(0,e-n),Math.min(s.getSize(),t-n));n<=e&&n+s.getSize()>e&&(i.x1=o+u.x1),n<=t&&n+s.getSize()>=t&&(i.x2=o+u.x2),i.height<u.height&&(i.height=u.height)}n+=s.getSize(),o+=s.getWidth()}return i}},{key:"mapViewPositionToModelPosition",value:function(e){for(var t=0,i=0,n=0,o=this.wordViews.length;n<o;n++){var r=this.wordViews[n];if(i+r.getWidth()>=e){t+=r.mapViewPositionToModelPosition(e-i);break}t+=r.getSize(),i+=r.getWidth()}return t>=this.getSize()&&(t-=1),t}},{key:"resolveModelPosition",value:function(e){for(var t=0,i=0,n=this.wordViews.length;i<n;i++){var o=this.wordViews[i];if(t+o.getSize()>=e){var r=o.resolveModelPosition(e-t);return Object(E.a)({},r,{lineView:this,lineViewPosition:e})}t+=o.getSize()}throw new Error("Cannot resolve line model position ".concat(e,"."))}}]),e}()),_=function(){function e(t,i){Object(s.a)(this,e),this.wordViewModel=t,this.config=i}return Object(u.a)(e,[{key:"getSize",value:function(){return this.wordViewModel.getSize()}},{key:"setLineView",value:function(e){this.lineView=e}},{key:"getLineView",value:function(){return this.lineView}},{key:"getPreviousWordView",value:function(){var e=this.lineView.getWordViews(),t=e.indexOf(this);if(t<0)return null;if(0===t){var i=this.lineView.getPreviousLineView();if(!i)return null;var n=i.getWordViews();return n[n.length-1]}return e[t-1]}},{key:"getNextWordView",value:function(){var e=this.lineView.getWordViews(),t=e.indexOf(this);if(t<0)return null;if(t===e.length-1){var i=this.lineView.getNextLineView();return i?i.getWordViews()[0]:null}return e[t+1]}},{key:"resolveModelPosition",value:function(e){return{wordView:this,wordViewPosition:e}}}]),e}();var ee=new(function(){function e(){Object(s.a)(this,e),this.$iframe=document.createElement("iframe"),this.$iframe.src="about:blank",this.$iframe.style.width="0",this.$iframe.style.height="0",this.$iframe.style.border="none",document.body.appendChild(this.$iframe),this.$textContainers=new Map}return Object(u.a)(e,[{key:"getTextContainerElement",value:function(e){var t=function(e){return JSON.stringify(e)}(e);if(!this.$textContainers.has(t)){var i=document.createElement("span");i.style.display="inline-block",i.style.whiteSpace="pre",i.style.fontFamily=e.fontFamily,i.style.fontSize="".concat(e.fontSize,"px"),i.style.fontWeight="".concat(e.fontWeight),i.style.lineHeight="".concat(e.lineHeight,"px"),i.style.letterSpacing="".concat(e.letterSpacing),this.$iframe.contentDocument.body.appendChild(i),this.$textContainers.set(t,i)}return this.$textContainers.get(t)}},{key:"measure",value:function(e,t){var i=e.replace(/\n$/," "),n=this.getTextContainerElement(t);n.innerHTML!==i&&(n.innerHTML=i);var o=n.getBoundingClientRect();return{width:o.width,height:o.height}}}]),e}());function te(e,t){return ee.measure(e,t)}var ie={fontFamily:"Arial",fontSize:18,fontWeight:400,lineHeight:36,letterSpacing:0},ne=function(e){function t(e,i){var n;return Object(s.a)(this,t),(n=Object(c.a)(this,Object(l.a)(t).call(this,e,i))).mounted=!1,n}return Object(h.a)(t,e),Object(u.a)(t,[{key:"mount",value:function(){if(!this.mounted){var e=this.getLineView().getDOM().domLineContent,t=this.wordViewModel,i="";t.getSegments().forEach(function(e){i+=e.inline.getContent().substring(e.from,e.to+1)}),this.domTextWord=document.createTextNode(i),e.appendChild(this.domTextWord)}}},{key:"getDOM",value:function(){return{domWord:this.domTextWord,domWordContent:this.domTextWord}}},{key:"getWidth",value:function(){return void 0===this.width&&this.measure(),this.width}},{key:"getHeight",value:function(){return void 0===this.height&&this.measure(),this.height}},{key:"mapModelPositionRangeToViewPositionBox",value:function(e,t){return{x1:this.getScreenX(e),x2:this.getScreenX(t),height:this.getHeight()}}},{key:"mapViewPositionToModelPosition",value:function(e){var t=this.wordViewModel,i="";t.getSegments().forEach(function(e){i+=e.inline.getContent().substring(e.from,e.to+1)});for(var n=0,o=1,r=i.length;o<r;o++){var a=te(i.substring(0,o),ie).width;if(a>e)return e-n>a-e?o:o-1;n=a}return e-n>this.getWidth()-e?i.length:i.length-1}},{key:"measure",value:function(){var e=this.wordViewModel,t="";e.getSegments().forEach(function(e){t+=e.inline.getContent().substring(e.from,e.to+1)});var i=te(t,ie);this.width=i.width,this.height=i.height}},{key:"getScreenX",value:function(e){var t=this.wordViewModel,i="";return t.getSegments().forEach(function(e){i+=e.inline.getContent().substring(e.from,e.to+1)}),0===e?0:te(i.substring(0,e),ie).width}}]),t}(_),oe=function(){function e(t){Object(s.a)(this,e),this.taleWeaver=t}return Object(u.a)(e,[{key:"dispatchCursorCommand",value:function(e){var t=e(this.taleWeaver);this.taleWeaver.applyEditorCursorTransformation(t)}},{key:"dispatchDocumentCommand",value:function(e){var t=e(this.taleWeaver);this.taleWeaver.applyDocumentTransformation(t)}}]),e}(),re=function(e){function t(){return Object(s.a)(this,t),Object(c.a)(this,Object(l.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(u.a)(t,[{key:"onEvent",value:function(e){if(e instanceof N){var t=e;"ArrowLeft"===t.key?t.shift?t.alt?this.dispatchCursorCommand(function(e){var t=new x,i=e.getEditorCursor();if(!i)return t;var n=i.getHead(),o=e.getDocView().resolveModelPosition(n);if(o.wordViewPosition>0)t.addStep(new z(0-o.wordViewPosition));else{var r=o.wordView.getPreviousWordView();r&&t.addStep(new z(0-r.getSize()))}return t}):t.meta?this.dispatchCursorCommand(L()):this.dispatchCursorCommand(function(e){var t=new x,i=e.getEditorCursor();return i?i.getHead()<1?t:(t.addStep(new z(-1)),t):t}):t.alt?this.dispatchCursorCommand(function(e){var t=new x,i=e.getEditorCursor();if(!i)return t;var n=i.getHead(),o=e.getDocView().resolveModelPosition(n);if(o.wordViewPosition>0)t.addStep(new M(0-o.wordViewPosition));else{var r=o.wordView.getPreviousWordView();r&&t.addStep(new M(0-r.getSize()))}return t}):t.meta?this.dispatchCursorCommand(T()):this.dispatchCursorCommand(function(e){var t=new x,i=e.getEditorCursor();if(!i)return t;var n=i.getAnchor(),o=i.getHead();if(n===o){if(o<1)return t;t.addStep(new M(-1))}else n<o?t.addStep(new M(n-o)):n>o&&t.addStep(new M(0));return t}):"ArrowRight"===t.key?t.shift?t.alt?this.dispatchCursorCommand(function(e){var t=new x,i=e.getEditorCursor();if(!i)return t;var n=i.getHead(),o=e.getDocView().resolveModelPosition(n);if(o.wordViewPosition<o.wordView.getSize())t.addStep(new z(o.wordView.getSize()-o.wordViewPosition));else{var r=o.wordView.getNextWordView();r&&t.addStep(new z(r.getSize()))}return t}):t.meta?this.dispatchCursorCommand(H()):this.dispatchCursorCommand(function(e){var t=new x,i=e.getEditorCursor();return i?i.getHead()>=e.getDoc().getSize()-1?t:(t.addStep(new z(1)),t):t}):t.alt?this.dispatchCursorCommand(function(e){var t=new x,i=e.getEditorCursor();if(!i)return t;var n=i.getHead(),o=e.getDocView().resolveModelPosition(n);if(o.wordViewPosition<o.wordView.getSize())t.addStep(new M(o.wordView.getSize()-o.wordViewPosition));else{var r=o.wordView.getNextWordView();r&&t.addStep(new M(r.getSize()))}return t}):t.meta?this.dispatchCursorCommand(D()):this.dispatchCursorCommand(function(e){var t=new x,i=e.getEditorCursor();if(!i)return t;var n=i.getAnchor(),o=i.getHead();if(n===o){if(o>=e.getDoc().getSize()-1)return t;t.addStep(new M(1))}else n<o?t.addStep(new M(0)):n>o&&t.addStep(new M(n-o));return t}):"ArrowUp"===t.key?t.shift?t.alt?this.dispatchCursorCommand(L()):t.meta?this.dispatchCursorCommand(function(e){var t=new x,i=e.getEditorCursor();if(!i)return t;var n=i.getHead();return t.addStep(new z(0-n)),t}):this.dispatchCursorCommand(function(e){var t=new x,i=e.getEditorCursor();if(!i)return t;var n=i.getHead(),o=e.getDocView(),r=o.resolveModelPosition(n),a=r.lineView.getPreviousLineView();if(!a)return L()(e);var s,u=o.getEditorCursorView();if(!u)return t;s=null!==u.getLineViewX()?u.getLineViewX():r.lineView.mapModelPositionRangeToViewPositionBox(r.lineViewPosition,r.lineViewPosition).x1;var c=a.mapViewPositionToModelPosition(s);return t.addStep(new z(0-r.lineViewPosition-a.getSize()+c,!0)),t}):t.alt?this.dispatchCursorCommand(T()):t.meta?this.dispatchCursorCommand(function(e){var t=new x,i=e.getEditorCursor();if(!i)return t;var n=i.getHead();return t.addStep(new M(0-n)),t}):this.dispatchCursorCommand(function(e){var t=new x,i=e.getEditorCursor();if(!i)return t;var n=Math.min(i.getHead(),i.getAnchor()),o=e.getDocView(),r=o.resolveModelPosition(n),a=r.lineView.getPreviousLineView();if(!a)return T()(e);var s,u=o.getEditorCursorView();if(!u)return t;s=null!==u.getLineViewX()?u.getLineViewX():r.lineView.mapModelPositionRangeToViewPositionBox(r.lineViewPosition,r.lineViewPosition).x1;var c=a.mapViewPositionToModelPosition(s);return t.addStep(new M(0-r.lineViewPosition-a.getSize()+c,!0)),t}):"ArrowDown"===t.key&&(t.shift?t.alt?this.dispatchCursorCommand(H()):t.meta?this.dispatchCursorCommand(function(e){var t=new x,i=e.getEditorCursor();if(!i)return t;var n=i.getHead(),o=e.getDoc().getSize();return t.addStep(new z(o-1-n)),t}):this.dispatchCursorCommand(function(e){var t=new x,i=e.getEditorCursor();if(!i)return t;var n=i.getHead(),o=e.getDocView(),r=o.resolveModelPosition(n),a=r.lineView.getNextLineView();if(!a)return H()(e);var s,u=o.getEditorCursorView();if(!u)return t;s=null!==u.getLineViewX()?u.getLineViewX():r.lineView.mapModelPositionRangeToViewPositionBox(r.lineViewPosition,r.lineViewPosition).x1;var c=a.mapViewPositionToModelPosition(s);return t.addStep(new z(r.lineView.getSize()-r.lineViewPosition+c,!0)),t}):t.alt?this.dispatchCursorCommand(D()):t.meta?this.dispatchCursorCommand(function(e){var t=new x,i=e.getEditorCursor();if(!i)return t;var n=i.getHead(),o=e.getDoc().getSize();return t.addStep(new M(o-1-n)),t}):this.dispatchCursorCommand(function(e){var t=new x,i=e.getEditorCursor();if(!i)return t;var n=Math.max(i.getHead(),i.getAnchor()),o=e.getDocView(),r=o.resolveModelPosition(n),a=r.lineView.getNextLineView();if(!a)return D()(e);var s,u=o.getEditorCursorView();if(!u)return t;s=null!==u.getLineViewX()?u.getLineViewX():r.lineView.mapModelPositionRangeToViewPositionBox(r.lineViewPosition,r.lineViewPosition).x1;var c=a.mapViewPositionToModelPosition(s);return t.addStep(new M(r.lineView.getSize()-r.lineViewPosition+c,!0)),t}))}}}]),t}(oe),ae=function(){function e(){Object(s.a)(this,e),this.steps=[],this.steps=[]}return Object(u.a)(e,[{key:"addStep",value:function(e){this.steps.push(e)}},{key:"getSteps",value:function(){return this.steps}}]),e}();var se=function(e){function t(){return Object(s.a)(this,t),Object(c.a)(this,Object(l.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(u.a)(t,[{key:"onEvent",value:function(e){var t;e instanceof N&&("a"===e.key&&this.dispatchDocumentCommand((t="a",function(e){var i=new ae;return i.addStep(new q(t)),i})))}}]),t}(oe),ue=function(){function e(){Object(s.a)(this,e),this.blockClasses={},this.inlineClasses={},this.wordViewModelClasses={},this.lineViewClasses={},this.wordViewClasses={},this.eventObserverClasses=[],this.registerBlockType("Paragraph",F,Z),this.registerInlineType("Text",Q,G,ne),this.registerEventObserverClass(re),this.registerEventObserverClass(se)}return Object(u.a)(e,[{key:"registerBlockType",value:function(e,t,i){this.blockClasses[e]=t,this.lineViewClasses[e]=i}},{key:"registerInlineType",value:function(e,t,i,n){this.inlineClasses[e]=t,this.wordViewModelClasses[e]=i,this.wordViewClasses[e]=n}},{key:"getBlockClass",value:function(e){var t=this.blockClasses[e];if(!t)throw new Error("Block type ".concat(e," is not registered."));return t}},{key:"getInlineClass",value:function(e){var t=this.inlineClasses[e];if(!t)throw new Error("Inline type ".concat(e," is not regsitered."));return t}},{key:"getWordViewModelClass",value:function(e){var t=this.wordViewModelClasses[e];if(!t)throw new Error("Inline type ".concat(e," is not regsitered."));return t}},{key:"getLineViewClass",value:function(e){var t=this.lineViewClasses[e];if(!t)throw new Error("Block type ".concat(e," is not regsitered."));return t}},{key:"getWordViewClass",value:function(e){var t=this.wordViewClasses[e];if(!t)throw new Error("Inline type ".concat(e," is not regsitered."));return t}},{key:"registerEventObserverClass",value:function(e){this.eventObserverClasses.push(e)}},{key:"getEventObserverClasses",value:function(){return this.eventObserverClasses}}]),e}();var ce=function(){function e(t,i,n){Object(s.a)(this,e),this.id=n||"".concat(Date.now().toString(36)).concat(Math.random().toString(36).substring(2)),this.anchor=t,this.head=i,this.observers=[]}return Object(u.a)(e,[{key:"notifyObservers",value:function(e){var t=this;this.observers.forEach(function(i){i(t,e)}),document.getElementById("status").innerText="".concat(this.anchor,", ").concat(this.head)}},{key:"getID",value:function(){return this.id}},{key:"observe",value:function(e){this.observers.push(e)}},{key:"moveTo",value:function(e,t){this.anchor=e,this.head=e,this.notifyObservers(t)}},{key:"moveHeadTo",value:function(e,t){this.head=e,this.notifyObservers(t)}},{key:"getAnchor",value:function(){return this.anchor}},{key:"getHead",value:function(){return this.head}}]),e}(),le="\nLorem ipsum dolor sit amet, consectetur adipiscing elit. Donec luctus commodo magna eu gravida. Quisque et neque ornare nunc maximus faucibus. Ut molestie diam non interdum fringilla. In hac habitasse platea dictumst. Proin dignissim id diam a pharetra. Praesent nec arcu felis. Nam et cursus mi. Duis facilisis ex vel leo vulputate laoreet. Pellentesque turpis quam, sollicitudin at lobortis non, rhoncus eu neque. Quisque egestas, ex vitae porta accumsan, justo dui elementum nisi, et bibendum lectus diam ut mauris. Proin imperdiet vulputate congue. Lorem ipsum dolor sit amet, consectetur adipiscing elit. Suspendisse nec tristique odio. Nulla eget tortor eu felis mattis mattis. Duis in nulla ultricies, egestas nunc ac, tempor tellus.\nCras condimentum nisi diam, vitae ornare libero porttitor at. Curabitur id nibh aliquam lacus malesuada tincidunt id eget mauris. Donec venenatis non ipsum quis fermentum. Vestibulum dignissim finibus neque, et mattis orci mollis id. Nunc pellentesque, neque sed fermentum fermentum, felis nunc porttitor lorem, et pulvinar leo quam ut elit. Quisque sit amet venenatis mauris. In hac habitasse platea dictumst. Praesent sem mauris, tincidunt ut sollicitudin et, molestie ac magna. Etiam faucibus porta dapibus. Cras velit augue, molestie id est in, ullamcorper sodales mauris. Nunc ullamcorper eros purus, eget placerat eros pharetra fermentum. Nunc ullamcorper euismod dui, tempor pulvinar mi pretium vel. Nullam nec nisi mi. Phasellus fermentum diam vel lacus bibendum imperdiet. Cras enim mi, cursus at velit feugiat, sagittis sagittis urna.\nMaecenas id efficitur nulla, ornare posuere felis. Nulla lobortis tortor vel massa lobortis, sit amet rhoncus neque placerat. Curabitur maximus iaculis faucibus. In tincidunt posuere justo at pulvinar. Maecenas viverra at odio nec porta. Pellentesque ultrices eros vitae velit scelerisque, et tempor lectus sodales. Duis tempus quam nec tortor consequat consectetur. Nulla facilisi. Nam id lectus magna. Nulla metus mauris, tincidunt at ante a, pulvinar tincidunt metus. Nulla nec magna sit amet sapien feugiat commodo at in dolor. Aenean mauris enim, posuere et dolor quis, ornare sollicitudin dui. Vivamus aliquet metus turpis, in maximus enim aliquam in. Sed vel quam vitae metus condimentum aliquam.\nSuspendisse egestas vulputate arcu, ut laoreet felis feugiat sed. Donec dui sem, aliquet euismod sollicitudin sed, cursus non urna. Ut blandit enim diam, vitae rhoncus nisl accumsan non. Nulla facilisi. Vestibulum nec scelerisque augue, sed volutpat est. Integer augue turpis, varius ac velit non, ornare venenatis lectus. Nullam porta neque vel risus semper ornare id a enim. Cras tristique non quam quis commodo.\nFusce condimentum arcu et diam faucibus, sit amet mattis velit pharetra. Praesent sagittis rhoncus libero, placerat ornare dui varius eget. Fusce consequat metus ut dignissim luctus. In congue lectus ut magna varius, at aliquam mi rutrum. Nam eu nunc eu ipsum varius pulvinar ac ut nulla. Nullam non elit neque. Vestibulum quis molestie dolor, eu vehicula risus. Sed luctus velit sem, id vestibulum orci blandit at. In aliquam gravida aliquam. Vivamus semper vulputate purus eu vehicula. Ut condimentum quis velit et feugiat. Curabitur eget ex eget mi interdum condimentum eget sit amet purus. Aliquam et libero erat. Aliquam erat volutpat.\n".trim(),he="<Doc {}>\n";le.split("\n").forEach(function(e){he+="<Block.Paragraph {}>\n",he+="<Inline.Text {}>\n",e.split("").forEach(function(e){he+="".concat(e,"\n")}),he+="\\n\n",he+="</Inline>\n",he+="</Block>\n"}),he+="</Doc>";var de=function(e){function t(e){var i;Object(s.a)(this,t),(i=Object(c.a)(this,Object(l.a)(t).call(this,e))).domRef=o.a.createRef();var n=new ue,r=(new K).parse(e.initialData),a=new ce(0,0),u=new X(n,r,a);return i.state={taleWeaver:u},i}return Object(h.a)(t,e),Object(u.a)(t,[{key:"componentDidMount",value:function(){var e=this.domRef.current;this.state.taleWeaver.mount(e)}},{key:"render",value:function(){return o.a.createElement("div",{className:"tw--container",ref:this.domRef})}}]),t}(o.a.Component),ge=function(e){function t(){return Object(s.a)(this,t),Object(c.a)(this,Object(l.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){return o.a.createElement("div",{className:"app"},o.a.createElement(de,{initialData:he}))}}]),t}(o.a.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));a.a.render(o.a.createElement(ge,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}},[[11,2,1]]]);
//# sourceMappingURL=main.31aefb39.chunk.js.map