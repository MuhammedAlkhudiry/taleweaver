{"version":3,"sources":["editor/element/DocumentElement.ts","editor/element/block/ParagraphElement.ts","editor/element/BlockElement.ts","editor/element/InlineElement.ts","editor/element/word/TextWord.ts","editor/element/Word.ts","editor/element/inline/TextElement.ts","editor/view/PageView.ts","editor/helpers/throttle.ts","editor/state/CursorTransformation.ts","editor/state/cursortransformationsteps/TranslateCursor.ts","editor/command/cursor/moveBackwardByLine.ts","editor/command/cursor/moveForwardByLine.ts","editor/state/cursortransformationsteps/TranslateCursorHead.ts","editor/command/cursor/moveHeadTo.ts","editor/command/cursor/moveHeadBackwardByLine.ts","editor/command/cursor/moveHeadForwardByLine.ts","editor/view/EditorCursorView.ts","editor/command/cursor/moveTo.ts","editor/view/ObserverCursorView.ts","editor/event/Event.ts","editor/view/DocumentView.ts","editor/view/ParagraphLineView.ts","editor/view/LineView.ts","editor/view/BoxView.ts","editor/view/helpers/measureText.ts","editor/view/TextView.ts","editor/state/CursorTransformer.ts","editor/state/DocumentTransformer.ts","editor/event/EditorCursorEventObserver.ts","editor/command/cursor/moveHeadBackwardByWord.ts","editor/command/cursor/moveHeadBackwardByChar.ts","editor/command/cursor/moveBackwardByWord.ts","editor/command/cursor/moveBackwardByChar.ts","editor/command/cursor/moveHeadForwardByWord.ts","editor/command/cursor/moveHeadForwardByChar.ts","editor/command/cursor/moveForwardByWord.ts","editor/command/cursor/moveForwardByChar.ts","editor/command/cursor/moveHeadToDocumentStart.ts","editor/command/cursor/moveToDocumentStart.ts","editor/command/cursor/moveHeadToDocumentEnd.ts","editor/command/cursor/moveToDocumentEnd.ts","editor/event/EventObserver.ts","editor/TaleWeaver.ts","editor/state/State.ts","editor/cursor/Cursor.ts","App.tsx","editor/state/helpers/parseStateJSON.ts","serviceWorker.ts","index.tsx"],"names":["DocumentElement","Object","classCallCheck","this","children","child","push","index","indexOf","splice","position","cumulatedSize","n","nn","length","getSize","size","forEach","ParagraphElement","BlockElement","parent","InlineElement","text","TextWord","Word","inlineElement","BREAKABLE_CHARS","TextElement","words","getText","wordFromIndex","textIndex","textLength","char","word","setText","substring","PageView","documentView","eventHandlers","config","_this","handleSelectStart","event","preventDefault","handleMouseDown","resolveScreenPosition","pageX","pageY","onPointerDown","pageView","pageViewPosition","handleMouseMove","func","milliseconds","throttledRunTimeout","lastRunAt","_len","arguments","args","Array","_key","clearTimeout","setTimeout","apply","Date","now","throttle","onPointerMove","handleMouseUp","onPointerUp","lineViews","x","y","lineView","leftMax","width","paddingLeft","paddingRight","topMax","height","paddingTop","paddingBottom","left","Math","min","max","domElement","offsetLeft","top","offsetTop","cumulatedHeight","lineViewHeight","getHeight","boxView","boxViews","getBoxViews","cumulatedWidth","boxViewWidth","getWidth","getDocumentPosition","setPageView","parentDOMElement","getDocumentView","getDOMElement","document","createElement","className","style","concat","padding","userSelect","addEventListener","bindToDOM","appendChild","from","to","currentPosition","Error","screenPositions","lineViewScreenPosition","getScreenPosition","slice","reduce","line","CursorTransformation","steps","step","TranslateCursor","displacement","moveBackwardByLine","taleWeaver","transformation","editorCursor","getState","getEditorCursor","head","getHead","lineStart","getLineStartPosition","addStep","moveForwardByLine","lineEnd","getLineEndPosition","TranslateCursorHead","moveHeadTo","moveHeadBackwardByLine","moveHeadRightByLine","EditorCursorView","selectionDOMElements","selecting","blinkState","blinkInterval","renderHead","renderSelections","_documentScreenPositi","getScreenPositions","pageViewScreenPositions","headDOMElement","getConfig","pageViewDOMElement","parentElement","removeChild","anchor","getAnchor","documentScreenPositions","selectionsCount","_ref","selectionDOMElement","pop","background","selectionIndex","_ref2","pageViewScreenPosition","pointerEvents","_this2","marginLeft","visibility","render","startBlinking","observe","stopBlinking","_this3","setInterval","clearInterval","applyEditorCursorTransformation","moveTo","ObserverCursorView","observerCursor","KeyPressEvent","key","shift","meta","alt","DocumentView","documentElement","resolvePageViewPosition","pageViews","loopPageView","handlePointerDownOnPage","editorCursorView","beginSelect","handlePointerMoveOnPage","moveSelect","handlePointerUpOnPage","endSelect","handleKeyDown","dispatchEvent","shiftKey","metaKey","altKey","handleKeyUp","boxViewBlocks","observerCursorViews","buildBoxViewBlocks","buildLineViews","buildPageViews","buildEditorCursorView","buildObserverCursorViews","registry","getRegistry","getChildren","blockElement","boxViewBlock","getWords","getBoxViewClass","getType","setWord","pageContentWidth","pageWidth","pagePaddingLeft","pagePaddingRight","LineView","getLineViewClass","setLineView","appendBoxView","_this4","pageViewConigs","pageHeight","pagePaddingTop","pagePaddingBottom","pageContentHeight","appendLineView","setDocumentView","_this5","getObserverCursors","observerCursorView","setObserverCursor","containerDOMElement","window","getLineViews","m","mm","wordViews","o","oo","wordView","previousLineViewWordViews","previousPageViewLineViews","nextLineViewWordViews","nextPageViewLineViews","ParagraphLineView","getPageView","toConsumableArray","map","boxViewSize","boxViewScreenPosition","rightScreenPosition","BoxView","getWord","textMeasurer","TextMeasurer","$iframe","src","border","body","$textContainers","Map","createClass","value","textStyle","textStyleKey","JSON","stringify","getTextStyleKey","has","$textContainer","display","whiteSpace","fontFamily","fontSize","fontWeight","lineHeight","letterSpacing","contentDocument","set","get","getTextContainerElement","innerHTML","boundingClientRect","getBoundingClientRect","measureText","measure","placeholderTextStyle","TextView","measurement","getLineView","textWord","createTextNode","undefined","screenPosition","lastWidth","CursorTransformer","cursor","getSteps","getDisplacement","DocumentTransformer","EditorCursorEventObserver","keyPressEvent","dispatchCursorCommand","wordStart","getWordStartPosition","wordEnd","getWordEndPosition","moveHeadForwardByLine","getDocumentElement","documentSize","EventObserver","cursorCommand","cursorTransformation","TaleWeaverRegistry","blockElementClasses","inlineElementClasses","lineViewClasses","boxViewClasses","eventObservers","registerDocumentElementClass","registerBlockElementClass","registerInlineElementClass","registerDocumentViewClass","registerPageViewClass","registerLineViewClass","registerBoxViewClass","registerCursorTransformer","registerDocumentTransformer","registerEventObserver","documentElementClass","type","blockElementClass","inlineElementClass","documentViewClass","pageViewClass","lineViewClass","boxViewClass","cursorTransformer","documentTransformer","eventObserver","TaleWeaver","state","getDocumentViewClass","State","observerCursors","getEventObservers","onEvent","getCursorTransformer","Cursor","id","toString","random","observers","observer","notifyObservers","initialStateJSON","TaleWeaverComponent","props","possibleConstructorReturn","getPrototypeOf","call","domRef","React","createRef","setState","stateJSON","getDocumentElementClass","blockElementJSON","getBlockElementClass","inlineElementJSON","getInlineElementClass","setDocumentElement","setEditorCursor","observerCursorJSON","appendObserverCursor","parseStateJSON","current","attach","react_default","a","ref","Component","App","App_TaleWeaverComponent","Boolean","location","hostname","match","ReactDOM","src_App_0","getElementById","navigator","serviceWorker","ready","then","registration","unregister"],"mappings":"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","file":"static/js/main.aced6064.chunk.js","sourcesContent":["import BlockElement from './BlockElement';\n\n/**\n * Models a document. This is the root of the\n * element tree.\n */\nexport default class DocumentElement {\n  /** Child elements. */\n  protected children: BlockElement[];\n\n  /**\n   * Creates a new document element instance.\n   */\n  constructor() {\n    this.children = [];\n  }\n\n  /**\n   * Appends a child element.\n   * @param child - Child element to append.\n   */\n  appendChild(child: BlockElement) {\n    this.children.push(child);\n  }\n\n  /**\n   * Removes a child element;\n   * @param child - Child element to remove.\n   */\n  removeChild(child: BlockElement) {\n    const index = this.children.indexOf(child);\n    if (index < 0) {\n      return;\n    }\n    this.children.splice(index, 1);\n  }\n\n  /**\n   * Gets all child elements.\n   */\n  getChildren(): BlockElement[] {\n    return this.children;\n  }\n\n  /**\n   * Gets a child element at a certain position in the document.\n   * @param position - Position in the document.\n   */\n  getChildAt(position: number): BlockElement | null {\n    let cumulatedSize = 0;\n    for (let n = 0, nn = this.children.length; n < nn; n++) {\n      cumulatedSize += this.children[n].getSize();\n      if (cumulatedSize > position) {\n        return this.children[n];\n      }\n    }\n    return null;\n  }\n\n  /**\n   * Gets the size of the document.\n   */\n  getSize(): number {\n    let size = 0;\n    this.children.forEach(child => {\n      size += child.getSize();\n    });\n    return size;\n  }\n}\n","import BlockElement from '../BlockElement';\n\n/**\n * Paragraph block element.\n */\nexport default class ParagraphElement extends BlockElement {\n  getType(): string {\n    return 'Paragraph';\n  }\n}\n","import DocumentElement from './DocumentElement';\nimport InlineElement from './InlineElement';\n\n/**\n * Models a block element in a document.\n * A block element should be the child of a\n * document element and may contain inline\n * elements as children.\n */\nexport default abstract class BlockElement {\n  /** Parent element. */\n  protected parent?: DocumentElement;\n  /** Child elements. */\n  protected children: InlineElement[];\n\n  /** Creates a new block element instance. */\n  constructor() {\n    this.children = [];\n  }\n\n  /**\n   * Gets the type of block element.\n   */\n  abstract getType(): string;\n\n  /**\n   * Sets the parent element.\n   * @param parent - Parent element to set.\n   */\n  setParent(parent: DocumentElement) {\n    this.parent = parent;\n  }\n\n  /**\n   * Gets a parent element.\n   */\n  getParent(): DocumentElement {\n    return this.parent!;\n  }\n\n  /**\n   * Appends a child element.\n   * @param child - Child element to append.\n   */\n  appendChild(child: InlineElement) {\n    this.children.push(child);\n  }\n\n  /**\n   * Removes a child element.\n   * @param child - Child element to remove.\n   */\n  removeChild(child: InlineElement) {\n    const index = this.children.indexOf(child);\n    if (index < 0) {\n      return;\n    }\n    this.children.splice(index, 1);\n  }\n\n  /**\n   * Gets all child elements.\n   */\n  getChildren(): InlineElement[] {\n    return this.children;\n  }\n\n  /**\n   * Gets a child element at a certain position in the block element.\n   * @param position - Position in the block element.\n   */\n  getChildAt(position: number): InlineElement | null {\n    let cumulatedSize = 0;\n    for (let n = 0, nn = this.children.length; n < nn; n++) {\n      cumulatedSize += this.children[n].getSize();\n      if (cumulatedSize > position) {\n        return this.children[n];\n      }\n    }\n    return null;\n  }\n\n  /**\n   * Gets the size of the block element.\n   */\n  getSize(): number {\n    let size = 0;\n    this.children.forEach(child => {\n      size += child.getSize();\n    });\n    return size;\n  }\n}\n","import BlockElement from './BlockElement';\nimport Word from './Word';\n\n/**\n * Models an inline element in a document.\n * An inline element should be the child of\n * a block element.\n */\nexport default abstract class InlineElement {\n  /** Parent element. */\n  protected parent?: BlockElement;\n  /** Text content. */\n  protected text?: string;\n\n  /**\n   * Gets the type of inline element.\n   */\n  abstract getType(): string;\n\n  /**\n   * Sets the parent element.\n   * @param parent - Parent element to set.\n   */\n  setParent(parent: BlockElement) {\n    this.parent = parent;\n  }\n\n  /**\n   * Gets a parent element.\n   */\n  getParent(): BlockElement {\n    return this.parent!;\n  }\n\n  /**\n   * Sets the text content.\n   * @param text - Text content to set.\n   */\n  setText(text: string) {\n    this.text = text;\n  }\n\n  /**\n   * Gets the text content.\n   */\n  getText(): string {\n    return this.text!;\n  }\n\n  /**\n   * Gets the size of the inline element.\n   */\n  abstract getSize(): number;\n\n  /**\n   * Breaks down the inline element into words.\n   */\n  abstract getWords(): Word[];\n}\n","import Word from '../Word';\n\n/**\n * Word for text elements.\n */\nexport default class TextWord extends Word {\n  getType(): string {\n    return 'Text';\n  }\n}\n","import InlineElement from './InlineElement';\n\n/**\n * Models a segment of the document that\n * cannot be split when rendered. This is\n * the basic building block of a document's\n * layout.\n */\nexport default abstract class Word {\n  /** Inline element this word belongs to. */\n  protected inlineElement: InlineElement;\n  /** Text content. */\n  protected text?: string;\n\n  /**\n   * Creates a new word instance.\n   * @param inlineElement - Inline element this word belongs to.\n   */\n  constructor(inlineElement: InlineElement) {\n    this.inlineElement = inlineElement;\n  }\n\n  /**\n   * Gets the type of word.\n   */\n  abstract getType(): string;\n\n  /**\n   * Gets the inline element this word belongs to.\n   */\n  getInlineElement(): InlineElement {\n    return this.inlineElement;\n  }\n\n  /**\n   * Sets the text content.\n   * @param text - The text content to set.\n   */\n  setText(text: string) {\n    this.text = text;\n  }\n\n  /**\n   * Gets the text content.\n   */\n  getText(): string {\n    return this.text!;\n  };\n\n  /**\n   * Gets the size of the word.\n   */\n  getSize(): number {\n    return this.text!.length;\n  }\n}\n","import InlineElement from '../InlineElement';\nimport TextWord from '../word/TextWord';\n\n/**\n * We can break the inline element at the\n * position after these characters.\n */\nconst BREAKABLE_CHARS = [\n  ' ',\n  '\\t',\n  '-',\n];\n\n/**\n * Text inline element.\n */\nexport default class TextElement extends InlineElement {\n  getType(): string {\n    return 'Text';\n  }\n\n  getSize(): number {\n    return this.text!.length;\n  }\n\n  getWords(): TextWord[] {\n    const words: TextWord[] = [];\n    const text = this.getText();\n    let wordFromIndex = 0;\n    let textIndex = 0;\n    for (let textLength = text.length; textIndex < textLength; textIndex++) {\n      const char = text[textIndex];\n      if (BREAKABLE_CHARS.indexOf(char) >= 0) {\n        const word = new TextWord(this);\n        word.setText(text.substring(wordFromIndex, textIndex + 1));\n        words.push(word);\n        wordFromIndex = textIndex + 1;\n      }\n    }\n    if (wordFromIndex !== textIndex) {\n      const word = new TextWord(this);\n      word.setText(text.substring(wordFromIndex, textIndex + 1));\n      words.push(word);\n    }\n    return words;\n  }\n}\n","import throttle from '../helpers/throttle';\nimport DocumentView from './DocumentView';\nimport LineView from './LineView';\nimport BoxView from './BoxView';\n\nexport type PageViewConfig = {\n  width: number;\n  height: number;\n  paddingTop: number;\n  paddingBottom: number;\n  paddingLeft: number;\n  paddingRight: number;\n};\n\nexport type PageViewPointerEventHandler = (event: PageViewPointerEvent) => void;\nexport type PageViewPointerEvent = {\n  pageView: PageView;\n  pageViewPosition: number;\n}\nexport type EventHandlers = {\n  onPointerDown: PageViewPointerEventHandler,\n  onPointerMove: PageViewPointerEventHandler,\n  onPointerUp: PageViewPointerEventHandler,\n};\n\nexport type PageViewScreenPositions = {\n  left: number;\n  width: number;\n  top: number;\n  height: number;\n}[];\n\nexport default class PageView {\n  private documentView: DocumentView;\n  private eventHandlers: EventHandlers;\n  private config: PageViewConfig;\n  private lineViews: LineView[];\n  private domElement?: HTMLElement;\n\n  constructor(documentView: DocumentView, eventHandlers: EventHandlers, config: PageViewConfig) {\n    this.documentView = documentView;\n    this.eventHandlers = eventHandlers;\n    this.config = config;\n    this.lineViews = [];\n  }\n\n  /**\n   * Maps screen position to document position.\n   */\n  private resolveScreenPosition(x: number, y: number): number {\n    // Map DOM document coordinates to relative coordinates\n    // within the page's viewport\n    const leftMin = 0;\n    const leftMax = this.config.width - this.config.paddingLeft - this.config.paddingRight;\n    const topMin = 0;\n    const topMax = this.config.height - this.config.paddingTop - this.config.paddingBottom;\n    const left = Math.min(leftMax, Math.max(leftMin, x - this.domElement!.offsetLeft - this.config.paddingLeft));\n    const top = Math.min(topMax, Math.max(topMin, y - this.domElement!.offsetTop - this.config.paddingTop));\n\n    // Step through line views until we reach the line view\n    // that contains the screen position\n    let cumulatedHeight = 0;\n    let cumulatedSize = 0;\n    let lineView: LineView;\n    for (let n = 0, nn = this.lineViews.length; n < nn; n++) {\n      lineView = this.lineViews[n];\n      const lineViewHeight = lineView.getHeight();\n      if (cumulatedHeight + lineViewHeight > top) {\n        break;\n      }\n      cumulatedHeight += lineViewHeight;\n      cumulatedSize += lineView.getSize();\n    }\n\n    // If left is 0, just return since there is no\n    // need to step through boxes\n    if (left === 0) {\n      return cumulatedSize;\n    }\n\n    // Step through box views of the line view until\n    // we reach the box view that contains the screen\n    // position\n    const boxViews = lineView!.getBoxViews();\n    let cumulatedWidth = 0;\n    let boxView: BoxView;\n    let n = 0;\n    for (let nn = boxViews.length; n < nn; n++) {\n      boxView = boxViews[n];\n      const boxViewWidth = boxView.getWidth();\n      if (cumulatedWidth + boxViewWidth >= left) {\n        break;\n      }\n      cumulatedWidth += boxViewWidth;\n      cumulatedSize += boxView.getSize();\n    }\n    if (n  === boxViews.length) {\n      // If all boxes were stepped through, i.e. end\n      // of line is reached, return cumulated size\n      if (cumulatedWidth > 0) {\n        return cumulatedSize - 1;\n      }\n      return cumulatedSize;\n    }\n\n    // Step through the box view's content until\n    // we reach the document position that corresponds\n    // to the screen position\n    cumulatedSize += boxView!.getDocumentPosition(left - cumulatedWidth);\n\n    return cumulatedSize;\n  }\n\n  /**\n   * Handles selectstart DOM event.\n   */\n  private handleSelectStart = (event: Event) => {\n    // Disable browser select functionality\n    event.preventDefault();\n  }\n\n  /**\n   * Handles mouse down DOM event.\n   */\n  private handleMouseDown = (event: MouseEvent) => {\n    const position = this.resolveScreenPosition(event.pageX, event.pageY);\n    this.eventHandlers.onPointerDown({\n      pageView: this,\n      pageViewPosition: position,\n    });\n  }\n\n  /**\n   * Handles mouse move DOM event.\n   */\n  private handleMouseMove = throttle((event: MouseEvent) => {\n    const position = this.resolveScreenPosition(event.pageX, event.pageY);\n    this.eventHandlers.onPointerMove({\n      pageView: this,\n      pageViewPosition: position,\n    });\n  }, 5)\n\n  /**\n   * Handles mouse up DOM event.\n   */\n  private handleMouseUp = (event: MouseEvent) => {\n    const position = this.resolveScreenPosition(event.pageX, event.pageY);\n    this.eventHandlers.onPointerUp({\n      pageView: this,\n      pageViewPosition: position,\n    });\n  }\n\n  /**\n   * Gets the parent document view.\n   */\n  getDocumentView(): DocumentView {\n    return this.documentView!;\n  }\n\n  /**\n   * Gets config of the page view.\n   */\n  getConfig(): PageViewConfig {\n    return this.config;\n  }\n\n  /**\n   * Appends a line view to the page.\n   */\n  appendLineView(lineView: LineView) {\n    this.lineViews.push(lineView);\n    lineView.setPageView(this);\n  }\n\n  /**\n   * Remove a line view from the page.\n   */\n  removeLineView(lineView: LineView) {\n    const index = this.lineViews.indexOf(lineView);\n    if (index < 0) {\n      return;\n    }\n    this.lineViews.splice(index, 1);\n  }\n\n  /**\n   * Gets line views in the page.\n   */\n  getLineViews(): LineView[] {\n    return this.lineViews;\n  }\n\n  /**\n   * Gets the document size covered by this page.\n   */\n  getSize(): number {\n    let size = 0;\n    this.lineViews!.forEach(lineView => size += lineView.getSize());\n    return size;\n  }\n\n  /**\n   * Initializes the page DOM element by creating it and appending\n   * it to the document. No-op if DOM element is already initialized.\n   */\n  bindToDOM() {\n    if (this.domElement) {\n      return;\n    }\n    const parentDOMElement = this.getDocumentView().getDOMElement();\n    this.domElement = document.createElement('div');\n    this.domElement.className = 'tw--page';\n    this.domElement.style.position = 'relative';\n    this.domElement.style.width = `${this.config.width}px`;\n    this.domElement.style.height = `${this.config.height}px`;\n    this.domElement.style.padding = `${this.config.paddingTop}px ${this.config.paddingRight}px ${this.config.paddingBottom}px ${this.config.paddingLeft}px`;\n    this.domElement.style.userSelect = 'none';\n    this.domElement.addEventListener('selectstart', this.handleSelectStart);\n    this.domElement.addEventListener('mousedown', this.handleMouseDown);\n    this.domElement.addEventListener('mousemove', this.handleMouseMove);\n    this.domElement.addEventListener('mouseup', this.handleMouseUp);\n    this.lineViews.forEach(lineView => lineView.bindToDOM());\n    parentDOMElement.appendChild(this.domElement);\n  }\n\n  /**\n   * Gets the page DOM element.\n   */\n  getDOMElement(): HTMLElement {\n    return this.domElement!;\n  }\n\n  /**\n   * Gets page screen positions for a slice of the document.\n   */\n  getScreenPositions(from: number, to: number): PageViewScreenPositions {\n    let currentPosition = this.getSize();\n    if (from >= currentPosition || to >= currentPosition) {\n      throw new Error(`Page screen positions cannot be determined for range from ${from} to ${to}.`);\n    }\n    const screenPositions: PageViewScreenPositions = [];\n    for (let n = this.lineViews.length - 1; n >= 0; n--) {\n      const lineView = this.lineViews[n];\n      currentPosition -= lineView.getSize();\n      if (currentPosition <= to) {\n        const lineViewScreenPosition = lineView.getScreenPosition(Math.max(from - currentPosition, 0), Math.min(to - currentPosition, lineView.getSize() - 1));\n        screenPositions.push({\n          left: lineViewScreenPosition.left,\n          width: lineViewScreenPosition.width,\n          top: this.lineViews.slice(0, n).reduce((height, line) => height + line.getHeight(), 0),\n          height: lineViewScreenPosition.height,\n        });\n      }\n      if (currentPosition <= from) {\n        return screenPositions;\n      }\n    }\n    throw new Error(`Page screen positions cannot be determined for range from ${from} to ${to}.`);\n  }\n}\n","/**\n * Throttles a function so that it runs at most\n * once per specified number of milliseconds.\n */\nexport default function throttle(func: (...args: any) => any, milliseconds: number) {\n  let throttledRunTimeout: NodeJS.Timeout;\n  let lastRunAt: number;\n  return (...args: any) => {\n    if (!lastRunAt) {\n      func(...args);\n      lastRunAt = Date.now();\n    } else {\n      clearTimeout(throttledRunTimeout);\n      throttledRunTimeout = setTimeout(() => {\n        func(...args);\n        lastRunAt = Date.now();\n      }, milliseconds - (Date.now() - lastRunAt));\n    }\n  };\n}\n","import CursorTransformationStep from './CursorTransformationStep';\nimport TaleWeaver from '../TaleWeaver';\n\n/**\n * Describes a cursor transformation as a series\n * of steps.\n */\nexport default class CursorTransformation {\n  private steps: CursorTransformationStep[] = [];\n\n  /**\n   * Create a new cursor transformation.\n   */\n  constructor() {\n    this.steps = [];\n  }\n\n  /**\n   * Add a step to the transformation.\n   */\n  addStep(step: CursorTransformationStep) {\n    this.steps.push(step);\n  }\n\n  /**\n   * Get all steps of the transformation.\n   */\n  getSteps(): CursorTransformationStep[] {\n    return this.steps;\n  }\n}\n","import CursorTransformationStep from '../CursorTransformationStep';\n\n/**\n * A transformation step for translating the cursor\n * by a certain displacement. The cursor head gets\n * displaced and the anchor gets moved to the head.\n */\nexport default class TranslateCursor implements CursorTransformationStep {\n  private displacement: number;\n\n  /**\n   * Create a new move cursor anchor transformation step.\n   * @param displacement - Vector to displace the cursor anchor by.\n   */\n  constructor(displacement: number) {\n    this.displacement = displacement;\n  }\n\n  getType(): string {\n    return 'TranslateCursor';\n  }\n\n  /**\n   * Get displacement vector.\n   */\n  getDisplacement(): number {\n    return this.displacement;\n  }\n}\n","import TaleWeaver from '../../TaleWeaver';\nimport CursorCommand from '../CursorCommand';\nimport CursorTransformation from '../../state/CursorTransformation';\nimport TranslateCursor from '../../state/cursortransformationsteps/TranslateCursor';\n\nexport default function moveBackwardByLine(): CursorCommand {\n  return (taleWeaver: TaleWeaver): CursorTransformation => {\n    const transformation = new CursorTransformation();\n    const editorCursor = taleWeaver.getState().getEditorCursor();\n    if (!editorCursor) {\n      return transformation;\n    }\n    const head = editorCursor.getHead();\n    const documentView = taleWeaver.getDocumentView();\n    const lineStart = documentView.getLineStartPosition(head);\n    transformation.addStep(new TranslateCursor(lineStart - head));\n    return transformation;\n  };\n}\n","import TaleWeaver from '../../TaleWeaver';\nimport CursorCommand from '../CursorCommand';\nimport CursorTransformation from '../../state/CursorTransformation';\nimport TranslateCursor from '../../state/cursortransformationsteps/TranslateCursor';\n\nexport default function moveForwardByLine(): CursorCommand {\n  return (taleWeaver: TaleWeaver): CursorTransformation => {\n    const transformation = new CursorTransformation();\n    const editorCursor = taleWeaver.getState().getEditorCursor();\n    if (!editorCursor) {\n      return transformation;\n    }\n    const head = editorCursor.getHead();\n    const documentView = taleWeaver.getDocumentView();\n    const lineEnd = documentView.getLineEndPosition(head);\n    transformation.addStep(new TranslateCursor(lineEnd - head));\n    return transformation;\n  };\n}\n","import CursorTransformationStep from '../CursorTransformationStep';\n\n/**\n * A transformation step for translating the cursor head\n * by a certain displacement.\n */\nexport default class TranslateCursorHead implements CursorTransformationStep {\n  private displacement: number;\n\n  /**\n   * Create a new move cursor head transformation step.\n   * @param displacement - Vector to displace the cursor head by.\n   */\n  constructor(displacement: number) {\n    this.displacement = displacement;\n  }\n\n  getType(): string {\n    return 'TranslateCursorHead';\n  }\n\n  /**\n   * Get displacement vector.\n   */\n  getDisplacement(): number {\n    return this.displacement;\n  }\n}\n","import TaleWeaver from '../../TaleWeaver';\nimport CursorCommand from '../CursorCommand';\nimport CursorTransformation from '../../state/CursorTransformation';\nimport TranslateCursorHead from '../../state/cursortransformationsteps/TranslateCursorHead';\n\nexport default function moveHeadTo(position: number): CursorCommand {\n  return (taleWeaver: TaleWeaver): CursorTransformation => {\n    const transformation = new CursorTransformation();\n    const editorCursor = taleWeaver.getState().getEditorCursor();\n    if (!editorCursor) {\n      return transformation;\n    }\n    transformation.addStep(new TranslateCursorHead(position - editorCursor.getHead()));\n    return transformation;\n  };\n}\n","import TaleWeaver from '../../TaleWeaver';\nimport CursorCommand from '../CursorCommand';\nimport CursorTransformation from '../../state/CursorTransformation';\nimport TranslateCursorHead from '../../state/cursortransformationsteps/TranslateCursorHead';\n\nexport default function moveHeadBackwardByLine(): CursorCommand {\n  return (taleWeaver: TaleWeaver): CursorTransformation => {\n    const transformation = new CursorTransformation();\n    const editorCursor = taleWeaver.getState().getEditorCursor();\n    if (!editorCursor) {\n      return transformation;\n    }\n    const head = editorCursor.getHead();\n    const documentView = taleWeaver.getDocumentView();\n    const lineStart = documentView.getLineStartPosition(head);\n    transformation.addStep(new TranslateCursorHead(lineStart - head));\n    return transformation;\n  };\n}\n","import TaleWeaver from '../../TaleWeaver';\nimport CursorCommand from '../CursorCommand';\nimport CursorTransformation from '../../state/CursorTransformation';\nimport TranslateCursorHead from '../../state/cursortransformationsteps/TranslateCursorHead';\n\nexport default function moveHeadRightByLine(): CursorCommand {\n  return (taleWeaver: TaleWeaver): CursorTransformation => {\n    const transformation = new CursorTransformation();\n    const editorCursor = taleWeaver.getState().getEditorCursor();\n    if (!editorCursor) {\n      return transformation;\n    }\n    const head = editorCursor.getHead();\n    const documentView = taleWeaver.getDocumentView();\n    const lineEnd = documentView.getLineEndPosition(head);\n    transformation.addStep(new TranslateCursorHead(lineEnd - head));\n    return transformation;\n  };\n}\n","import TaleWeaver from '../TaleWeaver';\nimport Cursor from '../cursor/Cursor';\nimport DocumentView from './DocumentView';\nimport { moveTo, moveHeadTo } from '../command/cursor';\n\nexport default class EditorCursorView {\n  private taleWeaver: TaleWeaver;\n  private editorCursor: Cursor;\n  private documentView?: DocumentView;\n  private headDOMElement?: HTMLElement;\n  private selectionDOMElements: HTMLElement[];\n  private selecting: boolean;\n  private blinkState: boolean;\n  private blinkInterval: NodeJS.Timeout | null;\n\n  constructor(taleWeaver: TaleWeaver, editorCursor: Cursor) {\n    this.taleWeaver = taleWeaver;\n    this.editorCursor = editorCursor;\n    this.selectionDOMElements = [];\n    this.selecting = false;\n    this.blinkState = false;\n    this.blinkInterval = null;\n  }\n\n  private render() {\n    this.renderHead();\n    this.renderSelections();\n  }\n\n  private renderHead() {\n    const editorCursor = this.editorCursor;\n    const head = editorCursor.getHead();\n    const documentScreenPositions = this.documentView!.getScreenPositions(head, head);\n    const { pageView, pageViewScreenPositions } = documentScreenPositions[0];\n    const headDOMElement = this.headDOMElement!;\n    headDOMElement.style.left = `${pageViewScreenPositions[0].left + pageView.getConfig().paddingLeft}px`;\n    headDOMElement.style.top = `${pageViewScreenPositions[0].top + pageView.getConfig().paddingTop}px`;\n    headDOMElement.style.height = `${pageViewScreenPositions[0].height}px`;\n    const pageViewDOMElement = pageView.getDOMElement();\n    if (headDOMElement.parentElement && headDOMElement.parentElement !== pageViewDOMElement) {\n      headDOMElement.parentElement!.removeChild(headDOMElement);\n    }\n    if (!headDOMElement.parentElement) {\n      pageViewDOMElement.appendChild(headDOMElement);\n    }\n  }\n\n  private renderSelections() {\n    const editorCursor = this.editorCursor;\n    const anchor = editorCursor.getAnchor();\n    const head = editorCursor.getHead();\n    const from = Math.min(anchor, head);\n    const to = Math.max(anchor, head);\n    const documentScreenPositions = this.documentView!.getScreenPositions(from, to);\n    let selectionsCount = 0;\n    documentScreenPositions.forEach(({ pageViewScreenPositions }) => {\n      selectionsCount += pageViewScreenPositions.length;\n    });\n    while (this.selectionDOMElements.length > selectionsCount) {\n      const selectionDOMElement = this.selectionDOMElements.pop()!;\n      selectionDOMElement.parentElement!.removeChild(selectionDOMElement);\n    }\n    while (this.selectionDOMElements.length < selectionsCount) {\n      const selectionDOMElement = document.createElement('div');\n      selectionDOMElement.className = 'tw--editor-cursor-selection';\n      selectionDOMElement.style.position = 'absolute';\n      selectionDOMElement.style.background = 'hsla(217, 100%, 65%, 0.25)';\n      this.selectionDOMElements.push(selectionDOMElement);\n    }\n    let selectionIndex = 0;\n    documentScreenPositions.forEach(({ pageView, pageViewScreenPositions }) => {\n      const pageViewDOMElement = pageView.getDOMElement();\n      pageViewScreenPositions.forEach(pageViewScreenPosition => {\n        const selectionDOMElement = this.selectionDOMElements[selectionIndex]!;\n        selectionDOMElement.style.left = `${pageViewScreenPosition.left + pageView.getConfig().paddingLeft}px`;\n        selectionDOMElement.style.width = `${pageViewScreenPosition.width}px`;\n        selectionDOMElement.style.top = `${pageViewScreenPosition.top + pageView.getConfig().paddingTop}px`;\n        selectionDOMElement.style.height = `${pageViewScreenPosition.height}px`;\n        selectionDOMElement.style.pointerEvents = 'none';\n        if (selectionDOMElement.parentElement && selectionDOMElement.parentElement !== pageViewDOMElement) {\n          selectionDOMElement.parentElement!.removeChild(selectionDOMElement);\n        }\n        if (!selectionDOMElement.parentElement) {\n          pageViewDOMElement.appendChild(selectionDOMElement);\n        }\n        selectionIndex++;\n      });\n    });\n  }\n\n  setDocumentView(documentView: DocumentView) {\n    this.documentView = documentView;\n  }\n\n  bindToDOM() {\n    if (!this.headDOMElement) {\n      this.headDOMElement = document.createElement('div');\n      this.headDOMElement.className = 'tw--editor-cursor-head';\n      this.headDOMElement.style.position = 'absolute';\n      this.headDOMElement.style.width = '2px';\n      this.headDOMElement.style.marginLeft = '-1px';\n      this.headDOMElement.style.background = 'hsla(217, 100%, 65%, 1)';\n      this.headDOMElement.style.visibility = 'hidden';\n    }\n    this.render();\n    this.startBlinking();\n    this.editorCursor.observe(() => {\n      this.render();\n      if (this.blinkInterval !== null) {\n        this.stopBlinking();\n        this.startBlinking();\n      }\n    });\n  }\n\n  getEditorCursor(): Cursor {\n    return this.editorCursor;\n  }\n\n  getDocumentView(): DocumentView {\n    return this.documentView!;\n  }\n\n  startBlinking() {\n    if (this.blinkInterval !== null) {\n      return;\n    }\n    this.blinkInterval = setInterval(() => {\n      if (this.blinkState) {\n        this.headDOMElement!.style.visibility = 'hidden';\n      } else {\n        this.headDOMElement!.style.visibility = 'visible';\n      }\n      this.blinkState = !this.blinkState;\n    }, 500);\n  }\n\n  stopBlinking() {\n    if (this.blinkInterval === null) {\n      return;\n    }\n    this.blinkState = true;\n    this.headDOMElement!.style.visibility = 'visible';\n    clearInterval(this.blinkInterval);\n    this.blinkInterval = null;\n  }\n\n  beginSelect(position: number) {\n    this.taleWeaver.getState().applyEditorCursorTransformation(moveTo(position)(this.taleWeaver));\n    this.selecting = true;\n    this.stopBlinking();\n  }\n\n  moveSelect(position: number) {\n    if (this.selecting) {\n      this.taleWeaver.getState().applyEditorCursorTransformation(moveHeadTo(position)(this.taleWeaver));\n    }\n  }\n\n  endSelect(position: number) {\n    this.taleWeaver.getState().applyEditorCursorTransformation(moveHeadTo(position)(this.taleWeaver));\n    this.selecting = false;\n    this.startBlinking();\n  }\n}\n","import TaleWeaver from '../../TaleWeaver';\nimport CursorCommand from '../CursorCommand';\nimport CursorTransformation from '../../state/CursorTransformation';\nimport TranslateCursor from '../../state/cursortransformationsteps/TranslateCursor';\n\nexport default function moveTo(position: number): CursorCommand {\n  return (taleWeaver: TaleWeaver): CursorTransformation => {\n    const transformation = new CursorTransformation();\n    const editorCursor = taleWeaver.getState().getEditorCursor();\n    if (!editorCursor) {\n      return transformation;\n    }\n    transformation.addStep(new TranslateCursor(position - editorCursor.getHead()));\n    return transformation;\n  };\n}\n","import Cursor from '../cursor/Cursor';\nimport DocumentView from './DocumentView';\n\nexport default class ObserverCursorView {\n  private observerCursor?: Cursor;\n  private documentView?: DocumentView;\n  private headDOMElement?: HTMLElement;\n  private selectionDOMElements: HTMLElement[];\n\n  constructor() {\n    this.selectionDOMElements = [];\n  }\n\n  private render() {\n    this.renderHead();\n    this.renderSelections();\n  }\n\n  private renderHead() {\n    const observerCursor = this.observerCursor!;\n    const head = observerCursor.getHead();\n    const documentScreenPositions = this.documentView!.getScreenPositions(head, head);\n    const { pageView, pageViewScreenPositions } = documentScreenPositions[0];\n    const headDOMElement = this.headDOMElement!;\n    headDOMElement.style.left = `${pageViewScreenPositions[0].left + pageView.getConfig().paddingLeft}px`;\n    headDOMElement.style.top = `${pageViewScreenPositions[0].top + pageView.getConfig().paddingTop}px`;\n    headDOMElement.style.height = `${pageViewScreenPositions[0].height}px`;\n    const pageViewDOMElement = pageView.getDOMElement();\n    if (headDOMElement.parentElement && headDOMElement.parentElement !== pageViewDOMElement) {\n      headDOMElement.parentElement!.removeChild(headDOMElement);\n    }\n    if (!headDOMElement.parentElement) {\n      pageViewDOMElement.appendChild(headDOMElement);\n    }\n  }\n\n  private renderSelections() {\n    const observerCursor = this.observerCursor!;\n    const anchor = observerCursor.getAnchor();\n    const head = observerCursor.getHead();\n    const from = Math.min(anchor, head);\n    const to = Math.max(anchor, head);\n    const documentScreenPositions = this.documentView!.getScreenPositions(from, to);\n    let selectionsCount = 0;\n    documentScreenPositions.forEach(({ pageViewScreenPositions }) => {\n      selectionsCount += pageViewScreenPositions.length;\n    });\n    while (this.selectionDOMElements.length > selectionsCount) {\n      this.selectionDOMElements.pop();\n    }\n    while (this.selectionDOMElements.length < selectionsCount) {\n      const selectionDOMElement = document.createElement('div');\n      selectionDOMElement.className = 'tw--observer-cursor-selection';\n      selectionDOMElement.style.position = 'absolute';\n      selectionDOMElement.style.background = 'hsla(130, 100%, 65%, 0.25)';\n      this.selectionDOMElements.push(selectionDOMElement);\n    }\n    let selectionIndex = 0;\n    documentScreenPositions.forEach(({ pageView, pageViewScreenPositions }) => {\n      const pageViewDOMElement = pageView.getDOMElement();\n      pageViewScreenPositions.forEach(pageViewScreenPosition => {\n        const selectionDOMElement = this.selectionDOMElements[selectionIndex]!;\n        selectionDOMElement.style.left = `${pageViewScreenPosition.left + pageView.getConfig().paddingLeft}px`;\n        selectionDOMElement.style.width = `${pageViewScreenPosition.width}px`;\n        selectionDOMElement.style.top = `${pageViewScreenPosition.top + pageView.getConfig().paddingTop}px`;\n        selectionDOMElement.style.height = `${pageViewScreenPosition.height}px`;\n        selectionDOMElement.style.pointerEvents = 'none';\n        if (selectionDOMElement.parentElement && selectionDOMElement.parentElement !== pageViewDOMElement) {\n          selectionDOMElement.parentElement!.removeChild(selectionDOMElement);\n        }\n        if (!selectionDOMElement.parentElement) {\n          pageViewDOMElement.appendChild(selectionDOMElement);\n        }\n        selectionIndex++;\n      });\n    });\n  }\n\n  setObserverCursor(observerCursor: Cursor) {\n    this.observerCursor = observerCursor;\n  }\n\n  setDocumentView(documentView: DocumentView) {\n    this.documentView = documentView;\n  }\n\n  bindToDOM() {\n    if (!this.headDOMElement) {\n      this.headDOMElement = document.createElement('div');\n      this.headDOMElement.className = 'tw--observer-cursor-head';\n      this.headDOMElement.style.position = 'absolute';\n      this.headDOMElement.style.width = '2px';\n      this.headDOMElement.style.marginLeft = '-1px';\n      this.headDOMElement.style.background = 'hsla(130, 100%, 65%, 1)';\n    }\n    this.render();\n  }\n\n  getObserverCursor(): Cursor {\n    return this.observerCursor!;\n  }\n\n  getDocumentView(): DocumentView {\n    return this.documentView!;\n  }\n}\n","export default interface Event {}\n\nexport class KeyPressEvent implements Event {\n  public readonly key: string;\n  public readonly shift: boolean;\n  public readonly meta: boolean;\n  public readonly alt: boolean;\n\n  constructor(key: string, shift: boolean, meta: boolean, alt: boolean) {\n    this.key = key;\n    this.shift = shift;\n    this.meta = meta;\n    this.alt = alt;\n  }\n}\n","import TaleWeaver from '../TaleWeaver';\nimport DocumentElement from '../element/DocumentElement';\nimport BlockElement from '../element/BlockElement';\nimport PageView, { PageViewScreenPositions, PageViewPointerEvent } from './PageView';\nimport BoxView from './BoxView';\nimport LineView from './LineView';\nimport EditorCursorView from './EditorCursorView';\nimport ObserverCursorView from './ObserverCursorView';\nimport { KeyPressEvent } from '../event/Event';\n\n/**\n * Box views of a block element, useful\n * as an intermediate data structure\n * where the box views can be further\n * broken down into line views.\n */\ntype BoxViewBlock = {\n  blockElement: BlockElement;\n  boxViews: BoxView[];\n};\n\n/**\n * Document view configs.\n */\ntype DocumentViewConfig = {\n  /** Width of a page in the document. */\n  pageWidth: number;\n  /** Height of a page in the document. */\n  pageHeight: number;\n  /** Topping padding of a page in the document. */\n  pagePaddingTop: number;\n  /** Bottom padding of a page in the document. */\n  pagePaddingBottom: number;\n  /** Left padding of a page in the document. */\n  pagePaddingLeft: number;\n  /** Right padding of a page in the document. */\n  pagePaddingRight: number;\n};\n\nexport type DocumentViewScreenPositions = {\n  pageView: PageView;\n  pageViewScreenPositions: PageViewScreenPositions;\n}[];\n\n/**\n * View of a document.\n */\nexport default class DocumentView {\n  private taleWeaver: TaleWeaver;\n  private documentElement: DocumentElement;\n  private config: DocumentViewConfig;\n  private pageViews: PageView[];\n  private boxViewBlocks: BoxViewBlock[];\n  private lineViews: LineView[];\n  private editorCursorView: EditorCursorView | null;\n  private observerCursorViews: ObserverCursorView[];\n  private domElement?: HTMLElement;\n\n  /**\n   * Creates a new document view instance.\n   * @param taleWeaver - A TaleWeaver instance.\n   * @param config - Configs for the document view.\n   */\n  constructor(taleWeaver: TaleWeaver, documentElement: DocumentElement, config: DocumentViewConfig) {\n    this.taleWeaver = taleWeaver;\n    this.documentElement = documentElement;\n    this.config = config;\n    this.boxViewBlocks = [];\n    this.lineViews = [];\n    this.pageViews = [];\n    this.editorCursorView = null;\n    this.observerCursorViews = [];\n    \n    // Build child views\n    this.buildBoxViewBlocks();\n    this.buildLineViews();\n    this.buildPageViews();\n    this.buildEditorCursorView();\n    this.buildObserverCursorViews();\n  }\n\n  /**\n   * Builds box views for each block element in\n   * the document.\n   */\n  private buildBoxViewBlocks() {\n    const registry = this.taleWeaver.getRegistry();\n    // Reset boxViewBlocks\n    this.boxViewBlocks.length = 0;\n    // Loop through block elements in the document\n    this.documentElement.getChildren().forEach(blockElement => {\n      const boxViewBlock: BoxViewBlock = {\n        blockElement,\n        boxViews: [],\n      };\n      // Loop through inline elements in the block element\n      blockElement.getChildren().forEach(inlineElement => {\n        const words = inlineElement.getWords();\n        // Loop through words in the inline element\n        words.forEach(word => {\n          // Build box view from word\n          const BoxView = registry.getBoxViewClass(word.getType())!;\n          const boxView = new BoxView();\n          boxView.setWord(word);\n          boxViewBlock.boxViews.push(boxView);\n        });\n      });\n      this.boxViewBlocks.push(boxViewBlock);\n    });\n  }\n\n  /**\n   * Builds line views from box views, should not\n   * be called unless buildBoxViewBlocks was called.\n   */\n  private buildLineViews() {\n    // Reset lineViews\n    this.lineViews.length = 0;\n    const registry = this.taleWeaver.getRegistry();\n    // Determine page content width as width minus paddings\n    const pageContentWidth = this.config.pageWidth - this.config.pagePaddingLeft - this.config.pagePaddingRight;\n    // Loop through blocks of box views\n    this.boxViewBlocks.forEach(boxViewBlock => {\n      // Build line views for block\n      const LineView = registry.getLineViewClass(boxViewBlock.blockElement.getType())!;\n      let lineView = new LineView({\n        width: this.config.pageWidth - this.config.pagePaddingLeft - this.config.pagePaddingRight,\n      });\n      this.lineViews.push(lineView);\n      let cumulatedWidth = 0;\n      // Loop through box views in block\n      boxViewBlock.boxViews.forEach(boxView => {\n        // Start new line if current line i is full\n        if (cumulatedWidth + boxView.getWidth() > pageContentWidth) {\n          lineView = new LineView({\n            width: this.config.pageWidth - this.config.pagePaddingLeft - this.config.pagePaddingRight,\n          });\n          this.lineViews.push(lineView);\n          cumulatedWidth = 0;\n        }\n        // Append box view to current line view\n        boxView.setLineView(lineView);\n        lineView.appendBoxView(boxView);\n        cumulatedWidth += boxView.getWidth();\n      });\n    });\n  }\n\n  /**\n   * Builds page views from line views, should not\n   * be called unless buildLineViews was called.\n   */\n  private buildPageViews() {\n    // Reset pageViews\n    this.pageViews.length = 0;\n    // Build page views\n    const pageViewConigs = {\n      width: this.config.pageWidth,\n      height: this.config.pageHeight,\n      paddingTop: this.config.pagePaddingTop,\n      paddingBottom: this.config.pagePaddingBottom,\n      paddingLeft: this.config.pagePaddingLeft,\n      paddingRight: this.config.pagePaddingRight,\n    };\n    let pageView = new PageView(this, {\n      onPointerDown: this.handlePointerDownOnPage,\n      onPointerMove: this.handlePointerMoveOnPage,\n      onPointerUp: this.handlePointerUpOnPage,\n    }, pageViewConigs);\n    this.pageViews.push(pageView);\n    let cumulatedHeight = 0;\n    // Determine page content height as height minus paddings\n    const pageContentHeight = this.config.pageHeight - this.config.pagePaddingTop - this.config.pagePaddingBottom;\n    // Loop through line views\n    this.lineViews.forEach(lineView => {\n      // Start new page if current page is full\n      if (cumulatedHeight + lineView.getHeight() > pageContentHeight) {\n        pageView = new PageView(this, {\n          onPointerDown: this.handlePointerDownOnPage,\n          onPointerMove: this.handlePointerMoveOnPage,\n          onPointerUp: this.handlePointerUpOnPage,\n        }, pageViewConigs);\n        this.pageViews.push(pageView);\n        cumulatedHeight = 0;\n      }\n      // Append line view to page view\n      lineView.setPageView(pageView);\n      pageView.appendLineView(lineView);\n      cumulatedHeight += lineView.getHeight();\n    });\n  }\n\n  /**\n   * Resolves a position in a page view to a position\n   * in the document view.\n   */\n  private resolvePageViewPosition = (pageViewPosition: number, pageView: PageView): number => {\n    let cumulatedSize = 0;\n    for (let n = 0, nn = this.pageViews.length; n < nn; n++) {\n      const loopPageView = this.pageViews[n];\n      if (loopPageView === pageView) {\n        break;\n      }\n      cumulatedSize += loopPageView.getSize();\n    }\n    return cumulatedSize + pageViewPosition;\n  }\n\n  /**\n   * Builds editor cursor views.\n   */\n  private buildEditorCursorView() {\n    const editorCursor = this.taleWeaver.getState().getEditorCursor();\n    if (!editorCursor) {\n      return;\n    }\n    this.editorCursorView = new EditorCursorView(this.taleWeaver!, editorCursor);\n    this.editorCursorView.setDocumentView(this);\n  }\n\n  /**\n   * Builds observer cursor views.\n   */\n  private buildObserverCursorViews() {\n    this.taleWeaver.getState().getObserverCursors().forEach(observerCursor => {\n      const observerCursorView = new ObserverCursorView();\n      observerCursorView.setObserverCursor(observerCursor);\n      observerCursorView.setDocumentView(this);\n      this.observerCursorViews.push(observerCursorView);\n    });\n  }\n\n  private handlePointerDownOnPage = (event: PageViewPointerEvent) => {\n    if (!this.editorCursorView) {\n      return;\n    }\n    const position = this.resolvePageViewPosition(event.pageViewPosition, event.pageView);\n    this.editorCursorView.beginSelect(position);\n  }\n\n  private handlePointerMoveOnPage = (event: PageViewPointerEvent) => {\n    if (!this.editorCursorView) {\n      return;\n    }\n    const position = this.resolvePageViewPosition(event.pageViewPosition, event.pageView);\n    this.editorCursorView.moveSelect(position);\n  }\n\n  private handlePointerUpOnPage = (event: PageViewPointerEvent) => {\n    if (!this.editorCursorView) {\n      return;\n    }\n    const position = this.resolvePageViewPosition(event.pageViewPosition, event.pageView);\n    this.editorCursorView.endSelect(position);\n  }\n\n  private handleKeyDown = (event: KeyboardEvent) => {\n    this.taleWeaver.getState().dispatchEvent(new KeyPressEvent(event.key, event.shiftKey, event.metaKey, event.altKey));\n    event.preventDefault();\n  }\n\n  private handleKeyUp = (event: KeyboardEvent) => {\n  }\n\n  /**\n   * Binds the document view to the DOM.\n   * @param containerDOMElement - Container DOM element for the document.\n   */\n  bindToDOM(containerDOMElement: HTMLElement) {\n    if (this.domElement) {\n      return;\n    }\n    this.domElement = document.createElement('div');\n    this.domElement.className = 'tw--document';\n    this.pageViews.forEach(pageView => pageView.bindToDOM());\n    if (this.editorCursorView) {\n      this.editorCursorView.bindToDOM();\n      this.observerCursorViews.forEach(observerCursorView => observerCursorView.bindToDOM());\n      containerDOMElement.appendChild(this.domElement);\n    }\n    window.addEventListener('keydown', this.handleKeyDown);\n    window.addEventListener('keyup', this.handleKeyUp);\n  }\n\n  /**\n   * Gets the bound DOM element.\n   */\n  getDOMElement(): HTMLElement {\n    return this.domElement!;\n  }\n\n  getScreenPositions(from: number, to: number): DocumentViewScreenPositions {\n    let currentPosition = this.documentElement.getSize();\n    if (from >= currentPosition || to >= currentPosition) {\n      throw new Error(`Document screen positions cannot be determined for range from ${from} to ${to}.`);\n    }\n    const screenPositions: DocumentViewScreenPositions = [];\n    for (let n = this.pageViews.length - 1; n >= 0; n--) {\n      const pageView = this.pageViews[n];\n      currentPosition -= pageView.getSize();\n      if (currentPosition <= to) {\n        screenPositions.push({\n          pageView,\n          pageViewScreenPositions: pageView.getScreenPositions(Math.max(from - currentPosition, 0), Math.min(to - currentPosition, pageView.getSize() - 1)),\n        });\n      }\n      if (currentPosition <= from) {\n        return screenPositions;\n      }\n    }\n    throw new Error(`Document screen positions cannot be determined for range from ${from} to ${to}.`);\n  }\n\n  /**\n   * Gets the size of the document.\n   */\n  getSize(): number {\n    return this.documentElement.getSize();\n  }\n\n  /**\n   * Gets the position at the start of the line that\n   * the given position is on.\n   * @param position - Position for determining the line.\n   */\n  getLineStartPosition(position: number): number {\n    // Search page\n    let currentPosition = 0;\n    for (let n = 0, nn = this.pageViews.length; n < nn; n++) {\n      const pageView = this.pageViews[n];\n      if (currentPosition + pageView.getSize() <= position) {\n        currentPosition += pageView.getSize();\n        continue;\n      }\n      const lineViews = pageView.getLineViews();\n      // Search line\n      for (let m = 0, mm = lineViews.length; m < mm; m++) {\n        const lineView = lineViews[m];\n        if (currentPosition + lineView.getSize() <= position) {\n          currentPosition += lineView.getSize();\n          continue;\n        }\n        return currentPosition;\n      }\n    }\n    throw new Error(`Position ${position} is not in the document.`);\n  }\n\n  /**\n   * Gets the position at the end of the line that\n   * the given position is on.\n   * @param position - Position for determining the line.\n   */\n  getLineEndPosition(position: number): number {\n    // Search page\n    let currentPosition = this.documentElement.getSize() - 1;\n    for (let n = this.pageViews.length - 1; n >= 0; n--) {\n      const pageView = this.pageViews[n];\n      if (currentPosition - pageView.getSize() >= position) {\n        currentPosition -= pageView.getSize();\n        continue;\n      }\n      const lineViews = pageView.getLineViews();\n      // Search line\n      for (let m = lineViews.length - 1; m >= 0; m--) {\n        const lineView = lineViews[m];\n        if (currentPosition - lineView.getSize() >= position) {\n          currentPosition -= lineView.getSize();\n          continue;\n        }\n        return currentPosition;\n      }\n    }\n    throw new Error(`Position ${position} is not in the document.`);\n  }\n\n  /**\n   * Gets the position at the start of the word that\n   * the given position is on.\n   * @param position - Position for determining the word.\n   */\n  getWordStartPosition(position: number): number {\n    // Search page\n    let currentPosition = 0;\n    const pageViews = this.pageViews;\n    for (let n = 0, nn = pageViews.length; n < nn; n++) {\n      const pageView = pageViews[n];\n      if (currentPosition + pageView.getSize() <= position) {\n        currentPosition += pageView.getSize();\n        continue;\n      }\n      const lineViews = pageView.getLineViews();\n      // Search line\n      for (let m = 0, mm = lineViews.length; m < mm; m++) {\n        const lineView = lineViews[m];\n        if (currentPosition + lineView.getSize() <= position) {\n          currentPosition += lineView.getSize();\n          continue;\n        }\n        const wordViews = lineView.getBoxViews();\n        // Search word\n        for (let o = 0, oo = wordViews.length; o < oo; o++) {\n          const wordView = wordViews[o];\n          if (currentPosition + wordView.getSize() <= position) {\n            currentPosition += wordView.getSize();\n            continue;\n          }\n          if (position === currentPosition) {\n            // Try to go to previous word\n            if (o > 0) {\n              const previousWordView = wordViews[o - 1];\n              currentPosition -= previousWordView.getSize();\n            } else if (m > 0) {\n              // Try previous line\n              const previousLineView = lineViews[m - 1];\n              const previousLineViewWordViews = previousLineView.getBoxViews();\n              if (previousLineViewWordViews.length > 0) {\n                const previousWordView = previousLineViewWordViews[previousLineViewWordViews.length - 1];\n                currentPosition -= previousWordView.getSize();\n              }\n            } else if (n > 0) {\n              // Try previous page\n              const previousPageView = pageViews[n - 1];\n              const previousPageViewLineViews = previousPageView.getLineViews();\n              if (previousPageViewLineViews.length > 0) {\n                const previousLineView = previousPageViewLineViews[previousPageViewLineViews.length - 1];\n                const previousLineViewWordViews = previousLineView.getBoxViews();\n                if (previousLineViewWordViews.length > 0) {\n                  const previousWordView = previousLineViewWordViews[previousLineViewWordViews.length - 1];\n                  currentPosition -= previousWordView.getSize();\n                }\n              }\n            }\n          }\n          return currentPosition;\n        }\n      }\n    }\n    throw new Error(`Position ${position} is not in the document.`);\n  }\n\n  /**\n   * Gets the position at the end of the word that\n   * the given position is on.\n   * @param position - Position for determining the word.\n   */\n  getWordEndPosition(position: number): number {\n    // Search page\n    let currentPosition = this.documentElement.getSize() - 1;\n    const pageViews = this.pageViews;\n    for (let n = pageViews.length - 1; n >= 0; n--) {\n      const pageView = pageViews[n];\n      if (currentPosition - pageView.getSize() >= position) {\n        currentPosition -= pageView.getSize();\n        continue;\n      }\n      const lineViews = pageView.getLineViews();\n      // Search line\n      for (let m = lineViews.length - 1; m >= 0; m--) {\n        const lineView = lineViews[m];\n        if (currentPosition - lineView.getSize() >= position) {\n          currentPosition -= lineView.getSize();\n          continue;\n        }\n        const wordViews = lineView.getBoxViews();\n        // Search word\n        for (let o = wordViews.length - 1; o >= 0; o--) {\n          const wordView = wordViews[o];\n          if (currentPosition - wordView.getSize() >= position) {\n            currentPosition -= wordView.getSize();\n            continue;\n          }\n          if (position === currentPosition) {\n            // Try to go to next word\n            if (o < wordViews.length - 1) {\n              const nextWordView = wordViews[o + 1];\n              currentPosition += nextWordView.getSize();\n            } else if (m < lineViews.length - 1) {\n              // Try next line\n              const nextLineView = lineViews[m + 1];\n              const nextLineViewWordViews = nextLineView.getBoxViews();\n              if (nextLineViewWordViews.length > 0) {\n                const nextWordView = nextLineViewWordViews[0];\n                currentPosition += nextWordView.getSize();\n              }\n            } else if (n < pageViews.length - 1) {\n              // Try next page\n              const nextPageView = pageViews[n + 1];\n              const nextPageViewLineViews = nextPageView.getLineViews();\n              if (nextPageViewLineViews.length > 0) {\n                const nextLineView = nextPageViewLineViews[0];\n                const nextLineViewWordViews = nextLineView.getBoxViews();\n                if (nextLineViewWordViews.length > 0) {\n                  const nextWordView = nextLineViewWordViews[0];\n                  currentPosition += nextWordView.getSize();\n                }\n              }\n            }\n          }\n          return currentPosition;\n        }\n      }\n    }\n    throw new Error(`Position ${position} is not in the document.`);\n  }\n}\n","import LineView from './LineView';\n\nexport default class ParagraphLineView extends LineView {\n  bindToDOM() {\n    if (this.domElement) {\n      return;\n    }\n    this.domElement = document.createElement('div');\n    this.domElement.className = 'tw--paragraph-line';\n    const parentDOMElement = this.getPageView().getDOMElement();\n    this.boxViews.forEach(boxView => boxView.bindToDOM());\n    parentDOMElement.appendChild(this.domElement);\n  }\n}\n","import PageView from './PageView';\nimport BoxView from './BoxView';\n\ntype LineViewConfig = {\n  width: number;\n}\n\nexport type LineViewScreenPosition = {\n  left: number;\n  width: number;\n  height: number;\n}\n\nexport default abstract class LineView {\n  protected config: LineViewConfig;\n  protected pageView?: PageView;\n  protected boxViews: BoxView[];\n  protected domElement?: HTMLElement;\n\n  constructor(config: LineViewConfig) {\n    this.config = config;\n    this.boxViews = [];\n  }\n\n  setPageView(pageView: PageView) {\n    this.pageView = pageView;\n  }\n\n  getBoxViews(): BoxView[] {\n    return this.boxViews;\n  }\n\n  appendBoxView(boxView: BoxView) {\n    this.boxViews.push(boxView);\n  }\n\n  removeBoxView(boxView: BoxView) {\n    const index = this.boxViews.indexOf(boxView);\n    if (index < 0) {\n      return;\n    }\n    this.boxViews.splice(index, 1);\n  }\n\n  abstract bindToDOM(): void;\n\n  getConfig(): LineViewConfig {\n    return this.config;\n  }\n\n  getPageView(): PageView {\n    return this.pageView!;\n  }\n\n  getDOMElement(): HTMLElement {\n    return this.domElement!;\n  }\n\n  getHeight(): number {\n    return Math.max(...this.boxViews.map(boxView => boxView.getHeight()));\n  }\n\n  getSize(): number {\n    let size = 0;\n    this.boxViews!.forEach(boxView => size += boxView.getSize());\n    return size;\n  }\n\n  getScreenPosition(from: number, to: number): LineViewScreenPosition {\n    let cumulatedSize = 0;\n    let cumulatedWidth = 0;\n    let left: number | null = null;\n    for (let n = 0, nn = this.boxViews.length; n < nn; n++) {\n      const boxView = this.boxViews[n];\n      const boxViewSize = boxView.getSize();\n      if (left === null) {\n        // Left-bound has not been determined yet,\n        // so we need to determine left bound,\n        // and if the box at the left bound covers\n        // the whole range then we return the screen\n        // position of that box\n        if (cumulatedSize + boxViewSize >= from) {\n          // End of box is to the right of the beginning\n          // of the range\n          if (cumulatedSize + boxViewSize >= to) {\n            // End of box is at or to the right of the end\n            // of the range, this means the box fully covers\n            // the range\n            const boxViewScreenPosition = boxView.getScreenPosition(from - cumulatedSize, to - cumulatedSize);\n            return {\n              left: cumulatedWidth + boxViewScreenPosition.left,\n              width: boxViewScreenPosition.width,\n              height: boxViewScreenPosition.height,\n            };\n          }\n          left = cumulatedWidth + boxView.getScreenPosition(from - cumulatedSize, boxViewSize).left;\n        }\n      } else {\n        if (cumulatedSize + boxViewSize >= to) {\n          const rightScreenPosition = boxView.getScreenPosition(0, to - cumulatedSize);\n          const right = cumulatedWidth + rightScreenPosition.left + rightScreenPosition.width;\n          return {\n            left,\n            width: right - left,\n            height: this.getHeight(),\n          };\n        }\n      }\n      cumulatedSize += boxViewSize;\n      cumulatedWidth += boxView.getWidth();\n    }\n    throw new Error(`Line screen position cannot be determined for range from ${from} to ${to}.`);\n  }\n}\n","import LineView from './LineView';\nimport Word from '../element/Word';\n\ntype BoxViewConfig = {\n}\n\nexport type BoxViewScreenPosition = {\n  left: number;\n  width: number;\n  height: number;\n}\n\nexport default abstract class BoxView {\n  protected config: BoxViewConfig;\n  protected word?: Word;\n  protected lineView?: LineView;\n  protected domElement?: HTMLElement | Text;\n\n  constructor(config: BoxViewConfig) {\n    this.config = config;\n  }\n\n  setLineView(lineView: LineView) {\n    this.lineView = lineView;\n  }\n\n  setWord(word: Word) {\n    this.word = word;\n  }\n\n  abstract bindToDOM(): void;\n\n  getConfig(): BoxViewConfig {\n    return this.config;\n  }\n\n  getWord(): Word {\n    return this.word!;\n  }\n\n  getLineView(): LineView {\n    return this.lineView!;\n  }\n\n  getDOMElement(): HTMLElement | Text {\n    return this.domElement!;\n  }\n\n  abstract getWidth(): number;\n  abstract getHeight(): number;\n\n  getSize(): number {\n    return this.getWord().getSize();\n  }\n\n  abstract getScreenPosition(from: number, to: number): BoxViewScreenPosition;\n  abstract getDocumentPosition(screenPosition: number): number;\n}\n","import TextStyle from './TextStyle';\n\ntype Measurement = {\n  width: number;\n  height: number;\n};\n\nfunction getTextStyleKey(textStyle: TextStyle): string {\n  return JSON.stringify(textStyle);\n}\n\nexport class TextMeasurer {\n  private $iframe: HTMLIFrameElement;\n  private $textContainers: Map<string, HTMLSpanElement>;\n\n  constructor() {\n    this.$iframe = document.createElement(\"iframe\");\n    this.$iframe.src = \"about:blank\";\n    this.$iframe.style.width = \"0\";\n    this.$iframe.style.height = \"0\";\n    this.$iframe.style.border = \"none\";\n    document.body.appendChild(this.$iframe);\n    this.$textContainers = new Map<string, HTMLSpanElement>();\n  }\n\n  getTextContainerElement(textStyle: TextStyle): HTMLSpanElement {\n    const textStyleKey = getTextStyleKey(textStyle);\n    if (!this.$textContainers.has(textStyleKey)) {\n      const $textContainer = document.createElement('span');\n      $textContainer.style.display = 'inline-block';\n      $textContainer.style.whiteSpace = 'pre';\n      $textContainer.style.fontFamily = textStyle.fontFamily;\n      $textContainer.style.fontSize = `${textStyle.fontSize}px`;\n      $textContainer.style.fontWeight = `${textStyle.fontWeight}`;\n      $textContainer.style.lineHeight = `${textStyle.lineHeight}px`;\n      $textContainer.style.letterSpacing = `${textStyle.letterSpacing}`;\n      this.$iframe.contentDocument!.body.appendChild($textContainer);\n      this.$textContainers.set(textStyleKey, $textContainer);\n    }\n    const $textContainer = this.$textContainers.get(textStyleKey);\n    return $textContainer!;\n  }\n\n  measure(text: string, textStyle: TextStyle) {\n    const $textContainer = this.getTextContainerElement(textStyle);\n    if ($textContainer.innerHTML !== text) {\n      $textContainer.innerHTML = text;\n    }\n    const boundingClientRect = $textContainer.getBoundingClientRect();\n    return {\n      width: boundingClientRect.width,\n      height: boundingClientRect.height,\n    };\n  }\n}\n\nconst textMeasurer = new TextMeasurer();\n\nexport default function measureText(text: string, textStyle: TextStyle): Measurement {\n  return textMeasurer.measure(text, textStyle);\n}\n","import BoxView, { BoxViewScreenPosition } from './BoxView';\nimport TextWord from '../element/word/TextWord';\nimport measureText from './helpers/measureText';\n\nconst placeholderTextStyle = {\n  fontFamily: 'Arial',\n  fontSize: 18,\n  fontWeight: 400,\n  lineHeight: 36,\n  letterSpacing: 0,\n};\n\nexport default class TextView extends BoxView {\n  private width?: number;\n  private height?: number;\n\n  private measure() {\n    const textWord = <TextWord> this.getWord();\n    const measurement = measureText(textWord.getText(), placeholderTextStyle);\n    this.width = measurement.width;\n    this.height = measurement.height;\n  }\n\n  bindToDOM() {\n    if (this.domElement) {\n      return;\n    }\n    const parentDOMElement = this.getLineView().getDOMElement();\n    const textWord = <TextWord> this.getWord();\n    this.domElement = document.createTextNode(textWord.getText());\n    parentDOMElement.appendChild(this.domElement);\n  }\n\n  getWidth(): number {\n    if (this.width === undefined) {\n      this.measure();\n    }\n    return this.width!;\n  }\n\n  getHeight(): number {\n    if (this.height === undefined) {\n      this.measure();\n    }\n    return this.height!;\n  }\n\n  getScreenPosition(from: number, to: number): BoxViewScreenPosition {\n    const textWord = <TextWord> this.getWord();\n    const text = textWord.getText();\n    let left: number;\n    if (from === 0) {\n      left = 0;\n    } else {\n      left = measureText(text.substring(0, from), placeholderTextStyle).width;\n    }\n    let right: number;\n    if (to === 0) {\n      right = 0;\n    } else if (to === from) {\n      right = left;\n    } else {\n      right = measureText(text.substring(0, to), placeholderTextStyle).width;\n    }\n    return {\n      left,\n      width: right - left,\n      height: this.getHeight(),\n    };\n  }\n\n  getDocumentPosition(screenPosition: number): number {\n    // Step through each character until we reach\n    // the screen position\n    const textWord = <TextWord> this.getWord();\n    const text = textWord.getText();\n    let lastWidth = 0;\n    for (let n = 1, nn = text.length; n < nn; n++) {\n      const width = measureText(text.substring(0, n), placeholderTextStyle).width;\n      if (width > screenPosition) {\n        if (screenPosition - lastWidth > width - screenPosition) {\n          return n;\n        }\n        return n - 1;\n      }\n      lastWidth = width;\n    }\n    return text.length;\n  }\n}\n","import Cursor from '../cursor/Cursor';\nimport CursorTransformation from './CursorTransformation';\nimport TranslateCursor from './cursortransformationsteps/TranslateCursor';\nimport TranslateCursorHead from './cursortransformationsteps/TranslateCursorHead';\n\n/**\n * Transformer for applying transformations\n * on cursors.\n */\nexport default class CursorTransformer {\n  /**\n   * Applies a transformation on a cursor.\n   * @param cursor - Cursor to apply transformation on.\n   * @param transformation - Transformation to apply.\n   */\n  apply(cursor: Cursor, transformation: CursorTransformation) {\n    const steps = transformation.getSteps();\n    steps.forEach(step => {\n      if (step instanceof TranslateCursor) {\n        cursor.moveTo(cursor.getHead() + step.getDisplacement());\n      } else if (step instanceof TranslateCursorHead) {\n        cursor.moveHeadTo(cursor.getHead() + step.getDisplacement());\n      } else {\n        throw new Error(`Unrecognized cursor transformation step: ${step.getType()}`);\n      }\n    });\n  }\n}\n","import DocumentElement from '../element/DocumentElement';\nimport DocumentTransformation from './DocumentTransformation';\n\n/**\n * Transformer for applying transformations\n * on cursors.\n */\nexport default class DocumentTransformer {\n  /**\n   * Applies a transformation on a document element.\n   * @param document - Document to apply transformation on.\n   * @param transformation - Transformation to apply.\n   */\n  apply(documentElement: DocumentElement, transformation: DocumentTransformation) {\n    const steps = transformation.getSteps();\n    steps.forEach(step => {\n      // if (step instanceof TranslateCursor) {\n      //   cursor.moveTo(cursor.getHead() + step.getDisplacement());\n      // } else if (step instanceof TranslateCursorHead) {\n      //   cursor.moveHeadTo(cursor.getHead() + step.getDisplacement());\n      // } else {\n      //   throw new Error(`Unrecognized cursor transformation step: ${step.getType()}`);\n      // }\n    });\n  }\n}\n","import EventObserver from '../event/EventObserver';\nimport Event, { KeyPressEvent } from '../event/Event';\nimport {\n  moveBackwardByChar,\n  moveForwardByChar,\n  moveBackwardByWord,\n  moveForwardByWord,\n  moveBackwardByLine,\n  moveForwardByLine,\n  moveToDocumentStart,\n  moveToDocumentEnd,\n  moveHeadBackwardByChar,\n  moveHeadForwardByChar,\n  moveHeadBackwardByWord,\n  moveHeadForwardByWord,\n  moveHeadBackwardByLine,\n  moveHeadForwardByLine,\n  moveHeadToDocumentStart,\n  moveHeadToDocumentEnd,\n} from '../command/cursor';\n\nexport default class EditorCursorEventObserver extends EventObserver {\n  onEvent(event: Event) {\n    if (event instanceof KeyPressEvent) {\n      const keyPressEvent = <KeyPressEvent> event;\n      if (keyPressEvent.key === 'ArrowLeft') {\n        if (keyPressEvent.shift) {\n          if (keyPressEvent.alt) {\n            this.dispatchCursorCommand(moveHeadBackwardByWord());\n          } else if (keyPressEvent.meta) {\n            this.dispatchCursorCommand(moveHeadBackwardByLine());\n          } else {\n            this.dispatchCursorCommand(moveHeadBackwardByChar());\n          }\n        } else {\n          if (keyPressEvent.alt) {\n            this.dispatchCursorCommand(moveBackwardByWord());\n          } else if (keyPressEvent.meta) {\n            this.dispatchCursorCommand(moveBackwardByLine());\n          } else {\n            this.dispatchCursorCommand(moveBackwardByChar());\n          }\n        }\n      } else if (keyPressEvent.key === 'ArrowRight') {\n        if (keyPressEvent.shift) {\n          if (keyPressEvent.alt) {\n            this.dispatchCursorCommand(moveHeadForwardByWord());\n          } else if (keyPressEvent.meta) {\n            this.dispatchCursorCommand(moveHeadForwardByLine());\n          } else {\n            this.dispatchCursorCommand(moveHeadForwardByChar());\n          }\n        } else {\n          if (keyPressEvent.alt) {\n            this.dispatchCursorCommand(moveForwardByWord());\n          } else if (keyPressEvent.meta) {\n            this.dispatchCursorCommand(moveForwardByLine());\n          } else {\n            this.dispatchCursorCommand(moveForwardByChar());\n          }\n        }\n      } else if (keyPressEvent.key === 'ArrowUp') {\n        if (keyPressEvent.shift) {\n          if (keyPressEvent.alt) {\n            this.dispatchCursorCommand(moveHeadBackwardByLine());\n          } else if (keyPressEvent.meta) {\n            this.dispatchCursorCommand(moveHeadToDocumentStart());\n          } else {\n            // TODO: Move cursor head to previous line but preserve horizontal position\n          }\n        } else {\n          if (keyPressEvent.alt) {\n            this.dispatchCursorCommand(moveBackwardByLine());\n          } else if (keyPressEvent.meta) {\n            this.dispatchCursorCommand(moveToDocumentStart());\n          } else {\n            // TODO: Move cursor to previous line but preserve horizontal position\n          }\n        }\n      } else if (keyPressEvent.key === 'ArrowDown') {\n        if (keyPressEvent.shift) {\n          if (keyPressEvent.alt) {\n            this.dispatchCursorCommand(moveHeadForwardByLine());\n          } else if (keyPressEvent.meta) {\n            this.dispatchCursorCommand(moveHeadToDocumentEnd());\n          } else {\n            // TODO: Move cursor head to next line but preserve horizontal position\n          }\n        } else {\n          if (keyPressEvent.alt) {\n            this.dispatchCursorCommand(moveForwardByLine());\n          } else if (keyPressEvent.meta) {\n            this.dispatchCursorCommand(moveToDocumentEnd());\n          } else {\n            // TODO: Move cursor to next line but preserve horizontal position\n          }\n        }\n      }\n    }\n  }\n}\n","import TaleWeaver from '../../TaleWeaver';\nimport CursorCommand from '../CursorCommand';\nimport CursorTransformation from '../../state/CursorTransformation';\nimport TranslateCursorHead from '../../state/cursortransformationsteps/TranslateCursorHead';\n\nexport default function moveHeadBackwardByWord(): CursorCommand {\n  return (taleWeaver: TaleWeaver): CursorTransformation => {\n    const transformation = new CursorTransformation();\n    const editorCursor = taleWeaver.getState().getEditorCursor();\n    if (!editorCursor) {\n      return transformation;\n    }\n    const head = editorCursor.getHead();\n    const documentView = taleWeaver.getDocumentView();\n    const wordStart = documentView.getWordStartPosition(head);\n    transformation.addStep(new TranslateCursorHead(wordStart - head));\n    return transformation;\n  };\n}\n","import TaleWeaver from '../../TaleWeaver';\nimport CursorCommand from '../CursorCommand';\nimport CursorTransformation from '../../state/CursorTransformation';\nimport TranslateCursorHead from '../../state/cursortransformationsteps/TranslateCursorHead';\n\nexport default function moveHeadBackwardByChar(): CursorCommand {\n  return (taleWeaver: TaleWeaver): CursorTransformation => {\n    const transformation = new CursorTransformation();\n    const editorCursor = taleWeaver.getState().getEditorCursor();\n    if (!editorCursor) {\n      return transformation;\n    }\n    if (editorCursor.getHead() < 1) {\n      return transformation;\n    }\n    transformation.addStep(new TranslateCursorHead(-1));\n    return transformation;\n  };\n}\n","import TaleWeaver from '../../TaleWeaver';\nimport CursorCommand from '../CursorCommand';\nimport CursorTransformation from '../../state/CursorTransformation';\nimport TranslateCursor from '../../state/cursortransformationsteps/TranslateCursor';\n\nexport default function moveBackwardByWord(): CursorCommand {\n  return (taleWeaver: TaleWeaver): CursorTransformation => {\n    const transformation = new CursorTransformation();\n    const editorCursor = taleWeaver.getState().getEditorCursor();\n    if (!editorCursor) {\n      return transformation;\n    }\n    const head = editorCursor.getHead();\n    const documentView = taleWeaver.getDocumentView();\n    const wordStart = documentView.getWordStartPosition(head);\n    transformation.addStep(new TranslateCursor(wordStart - head));\n    return transformation;\n  };\n}\n","import TaleWeaver from '../../TaleWeaver';\nimport CursorCommand from '../CursorCommand';\nimport CursorTransformation from '../../state/CursorTransformation';\nimport TranslateCursor from '../../state/cursortransformationsteps/TranslateCursor';\n\nexport default function moveBackwardByChar(): CursorCommand {\n  return (taleWeaver: TaleWeaver): CursorTransformation => {\n    const transformation = new CursorTransformation();\n    const editorCursor = taleWeaver.getState().getEditorCursor();\n    if (!editorCursor) {\n      return transformation;\n    }\n    const anchor = editorCursor.getAnchor();\n    const head = editorCursor.getHead();\n    if (anchor === head) {\n      if (head < 1) {\n        return transformation;\n      }\n      transformation.addStep(new TranslateCursor(-1));\n    } else {\n      if (anchor < head) {\n        transformation.addStep(new TranslateCursor(anchor - head));\n      } else if (anchor > head) {\n        transformation.addStep(new TranslateCursor(0));\n      }\n    }\n    return transformation;\n  };\n}\n","import TaleWeaver from '../../TaleWeaver';\nimport CursorCommand from '../CursorCommand';\nimport CursorTransformation from '../../state/CursorTransformation';\nimport TranslateCursorHead from '../../state/cursortransformationsteps/TranslateCursorHead';\n\nexport default function moveHeadForwardByWord(): CursorCommand {\n  return (taleWeaver: TaleWeaver): CursorTransformation => {\n    const transformation = new CursorTransformation();\n    const editorCursor = taleWeaver.getState().getEditorCursor();\n    if (!editorCursor) {\n      return transformation;\n    }\n    const head = editorCursor.getHead();\n    const documentView = taleWeaver.getDocumentView();\n    const wordEnd = documentView.getWordEndPosition(head);\n    transformation.addStep(new TranslateCursorHead(wordEnd - head));\n    return transformation;\n  };\n}\n","import TaleWeaver from '../../TaleWeaver';\nimport CursorCommand from '../CursorCommand';\nimport CursorTransformation from '../../state/CursorTransformation';\nimport TranslateCursorHead from '../../state/cursortransformationsteps/TranslateCursorHead';\n\nexport default function moveHeadForwardByChar(): CursorCommand {\n  return (taleWeaver: TaleWeaver): CursorTransformation => {\n    const transformation = new CursorTransformation();\n    const editorCursor = taleWeaver.getState().getEditorCursor();\n    if (!editorCursor) {\n      return transformation;\n    }\n    if (editorCursor.getHead() > taleWeaver.getState().getDocumentElement().getSize() - 1) {\n      return transformation;\n    }\n    transformation.addStep(new TranslateCursorHead(1));\n    return transformation;\n  };\n}\n","import TaleWeaver from '../../TaleWeaver';\nimport CursorCommand from '../CursorCommand';\nimport CursorTransformation from '../../state/CursorTransformation';\nimport TranslateCursor from '../../state/cursortransformationsteps/TranslateCursor';\n\nexport default function moveForwardByWord(): CursorCommand {\n  return (taleWeaver: TaleWeaver): CursorTransformation => {\n    const transformation = new CursorTransformation();\n    const editorCursor = taleWeaver.getState().getEditorCursor();\n    if (!editorCursor) {\n      return transformation;\n    }\n    const head = editorCursor.getHead();\n    const documentView = taleWeaver.getDocumentView();\n    const wordEnd = documentView.getWordEndPosition(head);\n    transformation.addStep(new TranslateCursor(wordEnd - head));\n    return transformation;\n  };\n}\n","import TaleWeaver from '../../TaleWeaver';\nimport CursorCommand from '../CursorCommand';\nimport CursorTransformation from '../../state/CursorTransformation';\nimport TranslateCursor from '../../state/cursortransformationsteps/TranslateCursor';\n\nexport default function moveForwardByChar(): CursorCommand {\n  return (taleWeaver: TaleWeaver): CursorTransformation => {\n    const transformation = new CursorTransformation();\n    const editorCursor = taleWeaver.getState().getEditorCursor();\n    if (!editorCursor) {\n      return transformation;\n    }\n    const anchor = editorCursor.getAnchor();\n    const head = editorCursor.getHead();\n    if (anchor === head) {\n      const documentSize = taleWeaver.getState().getDocumentElement().getSize();\n      if (head > documentSize - 1) {\n        return transformation;\n      }\n      transformation.addStep(new TranslateCursor(1));\n    } else {\n      if (anchor < head) {\n        transformation.addStep(new TranslateCursor(0));\n      } else if (anchor > head) {\n        transformation.addStep(new TranslateCursor(anchor - head));\n      }\n    }\n    return transformation;\n  };\n}\n","import TaleWeaver from '../../TaleWeaver';\nimport CursorCommand from '../CursorCommand';\nimport CursorTransformation from '../../state/CursorTransformation';\nimport TranslateCursorHead from '../../state/cursortransformationsteps/TranslateCursorHead';\n\nexport default function moveHeadToDocumentStart(): CursorCommand {\n  return (taleWeaver: TaleWeaver): CursorTransformation => {\n    const transformation = new CursorTransformation();\n    const editorCursor = taleWeaver.getState().getEditorCursor();\n    if (!editorCursor) {\n      return transformation;\n    }\n    const head = editorCursor.getHead();\n    transformation.addStep(new TranslateCursorHead(0 - head));\n    return transformation;\n  };\n}\n","import TaleWeaver from '../../TaleWeaver';\nimport CursorCommand from '../CursorCommand';\nimport CursorTransformation from '../../state/CursorTransformation';\nimport TranslateCursor from '../../state/cursortransformationsteps/TranslateCursor';\n\nexport default function moveToDocumentStart(): CursorCommand {\n  return (taleWeaver: TaleWeaver): CursorTransformation => {\n    const transformation = new CursorTransformation();\n    const editorCursor = taleWeaver.getState().getEditorCursor();\n    if (!editorCursor) {\n      return transformation;\n    }\n    const head = editorCursor.getHead();\n    transformation.addStep(new TranslateCursor(0 - head));\n    return transformation;\n  };\n}\n","import TaleWeaver from '../../TaleWeaver';\nimport CursorCommand from '../CursorCommand';\nimport CursorTransformation from '../../state/CursorTransformation';\nimport TranslateCursorHead from '../../state/cursortransformationsteps/TranslateCursorHead';\n\nexport default function moveHeadToDocumentEnd(): CursorCommand {\n  return (taleWeaver: TaleWeaver): CursorTransformation => {\n    const transformation = new CursorTransformation();\n    const editorCursor = taleWeaver.getState().getEditorCursor();\n    if (!editorCursor) {\n      return transformation;\n    }\n    const head = editorCursor.getHead();\n    const documentSize = taleWeaver.getState().getDocumentElement().getSize();\n    transformation.addStep(new TranslateCursorHead(documentSize - head));\n    return transformation;\n  };\n}\n","import TaleWeaver from '../../TaleWeaver';\nimport CursorCommand from '../CursorCommand';\nimport CursorTransformation from '../../state/CursorTransformation';\nimport TranslateCursor from '../../state/cursortransformationsteps/TranslateCursor';\n\nexport default function moveToDocumentEnd(): CursorCommand {\n  return (taleWeaver: TaleWeaver): CursorTransformation => {\n    const transformation = new CursorTransformation();\n    const editorCursor = taleWeaver.getState().getEditorCursor();\n    if (!editorCursor) {\n      return transformation;\n    }\n    const head = editorCursor.getHead();\n    const documentSize = taleWeaver.getState().getDocumentElement().getSize();\n    transformation.addStep(new TranslateCursor(documentSize - head));\n    return transformation;\n  };\n}\n","import TaleWeaver from '../TaleWeaver';\nimport Event from './Event';\nimport CursorCommand from '../command/CursorCommand';\n\nexport default abstract class EventObserver {\n  protected taleWeaver: TaleWeaver;\n\n  constructor(taleWeaver: TaleWeaver) {\n    this.taleWeaver = taleWeaver;\n  }\n\n  dispatchCursorCommand(cursorCommand: CursorCommand) {\n    const cursorTransformation = cursorCommand(this.taleWeaver);\n    this.taleWeaver.getState().applyEditorCursorTransformation(cursorTransformation);\n  }\n\n  abstract onEvent(event: Event): void;\n}\n","import DocumentElement from './element/DocumentElement';\nimport BlockElement from './element/BlockElement';\nimport InlineElement from './element/InlineElement';\nimport ParagraphElement from './element/block/ParagraphElement';\nimport TextElement from './element/inline/TextElement';\nimport DocumentView from './view/DocumentView';\nimport PageView from './view/PageView';\nimport LineView from './view/LineView';\nimport BoxView from './view/BoxView';\nimport ParagraphLineView from './view/ParagraphLineView';\nimport TextView from './view/TextView';\nimport State from './state/State';\nimport CursorTransformer from './state/CursorTransformer';\nimport DocumentTransformer from './state/DocumentTransformer';\nimport EventObserver from './event/EventObserver';\nimport EditorCursorEventObserver from './event/EditorCursorEventObserver';\n\ntype DocumentElementClass = new (...args: any[]) => DocumentElement;\ntype BlockElementClass = new (...args: any[]) => BlockElement;\ntype InlineElementClass = new (...args: any[]) => InlineElement;\ntype DocumentViewClass = new (...args: any[]) => DocumentView;\ntype PageViewClass = new (...args: any[]) => PageView;\ntype LineViewClass = new (...args: any[]) => LineView;\ntype BoxViewClass = new (...args: any[]) => BoxView;\n\n/**\n * Configs for TaleWeaver.\n */\ntype TaleWeaverConfig = {\n  /** Width of a page in the document. */\n  pageWidth: number;\n  /** Height of a page in the document. */\n  pageHeight: number;\n  /** Topping padding of a page in the document. */\n  pagePaddingTop: number;\n  /** Bottom padding of a page in the document. */\n  pagePaddingBottom: number;\n  /** Left padding of a page in the document. */\n  pagePaddingLeft: number;\n  /** Right padding of a page in the document. */\n  pagePaddingRight: number;\n}\n\n/**\n * Registry for model element classes and view classes.\n * Useful for customizing and extending TaleWeaver.\n */\nclass TaleWeaverRegistry {\n  /** TaleWeaver instance. */\n  private taleWeaver: TaleWeaver;\n  /** Registered document element class. */\n  private documentElementClass?: DocumentElementClass;\n  /** Registered block element classes. */\n  private blockElementClasses: Map<string, BlockElementClass>;\n  /** Registered inline element classes. */\n  private inlineElementClasses: Map<string, InlineElementClass>;\n  /** Registered document view class. */\n  private documentViewClass?: DocumentViewClass;\n  /** Registered page view class. */\n  private pageViewClass?: PageViewClass;\n  /** Registered line view classes. */\n  private lineViewClasses: Map<string, LineViewClass>;\n  /** Registered box view classes. */\n  private boxViewClasses: Map<string, BoxViewClass>;\n  /** Registered cursor transformer. */\n  private cursorTransformer?: CursorTransformer;\n  /** Registered document transformer. */\n  private documentTransformer?: DocumentTransformer;\n  /** Registered event handlers. */\n  private eventObservers: EventObserver[];\n\n  /**\n   * Creates a new TaleWeaver registry instance.\n   */\n  constructor(taleWeaver: TaleWeaver) {\n    this.taleWeaver = taleWeaver;\n\n    // Init registry maps\n    this.blockElementClasses = new Map<string, BlockElementClass>();\n    this.inlineElementClasses = new Map<string, InlineElementClass>();\n    this.lineViewClasses = new Map<string, LineViewClass>();\n    this.boxViewClasses = new Map<string, BoxViewClass>();\n    this.eventObservers = [];\n\n    // Register defaults\n    this.registerDocumentElementClass(DocumentElement);\n    this.registerBlockElementClass('Paragraph', ParagraphElement);\n    this.registerInlineElementClass('Text', TextElement);\n    this.registerDocumentViewClass(DocumentView);\n    this.registerPageViewClass(PageView);\n    this.registerLineViewClass('Paragraph', ParagraphLineView);\n    this.registerBoxViewClass('Text', TextView);\n    this.registerCursorTransformer(new CursorTransformer());\n    this.registerDocumentTransformer(new DocumentTransformer());\n    this.registerEventObserver(new EditorCursorEventObserver(this.taleWeaver));\n  }\n\n  /**\n   * Registers the document element class.\n   * @param documentElementClass - Document element class to register.\n   */\n  registerDocumentElementClass(documentElementClass: DocumentElementClass) {\n    this.documentElementClass = documentElementClass;\n  }\n\n  /**\n   * Gets the registered document element class.\n   */\n  getDocumentElementClass(): DocumentElementClass {\n    if (!this.documentElementClass) {\n      throw new Error('No document element class registered.');\n    }\n    return this.documentElementClass;\n  }\n\n  /**\n   * Registers a block element class by type.\n   * @param type - Type of the block element class.\n   * @param blockElementClass - Block element class to register.\n   */\n  registerBlockElementClass(type: string, blockElementClass: BlockElementClass) {\n    this.blockElementClasses.set(type, blockElementClass);\n  }\n\n  /**\n   * Gets a registered block element class by type.\n   * @param type - Type of the block element class.\n   */\n  getBlockElementClass(type: string): BlockElementClass {\n    const blockElementClass = this.blockElementClasses.get(type);\n    if (!blockElementClass) {\n      throw new Error(`Unregistered block element class type: ${type}.`);\n    }\n    return blockElementClass;\n  }\n\n  /**\n   * Registers an inline element class by type.\n   * @param type - Type of the inline element class.\n   * @param inlineElementClass - Inline element class to register.\n   */\n  registerInlineElementClass(type: string, inlineElementClass: InlineElementClass) {\n    this.inlineElementClasses.set(type, inlineElementClass);\n  }\n\n  /**\n   * Gets a registered inline element class by type.\n   * @param type - Type of the inline element class.\n   */\n  getInlineElementClass(type: string): InlineElementClass {\n    const inlineElementClass = this.inlineElementClasses.get(type);\n    if (!inlineElementClass) {\n      throw new Error(`Unregistered inline element class type: ${type}.`);\n    }\n    return inlineElementClass;\n  }\n\n  /**\n   * Registers the document view class.\n   * @param documentViewClass - Document view class to register.\n   */\n  registerDocumentViewClass(documentViewClass: DocumentViewClass) {\n    this.documentViewClass = documentViewClass;\n  }\n\n  /**\n   * Gets the registered document view class.\n   */\n  getDocumentViewClass(): DocumentViewClass {\n    if (!this.documentViewClass) {\n      throw new Error('No document view class registered.');\n    }\n    return this.documentViewClass;\n  }\n\n  /**\n   * Registers the page view class.\n   * @param pageViewClass - Page view class to register.\n   */\n  registerPageViewClass(pageViewClass: PageViewClass) {\n    this.pageViewClass = pageViewClass;\n  }\n\n  /**\n   * Gets the registered page view class.\n   */\n  getPageViewClass(): PageViewClass {\n    if (!this.pageViewClass) {\n      throw new Error('No page view class registered.');\n    }\n    return this.pageViewClass;\n  }\n\n  /**\n   * Regsiters a line view class by type.\n   * @param type - Type of the line view class.\n   * @param lineViewClass - Line view class to register.\n   */\n  registerLineViewClass(type: string, lineViewClass: LineViewClass) {\n    this.lineViewClasses.set(type, lineViewClass);\n  }\n\n  /**\n   * Gets a registered line view class by type.\n   * @param type - Type of the line view class.\n   */\n  getLineViewClass(type: string): LineViewClass {\n    const lineViewClass = this.lineViewClasses.get(type);\n    if (!lineViewClass) {\n      throw new Error(`Unregistered line view class: ${type}.`);\n    }\n    return lineViewClass;\n  }\n\n  /**\n   * Registers a box view class by type.\n   * @param type - Type of the box view class.\n   * @param boxViewType - Box view class to register.\n   */\n  registerBoxViewClass(type: string, boxViewClass: BoxViewClass) {\n    this.boxViewClasses.set(type, boxViewClass);\n  }\n\n  /**\n   * Gets a registered box view class by type.\n   * @param type - Type of the box view class.\n   */\n  getBoxViewClass(type: string): BoxViewClass {\n    const boxViewClass = this.boxViewClasses.get(type);\n    if (!boxViewClass) {\n      throw new Error(`Unregistered box view class: ${type}.`);\n    }\n    return boxViewClass;\n  }\n\n  /**\n   * Registers the cursor transformer.\n   * @param cursorTransformer - Cursor transformer to register.\n   */\n  registerCursorTransformer(cursorTransformer: CursorTransformer) {\n    this.cursorTransformer = cursorTransformer;\n  }\n\n  /**\n   * Gets the registered cursor transformer.\n   */\n  getCursorTransformer(): CursorTransformer {\n    if (!this.cursorTransformer) {\n      throw new Error('No cursor transformer registered.');\n    }\n    return this.cursorTransformer;\n  }\n\n  /**\n   * Registers the document transformer.\n   * @param documentTransformer - Document transformer to register.\n   */\n  registerDocumentTransformer(documentTransformer: DocumentTransformer) {\n    this.documentTransformer = documentTransformer;\n  }\n\n  /**\n   * Gets the registered document transformer.\n   */\n  getDocumentTransformer(): DocumentTransformer {\n    if (!this.documentTransformer) {\n      throw new Error('No document transformer registered.');\n    }\n    return this.documentTransformer;\n  }\n\n  /**\n   * Registers an event handler.\n   * @param eventObserver - Event handler to register.\n   */\n  registerEventObserver(eventObserver: EventObserver) {\n    this.eventObservers.push(eventObserver)\n  }\n\n  /**\n   * Gets all registered event handlers.\n   */\n  getEventObservers(): EventObserver[] {\n    return this.eventObservers;\n  }\n}\n\n/**\n * Root of TaleWeaver, holds things together.\n */\nexport default class TaleWeaver {\n  private config: TaleWeaverConfig;\n  private registry: TaleWeaverRegistry;\n  private state?: State;\n  private documentView?: DocumentView;\n\n  /**\n   * Creates a new TaleWeaver instance.\n   * @param config - Configs for TaleWeaver.\n   */\n  constructor(config: TaleWeaverConfig) {\n    this.config = config;\n    this.registry = new TaleWeaverRegistry(this);\n  }\n\n  /**\n   * Gets the registry.\n   */\n  getRegistry(): TaleWeaverRegistry {\n    return this.registry;\n  }\n\n  /**\n   * Gets the configs.\n   */\n  getConfig(): TaleWeaverConfig {\n    return this.config;\n  }\n\n  /**\n   * Sets the state.\n   * @param state - State to set.\n   */\n  setState(state: State) {\n    this.state = state!;\n  }\n\n  /**\n   * Gets the state.\n   */\n  getState(): State {\n    return this.state!;\n  }\n\n  /**\n   * Sets the document view.\n   * @param documentView - The document view to set.\n   */\n  setDocumentView(documentView: DocumentView) {\n    this.documentView = documentView;\n  }\n\n  /**\n   * Gets the document view.\n   */\n  getDocumentView(): DocumentView {\n    return this.documentView!;\n  }\n\n  /**\n   * Attaches TaleWeaver to the DOM.\n   * @param containerDOMElement - Container DOM element to attach TaleWeaver to.\n   */\n  attach(containerDOMElement: HTMLElement) {\n    const DocumentView = this.registry.getDocumentViewClass();\n    const documentView = new DocumentView(\n      this,\n      this.getState().getDocumentElement(),\n      {\n        pageWidth: this.config.pageWidth,\n        pageHeight: this.config.pageHeight,\n        pagePaddingTop: this.config.pagePaddingTop,\n        pagePaddingBottom: this.config.pagePaddingBottom,\n        pagePaddingLeft: this.config.pagePaddingLeft,\n        pagePaddingRight: this.config.pagePaddingRight,\n      },\n    );\n    this.setDocumentView(documentView);\n    this.getDocumentView().bindToDOM(containerDOMElement);\n  }\n}\n","import DocumentElement from '../element/DocumentElement';\nimport Cursor from '../cursor/Cursor';\nimport CursorTransformation from './CursorTransformation';\nimport TaleWeaver from '../TaleWeaver';\nimport Event from '../event/Event';\n\n/**\n * State container for TaleWeaver.\n * Keeps track of the state of the document\n * and its cursors.\n */\nexport default class State {\n  /** TaleWeaver instance. */\n  private taleWeaver: TaleWeaver;\n  /** Document element. */\n  private documentElement?: DocumentElement;\n  /** Editor cursor. */\n  private editorCursor: Cursor | null;\n  /** Observer cursors. */\n  private observerCursors: Cursor[];\n\n  /**\n   * Creates a new state instance.\n   * @param taleWeaver - TaleWeaver instance.\n   */\n  constructor(taleWeaver: TaleWeaver) {\n    this.taleWeaver = taleWeaver;\n    this.editorCursor = null;\n    this.observerCursors = [];\n  }\n\n  /**\n   * Sets the document element.\n   * @param documentElement - Document element to set.\n   */\n  setDocumentElement(documentElement: DocumentElement) {\n    this.documentElement = documentElement;\n  }\n\n  /**\n   * Gets the document element.\n   */\n  getDocumentElement(): DocumentElement {\n    return this.documentElement!;\n  }\n\n  /**\n   * Sets the editor cursor.\n   * @param cursor - Editor cursor to set.\n   */\n  setEditorCursor(cursor: Cursor) {\n    this.editorCursor = cursor;\n  }\n\n  /**\n   * Gets the editor cursor. It's possible to not have an editor cursor.\n   */\n  getEditorCursor(): Cursor | null {\n    return this.editorCursor;\n  }\n\n  /**\n   * Gets all observer cursors.\n   */\n  getObserverCursors(): Cursor[] {\n    return this.observerCursors;\n  }\n\n  /**\n   * Appends an observer cursor.\n   * @param cursor - Observer cursor to append.\n   */\n  appendObserverCursor(cursor: Cursor) {\n    this.observerCursors.push(cursor);\n  }\n\n  /**\n   * Removes an observer cursor.\n   * @param cursor - Observer cursor to remove.\n   */\n  removeObserverCursor(cursor: Cursor) {\n    const index = this.observerCursors.indexOf(cursor);\n    if (index < 0) {\n      return;\n    }\n    this.observerCursors.splice(index, 1);\n  }\n\n  /**\n   * Dispatches an event to the event observers.\n   * @param event - Event to dispatch.\n   */\n  dispatchEvent(event: Event) {\n    const eventObservers = this.taleWeaver.getRegistry().getEventObservers();\n    eventObservers.forEach(eventObserver => {\n      eventObserver.onEvent(event);\n    });\n  }\n\n  /**\n   * Applies a transformation on the editor cursor.\n   * @param transformation - Cursor transformation to apply.\n   */\n  applyEditorCursorTransformation(transformation: CursorTransformation) {\n    if (!this.editorCursor) {\n      throw new Error('No editor cursor available to apply transformation.');\n    }\n    const transformer = this.taleWeaver.getRegistry().getCursorTransformer();\n    transformer.apply(this.editorCursor, transformation);\n  }\n}\n","/** Observer to cursor state change. */\ntype CursorObserver = (cursor: Cursor) => void;\n\n/**\n * Generates a unique cursor ID.\n */\nfunction generateID(): string {\n  // Generate cursor ID with current timestamp and a random number.\n  return `${Date.now().toString(36)}${Math.random().toString(36).substring(2)}`\n}\n\n/**\n * Models a cursor on the document.\n */\nexport default class Cursor {\n  /** ID of the cursor. */\n  private id: string;\n  /** Anchor position of the cursor. */\n  private anchor: number;\n  /** Head position of the cursor. */\n  private head: number;\n  /** Observers registered with the cursor. */\n  private observers: CursorObserver[];\n\n  /**\n   * Creates a new cursor instance.\n   * @param anchor - Initial anchor position of the cursor.\n   * @param head - Initial head position of the cursor.\n   * @param id - ID of the cursor.\n   */\n  constructor(anchor: number, head: number, id?: string) {\n    this.id = id || generateID();\n    this.anchor = anchor;\n    this.head = head;\n    this.observers = [];\n  }\n\n  /**\n   * Notifies observers of state change.\n   */\n  private notifyObservers() {\n    this.observers.forEach(observer => {\n      observer(this);\n    });\n  }\n\n  /**\n   * Gets the ID of the cursor.\n   */\n  getID() {\n    return this.id;\n  }\n\n  /**\n   * Registers an observer.\n   * @param observer - Observer to register.\n   */\n  observe(observer: CursorObserver) {\n    this.observers.push(observer);\n  }\n\n  /**\n   * Moves the cursor to a certain position.\n   * @param position - Position to move cursor to.\n   */\n  moveTo(position: number) {\n    this.anchor = position;\n    this.head = position;\n    this.notifyObservers();\n  }\n\n  /**\n   * Moves the cursor head to a certain position.\n   * The anchor is not moved.\n   * @param position - Position to move cursor head to.\n   */\n  moveHeadTo(position: number) {\n    this.head = position;\n    this.notifyObservers();\n  }\n\n  /**\n   * Gets the anchor position.\n   */\n  getAnchor(): number {\n    return this.anchor!;\n  }\n\n  /**\n   * Gets the head position.\n   */\n  getHead(): number {\n    return this.head!;\n  }\n}\n","import React from 'react';\nimport './App.css';\nimport TaleWeaver from './editor/TaleWeaver';\nimport parseStateJSON from './editor/state/helpers/parseStateJSON';\n\nconst initialStateJSON = {\n  document: {\n    children: [\n      { type: 'Paragraph', children: [ { type: 'Text', text: 'Lorem ipsum dolor sit amet, consectetur adipiscing elit. Aenean ex magna, consequat efficitur augue a, auctor sodales dolor. Aenean mauris risus, dignissim eu lacus vel, pharetra imperdiet dolor. Cras egestas nulla ac mattis rhoncus. Mauris nec vulputate dui, ac condimentum velit. Aenean ex nibh, blandit at congue ac, gravida sed nisi. Duis lacinia a ipsum id tincidunt. Vestibulum tristique dolor nec ante imperdiet, sed laoreet elit cursus. Maecenas accumsan magna a neque blandit, in efficitur lectus porttitor. Nam tristique augue nec ornare vestibulum. Interdum et malesuada fames ac ante ipsum primis in faucibus. Mauris tristique ante vel quam sollicitudin, sodales congue nulla semper.' } ] },\n      { type: 'Paragraph', children: [ { type: 'Text', text: 'Proin fermentum, odio non accumsan luctus, leo dui vulputate justo, sollicitudin auctor ligula magna eu felis. Pellentesque velit massa, interdum vel pretium at, mollis ut est. Cras vitae est convallis, egestas mauris sit amet, hendrerit dolor. Donec eget rhoncus mi. Nullam accumsan vehicula porttitor. Pellentesque vitae nisi feugiat, molestie est ac, suscipit nisi. Donec sagittis elit mi, in aliquam tellus suscipit quis. Nulla facilisi. Integer viverra molestie turpis, et blandit dui faucibus tristique. Cras vitae tortor quis elit posuere lacinia ut blandit felis. Suspendisse potenti. Praesent posuere ipsum vel diam sagittis pretium. Donec viverra lacus justo, nec aliquam ex lacinia a. Phasellus blandit neque leo, ut facilisis urna viverra ut. Ut sodales diam vitae nulla iaculis, vitae varius purus suscipit.' } ] },\n      { type: 'Paragraph', children: [ { type: 'Text', text: 'Nunc id faucibus risus. Nulla semper dui vel vulputate porttitor. Integer ante nisl, laoreet ac massa laoreet, finibus pretium lectus. Maecenas aliquet nulla sit amet turpis hendrerit consequat. Fusce gravida at sem id lobortis. Vestibulum placerat nunc vehicula libero molestie convallis. Suspendisse eu ornare turpis.' } ] },\n      { type: 'Paragraph', children: [ { type: 'Text', text: 'Mauris sem leo, consectetur vel tempor vel, volutpat eu enim. Sed semper, libero blandit vulputate sollicitudin, odio mauris congue massa, ac ultrices leo enim sodales dolor. Aliquam in diam quis erat dictum pellentesque et ut sapien. Donec nec semper quam. Proin aliquet orci at odio accumsan maximus. Morbi rutrum sit amet quam maximus luctus. Vivamus sit amet lacinia lorem. Nunc eget suscipit lectus, ullamcorper eleifend dolor. Aliquam aliquam maximus lectus at malesuada. In fermentum ante non metus lobortis, vel ultrices purus tempus. In vestibulum mauris non elit faucibus, quis tempus ipsum tincidunt.' } ] },\n      { type: 'Paragraph', children: [ { type: 'Text', text: 'In cursus et arcu eget blandit. Vestibulum volutpat mauris eu est tempus, a ultrices justo vulputate. Suspendisse potenti. Maecenas at molestie tellus. Nulla facilisi. Etiam ac justo quis lectus blandit lacinia. Pellentesque nisl sapien, malesuada eu risus nec, malesuada posuere nisl.' } ] },\n      { type: 'Paragraph', children: [ { type: 'Text', text: 'Lorem ipsum dolor sit amet, consectetur adipiscing elit. Aenean ex magna, consequat efficitur augue a, auctor sodales dolor. Aenean mauris risus, dignissim eu lacus vel, pharetra imperdiet dolor. Cras egestas nulla ac mattis rhoncus. Mauris nec vulputate dui, ac condimentum velit. Aenean ex nibh, blandit at congue ac, gravida sed nisi. Duis lacinia a ipsum id tincidunt. Vestibulum tristique dolor nec ante imperdiet, sed laoreet elit cursus. Maecenas accumsan magna a neque blandit, in efficitur lectus porttitor. Nam tristique augue nec ornare vestibulum. Interdum et malesuada fames ac ante ipsum primis in faucibus. Mauris tristique ante vel quam sollicitudin, sodales congue nulla semper.' } ] },\n      { type: 'Paragraph', children: [ { type: 'Text', text: 'Proin fermentum, odio non accumsan luctus, leo dui vulputate justo, sollicitudin auctor ligula magna eu felis. Pellentesque velit massa, interdum vel pretium at, mollis ut est. Cras vitae est convallis, egestas mauris sit amet, hendrerit dolor. Donec eget rhoncus mi. Nullam accumsan vehicula porttitor. Pellentesque vitae nisi feugiat, molestie est ac, suscipit nisi. Donec sagittis elit mi, in aliquam tellus suscipit quis. Nulla facilisi. Integer viverra molestie turpis, et blandit dui faucibus tristique. Cras vitae tortor quis elit posuere lacinia ut blandit felis. Suspendisse potenti. Praesent posuere ipsum vel diam sagittis pretium. Donec viverra lacus justo, nec aliquam ex lacinia a. Phasellus blandit neque leo, ut facilisis urna viverra ut. Ut sodales diam vitae nulla iaculis, vitae varius purus suscipit.' } ] },\n      { type: 'Paragraph', children: [ { type: 'Text', text: 'Nunc id faucibus risus. Nulla semper dui vel vulputate porttitor. Integer ante nisl, laoreet ac massa laoreet, finibus pretium lectus. Maecenas aliquet nulla sit amet turpis hendrerit consequat. Fusce gravida at sem id lobortis. Vestibulum placerat nunc vehicula libero molestie convallis. Suspendisse eu ornare turpis.' } ] },\n      { type: 'Paragraph', children: [ { type: 'Text', text: 'Mauris sem leo, consectetur vel tempor vel, volutpat eu enim. Sed semper, libero blandit vulputate sollicitudin, odio mauris congue massa, ac ultrices leo enim sodales dolor. Aliquam in diam quis erat dictum pellentesque et ut sapien. Donec nec semper quam. Proin aliquet orci at odio accumsan maximus. Morbi rutrum sit amet quam maximus luctus. Vivamus sit amet lacinia lorem. Nunc eget suscipit lectus, ullamcorper eleifend dolor. Aliquam aliquam maximus lectus at malesuada. In fermentum ante non metus lobortis, vel ultrices purus tempus. In vestibulum mauris non elit faucibus, quis tempus ipsum tincidunt.' } ] },\n      { type: 'Paragraph', children: [ { type: 'Text', text: 'In cursus et arcu eget blandit. Vestibulum volutpat mauris eu est tempus, a ultrices justo vulputate. Suspendisse potenti. Maecenas at molestie tellus. Nulla facilisi. Etiam ac justo quis lectus blandit lacinia. Pellentesque nisl sapien, malesuada eu risus nec, malesuada posuere nisl.' } ] },\n      { type: 'Paragraph', children: [ { type: 'Text', text: 'Lorem ipsum dolor sit amet, consectetur adipiscing elit. Aenean ex magna, consequat efficitur augue a, auctor sodales dolor. Aenean mauris risus, dignissim eu lacus vel, pharetra imperdiet dolor. Cras egestas nulla ac mattis rhoncus. Mauris nec vulputate dui, ac condimentum velit. Aenean ex nibh, blandit at congue ac, gravida sed nisi. Duis lacinia a ipsum id tincidunt. Vestibulum tristique dolor nec ante imperdiet, sed laoreet elit cursus. Maecenas accumsan magna a neque blandit, in efficitur lectus porttitor. Nam tristique augue nec ornare vestibulum. Interdum et malesuada fames ac ante ipsum primis in faucibus. Mauris tristique ante vel quam sollicitudin, sodales congue nulla semper.' } ] },\n      { type: 'Paragraph', children: [ { type: 'Text', text: 'Proin fermentum, odio non accumsan luctus, leo dui vulputate justo, sollicitudin auctor ligula magna eu felis. Pellentesque velit massa, interdum vel pretium at, mollis ut est. Cras vitae est convallis, egestas mauris sit amet, hendrerit dolor. Donec eget rhoncus mi. Nullam accumsan vehicula porttitor. Pellentesque vitae nisi feugiat, molestie est ac, suscipit nisi. Donec sagittis elit mi, in aliquam tellus suscipit quis. Nulla facilisi. Integer viverra molestie turpis, et blandit dui faucibus tristique. Cras vitae tortor quis elit posuere lacinia ut blandit felis. Suspendisse potenti. Praesent posuere ipsum vel diam sagittis pretium. Donec viverra lacus justo, nec aliquam ex lacinia a. Phasellus blandit neque leo, ut facilisis urna viverra ut. Ut sodales diam vitae nulla iaculis, vitae varius purus suscipit.' } ] },\n      { type: 'Paragraph', children: [ { type: 'Text', text: 'Nunc id faucibus risus. Nulla semper dui vel vulputate porttitor. Integer ante nisl, laoreet ac massa laoreet, finibus pretium lectus. Maecenas aliquet nulla sit amet turpis hendrerit consequat. Fusce gravida at sem id lobortis. Vestibulum placerat nunc vehicula libero molestie convallis. Suspendisse eu ornare turpis.' } ] },\n      { type: 'Paragraph', children: [ { type: 'Text', text: 'Mauris sem leo, consectetur vel tempor vel, volutpat eu enim. Sed semper, libero blandit vulputate sollicitudin, odio mauris congue massa, ac ultrices leo enim sodales dolor. Aliquam in diam quis erat dictum pellentesque et ut sapien. Donec nec semper quam. Proin aliquet orci at odio accumsan maximus. Morbi rutrum sit amet quam maximus luctus. Vivamus sit amet lacinia lorem. Nunc eget suscipit lectus, ullamcorper eleifend dolor. Aliquam aliquam maximus lectus at malesuada. In fermentum ante non metus lobortis, vel ultrices purus tempus. In vestibulum mauris non elit faucibus, quis tempus ipsum tincidunt.' } ] },\n      { type: 'Paragraph', children: [ { type: 'Text', text: 'In cursus et arcu eget blandit. Vestibulum volutpat mauris eu est tempus, a ultrices justo vulputate. Suspendisse potenti. Maecenas at molestie tellus. Nulla facilisi. Etiam ac justo quis lectus blandit lacinia. Pellentesque nisl sapien, malesuada eu risus nec, malesuada posuere nisl.' } ] },\n      { type: 'Paragraph', children: [ { type: 'Text', text: 'Lorem ipsum dolor sit amet, consectetur adipiscing elit. Aenean ex magna, consequat efficitur augue a, auctor sodales dolor. Aenean mauris risus, dignissim eu lacus vel, pharetra imperdiet dolor. Cras egestas nulla ac mattis rhoncus. Mauris nec vulputate dui, ac condimentum velit. Aenean ex nibh, blandit at congue ac, gravida sed nisi. Duis lacinia a ipsum id tincidunt. Vestibulum tristique dolor nec ante imperdiet, sed laoreet elit cursus. Maecenas accumsan magna a neque blandit, in efficitur lectus porttitor. Nam tristique augue nec ornare vestibulum. Interdum et malesuada fames ac ante ipsum primis in faucibus. Mauris tristique ante vel quam sollicitudin, sodales congue nulla semper.' } ] },\n      { type: 'Paragraph', children: [ { type: 'Text', text: 'Proin fermentum, odio non accumsan luctus, leo dui vulputate justo, sollicitudin auctor ligula magna eu felis. Pellentesque velit massa, interdum vel pretium at, mollis ut est. Cras vitae est convallis, egestas mauris sit amet, hendrerit dolor. Donec eget rhoncus mi. Nullam accumsan vehicula porttitor. Pellentesque vitae nisi feugiat, molestie est ac, suscipit nisi. Donec sagittis elit mi, in aliquam tellus suscipit quis. Nulla facilisi. Integer viverra molestie turpis, et blandit dui faucibus tristique. Cras vitae tortor quis elit posuere lacinia ut blandit felis. Suspendisse potenti. Praesent posuere ipsum vel diam sagittis pretium. Donec viverra lacus justo, nec aliquam ex lacinia a. Phasellus blandit neque leo, ut facilisis urna viverra ut. Ut sodales diam vitae nulla iaculis, vitae varius purus suscipit.' } ] },\n      { type: 'Paragraph', children: [ { type: 'Text', text: 'Nunc id faucibus risus. Nulla semper dui vel vulputate porttitor. Integer ante nisl, laoreet ac massa laoreet, finibus pretium lectus. Maecenas aliquet nulla sit amet turpis hendrerit consequat. Fusce gravida at sem id lobortis. Vestibulum placerat nunc vehicula libero molestie convallis. Suspendisse eu ornare turpis.' } ] },\n      { type: 'Paragraph', children: [ { type: 'Text', text: 'Mauris sem leo, consectetur vel tempor vel, volutpat eu enim. Sed semper, libero blandit vulputate sollicitudin, odio mauris congue massa, ac ultrices leo enim sodales dolor. Aliquam in diam quis erat dictum pellentesque et ut sapien. Donec nec semper quam. Proin aliquet orci at odio accumsan maximus. Morbi rutrum sit amet quam maximus luctus. Vivamus sit amet lacinia lorem. Nunc eget suscipit lectus, ullamcorper eleifend dolor. Aliquam aliquam maximus lectus at malesuada. In fermentum ante non metus lobortis, vel ultrices purus tempus. In vestibulum mauris non elit faucibus, quis tempus ipsum tincidunt.' } ] },\n      { type: 'Paragraph', children: [ { type: 'Text', text: 'In cursus et arcu eget blandit. Vestibulum volutpat mauris eu est tempus, a ultrices justo vulputate. Suspendisse potenti. Maecenas at molestie tellus. Nulla facilisi. Etiam ac justo quis lectus blandit lacinia. Pellentesque nisl sapien, malesuada eu risus nec, malesuada posuere nisl.' } ] },\n      { type: 'Paragraph', children: [ { type: 'Text', text: 'Lorem ipsum dolor sit amet, consectetur adipiscing elit. Aenean ex magna, consequat efficitur augue a, auctor sodales dolor. Aenean mauris risus, dignissim eu lacus vel, pharetra imperdiet dolor. Cras egestas nulla ac mattis rhoncus. Mauris nec vulputate dui, ac condimentum velit. Aenean ex nibh, blandit at congue ac, gravida sed nisi. Duis lacinia a ipsum id tincidunt. Vestibulum tristique dolor nec ante imperdiet, sed laoreet elit cursus. Maecenas accumsan magna a neque blandit, in efficitur lectus porttitor. Nam tristique augue nec ornare vestibulum. Interdum et malesuada fames ac ante ipsum primis in faucibus. Mauris tristique ante vel quam sollicitudin, sodales congue nulla semper.' } ] },\n      { type: 'Paragraph', children: [ { type: 'Text', text: 'Proin fermentum, odio non accumsan luctus, leo dui vulputate justo, sollicitudin auctor ligula magna eu felis. Pellentesque velit massa, interdum vel pretium at, mollis ut est. Cras vitae est convallis, egestas mauris sit amet, hendrerit dolor. Donec eget rhoncus mi. Nullam accumsan vehicula porttitor. Pellentesque vitae nisi feugiat, molestie est ac, suscipit nisi. Donec sagittis elit mi, in aliquam tellus suscipit quis. Nulla facilisi. Integer viverra molestie turpis, et blandit dui faucibus tristique. Cras vitae tortor quis elit posuere lacinia ut blandit felis. Suspendisse potenti. Praesent posuere ipsum vel diam sagittis pretium. Donec viverra lacus justo, nec aliquam ex lacinia a. Phasellus blandit neque leo, ut facilisis urna viverra ut. Ut sodales diam vitae nulla iaculis, vitae varius purus suscipit.' } ] },\n      { type: 'Paragraph', children: [ { type: 'Text', text: 'Nunc id faucibus risus. Nulla semper dui vel vulputate porttitor. Integer ante nisl, laoreet ac massa laoreet, finibus pretium lectus. Maecenas aliquet nulla sit amet turpis hendrerit consequat. Fusce gravida at sem id lobortis. Vestibulum placerat nunc vehicula libero molestie convallis. Suspendisse eu ornare turpis.' } ] },\n      { type: 'Paragraph', children: [ { type: 'Text', text: 'Mauris sem leo, consectetur vel tempor vel, volutpat eu enim. Sed semper, libero blandit vulputate sollicitudin, odio mauris congue massa, ac ultrices leo enim sodales dolor. Aliquam in diam quis erat dictum pellentesque et ut sapien. Donec nec semper quam. Proin aliquet orci at odio accumsan maximus. Morbi rutrum sit amet quam maximus luctus. Vivamus sit amet lacinia lorem. Nunc eget suscipit lectus, ullamcorper eleifend dolor. Aliquam aliquam maximus lectus at malesuada. In fermentum ante non metus lobortis, vel ultrices purus tempus. In vestibulum mauris non elit faucibus, quis tempus ipsum tincidunt.' } ] },\n      { type: 'Paragraph', children: [ { type: 'Text', text: 'In cursus et arcu eget blandit. Vestibulum volutpat mauris eu est tempus, a ultrices justo vulputate. Suspendisse potenti. Maecenas at molestie tellus. Nulla facilisi. Etiam ac justo quis lectus blandit lacinia. Pellentesque nisl sapien, malesuada eu risus nec, malesuada posuere nisl.' } ] },\n      { type: 'Paragraph', children: [ { type: 'Text', text: 'Lorem ipsum dolor sit amet, consectetur adipiscing elit. Aenean ex magna, consequat efficitur augue a, auctor sodales dolor. Aenean mauris risus, dignissim eu lacus vel, pharetra imperdiet dolor. Cras egestas nulla ac mattis rhoncus. Mauris nec vulputate dui, ac condimentum velit. Aenean ex nibh, blandit at congue ac, gravida sed nisi. Duis lacinia a ipsum id tincidunt. Vestibulum tristique dolor nec ante imperdiet, sed laoreet elit cursus. Maecenas accumsan magna a neque blandit, in efficitur lectus porttitor. Nam tristique augue nec ornare vestibulum. Interdum et malesuada fames ac ante ipsum primis in faucibus. Mauris tristique ante vel quam sollicitudin, sodales congue nulla semper.' } ] },\n      { type: 'Paragraph', children: [ { type: 'Text', text: 'Proin fermentum, odio non accumsan luctus, leo dui vulputate justo, sollicitudin auctor ligula magna eu felis. Pellentesque velit massa, interdum vel pretium at, mollis ut est. Cras vitae est convallis, egestas mauris sit amet, hendrerit dolor. Donec eget rhoncus mi. Nullam accumsan vehicula porttitor. Pellentesque vitae nisi feugiat, molestie est ac, suscipit nisi. Donec sagittis elit mi, in aliquam tellus suscipit quis. Nulla facilisi. Integer viverra molestie turpis, et blandit dui faucibus tristique. Cras vitae tortor quis elit posuere lacinia ut blandit felis. Suspendisse potenti. Praesent posuere ipsum vel diam sagittis pretium. Donec viverra lacus justo, nec aliquam ex lacinia a. Phasellus blandit neque leo, ut facilisis urna viverra ut. Ut sodales diam vitae nulla iaculis, vitae varius purus suscipit.' } ] },\n      { type: 'Paragraph', children: [ { type: 'Text', text: 'Nunc id faucibus risus. Nulla semper dui vel vulputate porttitor. Integer ante nisl, laoreet ac massa laoreet, finibus pretium lectus. Maecenas aliquet nulla sit amet turpis hendrerit consequat. Fusce gravida at sem id lobortis. Vestibulum placerat nunc vehicula libero molestie convallis. Suspendisse eu ornare turpis.' } ] },\n      { type: 'Paragraph', children: [ { type: 'Text', text: 'Mauris sem leo, consectetur vel tempor vel, volutpat eu enim. Sed semper, libero blandit vulputate sollicitudin, odio mauris congue massa, ac ultrices leo enim sodales dolor. Aliquam in diam quis erat dictum pellentesque et ut sapien. Donec nec semper quam. Proin aliquet orci at odio accumsan maximus. Morbi rutrum sit amet quam maximus luctus. Vivamus sit amet lacinia lorem. Nunc eget suscipit lectus, ullamcorper eleifend dolor. Aliquam aliquam maximus lectus at malesuada. In fermentum ante non metus lobortis, vel ultrices purus tempus. In vestibulum mauris non elit faucibus, quis tempus ipsum tincidunt.' } ] },\n      { type: 'Paragraph', children: [ { type: 'Text', text: 'In cursus et arcu eget blandit. Vestibulum volutpat mauris eu est tempus, a ultrices justo vulputate. Suspendisse potenti. Maecenas at molestie tellus. Nulla facilisi. Etiam ac justo quis lectus blandit lacinia. Pellentesque nisl sapien, malesuada eu risus nec, malesuada posuere nisl.' } ] },\n      { type: 'Paragraph', children: [ { type: 'Text', text: 'Lorem ipsum dolor sit amet, consectetur adipiscing elit. Aenean ex magna, consequat efficitur augue a, auctor sodales dolor. Aenean mauris risus, dignissim eu lacus vel, pharetra imperdiet dolor. Cras egestas nulla ac mattis rhoncus. Mauris nec vulputate dui, ac condimentum velit. Aenean ex nibh, blandit at congue ac, gravida sed nisi. Duis lacinia a ipsum id tincidunt. Vestibulum tristique dolor nec ante imperdiet, sed laoreet elit cursus. Maecenas accumsan magna a neque blandit, in efficitur lectus porttitor. Nam tristique augue nec ornare vestibulum. Interdum et malesuada fames ac ante ipsum primis in faucibus. Mauris tristique ante vel quam sollicitudin, sodales congue nulla semper.' } ] },\n      { type: 'Paragraph', children: [ { type: 'Text', text: 'Proin fermentum, odio non accumsan luctus, leo dui vulputate justo, sollicitudin auctor ligula magna eu felis. Pellentesque velit massa, interdum vel pretium at, mollis ut est. Cras vitae est convallis, egestas mauris sit amet, hendrerit dolor. Donec eget rhoncus mi. Nullam accumsan vehicula porttitor. Pellentesque vitae nisi feugiat, molestie est ac, suscipit nisi. Donec sagittis elit mi, in aliquam tellus suscipit quis. Nulla facilisi. Integer viverra molestie turpis, et blandit dui faucibus tristique. Cras vitae tortor quis elit posuere lacinia ut blandit felis. Suspendisse potenti. Praesent posuere ipsum vel diam sagittis pretium. Donec viverra lacus justo, nec aliquam ex lacinia a. Phasellus blandit neque leo, ut facilisis urna viverra ut. Ut sodales diam vitae nulla iaculis, vitae varius purus suscipit.' } ] },\n      { type: 'Paragraph', children: [ { type: 'Text', text: 'Nunc id faucibus risus. Nulla semper dui vel vulputate porttitor. Integer ante nisl, laoreet ac massa laoreet, finibus pretium lectus. Maecenas aliquet nulla sit amet turpis hendrerit consequat. Fusce gravida at sem id lobortis. Vestibulum placerat nunc vehicula libero molestie convallis. Suspendisse eu ornare turpis.' } ] },\n      { type: 'Paragraph', children: [ { type: 'Text', text: 'Mauris sem leo, consectetur vel tempor vel, volutpat eu enim. Sed semper, libero blandit vulputate sollicitudin, odio mauris congue massa, ac ultrices leo enim sodales dolor. Aliquam in diam quis erat dictum pellentesque et ut sapien. Donec nec semper quam. Proin aliquet orci at odio accumsan maximus. Morbi rutrum sit amet quam maximus luctus. Vivamus sit amet lacinia lorem. Nunc eget suscipit lectus, ullamcorper eleifend dolor. Aliquam aliquam maximus lectus at malesuada. In fermentum ante non metus lobortis, vel ultrices purus tempus. In vestibulum mauris non elit faucibus, quis tempus ipsum tincidunt.' } ] },\n      { type: 'Paragraph', children: [ { type: 'Text', text: 'In cursus et arcu eget blandit. Vestibulum volutpat mauris eu est tempus, a ultrices justo vulputate. Suspendisse potenti. Maecenas at molestie tellus. Nulla facilisi. Etiam ac justo quis lectus blandit lacinia. Pellentesque nisl sapien, malesuada eu risus nec, malesuada posuere nisl.' } ] },\n      { type: 'Paragraph', children: [ { type: 'Text', text: 'Lorem ipsum dolor sit amet, consectetur adipiscing elit. Aenean ex magna, consequat efficitur augue a, auctor sodales dolor. Aenean mauris risus, dignissim eu lacus vel, pharetra imperdiet dolor. Cras egestas nulla ac mattis rhoncus. Mauris nec vulputate dui, ac condimentum velit. Aenean ex nibh, blandit at congue ac, gravida sed nisi. Duis lacinia a ipsum id tincidunt. Vestibulum tristique dolor nec ante imperdiet, sed laoreet elit cursus. Maecenas accumsan magna a neque blandit, in efficitur lectus porttitor. Nam tristique augue nec ornare vestibulum. Interdum et malesuada fames ac ante ipsum primis in faucibus. Mauris tristique ante vel quam sollicitudin, sodales congue nulla semper.' } ] },\n      { type: 'Paragraph', children: [ { type: 'Text', text: 'Proin fermentum, odio non accumsan luctus, leo dui vulputate justo, sollicitudin auctor ligula magna eu felis. Pellentesque velit massa, interdum vel pretium at, mollis ut est. Cras vitae est convallis, egestas mauris sit amet, hendrerit dolor. Donec eget rhoncus mi. Nullam accumsan vehicula porttitor. Pellentesque vitae nisi feugiat, molestie est ac, suscipit nisi. Donec sagittis elit mi, in aliquam tellus suscipit quis. Nulla facilisi. Integer viverra molestie turpis, et blandit dui faucibus tristique. Cras vitae tortor quis elit posuere lacinia ut blandit felis. Suspendisse potenti. Praesent posuere ipsum vel diam sagittis pretium. Donec viverra lacus justo, nec aliquam ex lacinia a. Phasellus blandit neque leo, ut facilisis urna viverra ut. Ut sodales diam vitae nulla iaculis, vitae varius purus suscipit.' } ] },\n      { type: 'Paragraph', children: [ { type: 'Text', text: 'Nunc id faucibus risus. Nulla semper dui vel vulputate porttitor. Integer ante nisl, laoreet ac massa laoreet, finibus pretium lectus. Maecenas aliquet nulla sit amet turpis hendrerit consequat. Fusce gravida at sem id lobortis. Vestibulum placerat nunc vehicula libero molestie convallis. Suspendisse eu ornare turpis.' } ] },\n      { type: 'Paragraph', children: [ { type: 'Text', text: 'Mauris sem leo, consectetur vel tempor vel, volutpat eu enim. Sed semper, libero blandit vulputate sollicitudin, odio mauris congue massa, ac ultrices leo enim sodales dolor. Aliquam in diam quis erat dictum pellentesque et ut sapien. Donec nec semper quam. Proin aliquet orci at odio accumsan maximus. Morbi rutrum sit amet quam maximus luctus. Vivamus sit amet lacinia lorem. Nunc eget suscipit lectus, ullamcorper eleifend dolor. Aliquam aliquam maximus lectus at malesuada. In fermentum ante non metus lobortis, vel ultrices purus tempus. In vestibulum mauris non elit faucibus, quis tempus ipsum tincidunt.' } ] },\n      { type: 'Paragraph', children: [ { type: 'Text', text: 'In cursus et arcu eget blandit. Vestibulum volutpat mauris eu est tempus, a ultrices justo vulputate. Suspendisse potenti. Maecenas at molestie tellus. Nulla facilisi. Etiam ac justo quis lectus blandit lacinia. Pellentesque nisl sapien, malesuada eu risus nec, malesuada posuere nisl.' } ] },\n    ],\n  },\n  editorCursor: { anchor: 0, head: 20 },\n  observerCursors: [],\n};\n\ntype TaleWeaverComponentProps = {\n  initialStateJSON: object;\n}\ntype TaleWeaverComponentState = {\n  taleWeaver: TaleWeaver;\n}\nclass TaleWeaverComponent extends React.Component<TaleWeaverComponentProps, TaleWeaverComponentState> {\n  private domRef: React.RefObject<HTMLDivElement>;\n\n  constructor(props: any) {\n    super(props);\n    this.domRef = React.createRef();\n    const taleWeaver = new TaleWeaver({\n      pageWidth: 800,\n      pageHeight: 1000,\n      pagePaddingTop: 60,\n      pagePaddingBottom: 60,\n      pagePaddingLeft: 60,\n      pagePaddingRight: 60,\n    });\n    taleWeaver.setState(parseStateJSON(taleWeaver, props.initialStateJSON));\n    this.state = { taleWeaver };\n  }\n\n  componentDidMount() {\n    const domElement = this.domRef.current!;\n    this.state.taleWeaver.attach(domElement);\n  }\n\n  render() {\n    return (\n      <div className=\"tw--container\" ref={this.domRef} />\n    );\n  }\n}\n\nclass App extends React.Component {\n  render() {\n    return (\n      <div className=\"app\">\n        <TaleWeaverComponent initialStateJSON={initialStateJSON} />\n      </div>\n    );\n  }\n}\n\nexport default App;\n","import TaleWeaver from '../../TaleWeaver';\nimport State from '../State';\nimport Cursor from '../../cursor/Cursor';\n\ntype InlineElementJSON = {\n  type: string;\n  text: string;\n}\ntype BlockElementJSON = {\n  type: string;\n  children: InlineElementJSON[];\n}\ntype DocumentElementJSON = {\n  children: BlockElementJSON[];\n}\ntype CursorJSON = {\n  anchor: number;\n  head: number;\n}\ntype StateJSON = {\n  document: DocumentElementJSON;\n  editorCursor: CursorJSON | null;\n  observerCursors: CursorJSON[];\n}\n\n/**\n * Parses a JSON-serialized state.\n * @param taleWeaver - TaleWeaver instance.\n * @param stateJSON - JSON-serialized state to parse.\n */\nexport default function parseStateJSON(taleWeaver: TaleWeaver, stateJSON: StateJSON): State {\n  // Create state\n  const state = new State(taleWeaver);\n\n  // Parse document state\n  const registry = taleWeaver.getRegistry();\n  const DocumentElement = registry.getDocumentElementClass();\n  const documentElement = new DocumentElement();\n  stateJSON.document.children.forEach(blockElementJSON => {\n    const BlockElement = registry.getBlockElementClass(blockElementJSON.type);\n    const blockElement = new BlockElement();\n    blockElementJSON.children.forEach(inlineElementJSON => {\n      const InlineElement = registry.getInlineElementClass(inlineElementJSON.type);\n      const inlineElement = new InlineElement();\n      inlineElement.setText(inlineElementJSON.text);\n      blockElement.appendChild(inlineElement);\n    });\n    documentElement.appendChild(blockElement);\n  });\n  state.setDocumentElement(documentElement);\n\n  // Parse editor cursor state\n  if (stateJSON.editorCursor) {\n    const editorCursor = new Cursor(stateJSON.editorCursor.anchor, stateJSON.editorCursor.head);\n    state.setEditorCursor(editorCursor);\n  }\n\n  // Parse observer cursors states\n  stateJSON.observerCursors.forEach(observerCursorJSON => {\n    const observerCursor = new Cursor(observerCursorJSON.anchor, observerCursorJSON.head);\n    state.appendObserverCursor(observerCursor);\n  });\n\n  return state;\n}\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read http://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.1/8 is considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\ntype Config = {\n  onSuccess?: (registration: ServiceWorkerRegistration) => void;\n  onUpdate?: (registration: ServiceWorkerRegistration) => void;\n};\n\nexport function register(config?: Config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(\n      (process as { env: { [key: string]: string } }).env.PUBLIC_URL,\n      window.location.href\n    );\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit http://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl: string, config?: Config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See http://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl: string, config?: Config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl)\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready.then(registration => {\n      registration.unregister();\n    });\n  }\n}\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\nimport * as serviceWorker from './serviceWorker';\n\nReactDOM.render(<App />, document.getElementById('root'));\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: http://bit.ly/CRA-PWA\nserviceWorker.unregister();\n"],"sourceRoot":""}